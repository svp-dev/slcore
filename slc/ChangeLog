2019-08-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Un-break the build for LEON2-MT.

	* lib/slsys/include/svp/perf.h (__inline_mtperf_sample)
	(__inline_mtperf_sample1): Avoid using the `rd %wim' code for
	LEON2-MT as this seems to not work with the newest assembler any
	more.

2019-08-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Add missing UT-LEON3 / LEON2-MT compile flags.

	* tools/bin/cce.in: Document the special flag usage,
	pass `-x flush-before-delayed' for UT-LEON3 and
	`-x no-create-strategies' for both UT-LEON3 and LEON2-MT.

2019-08-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Make UT-LEON3 also use the ram-based debug interface.

	* tools/include/svp/testoutput.h: Also use the memory-based `dbg` file
	descriptors when building for `fpga' + arch `mtsparc'.

2019-08-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Make the python version configurable during bootstrap

	* tests/build-aux/mkalltests.sh: Use `$PYTHON' if defined.

2016-12-03  Raphael 'kena' Poss  <knz@thaumogen.net>

	Code generation fixes for LEON2-MT.

	* tools/slc/mt/common/gentfun.py (TFun_2_MTFun.visit_fundef):
	Ensure that the declaration of the index register appears after
	the end of the prologue, so that spills of the index do not get
	eliminated during post-processing.

	* tools/slc/mt/leon2mt/asmproc/base.py: Do not initialize
	callee-save registers (`protectallcallregs') since the
	implementation now pre-initializes registers. Do ensure that
	`t_end' does not appear just after a delayed instruction.

	* tools/slc/mt/leon2mt/seq.py (TFun_2_L2MTCFun.visit_indexdecl),
	* tools/slc/mt/leon2mt/gentfun.py
	(TFun_2_L2MTTFun.visit_indexdecl): Fix the layout of index
	registers.

2016-12-01  Raphael 'kena' Poss  <knz@thaumogen.net>

	LEON2/LEON2-MT: fix the memory initialization code.

	* tools/lib/mt/l2mt/bootstrap.c: Properly type the pointers so
	that the full range gets initialized.

2016-11-30  Raphael 'kena' Poss  <knz@thaumogen.net>

	LEON2: fix the slrts.

	* tools/lib/mt/l2/slrt.s,
	* tools/lib/mt/l2-sim/slrt.s: Remove the stale reference to `tls.inc'.

2016-11-30  Raphael 'kena' Poss  <knz@thaumogen.net>

	LEON2-MT: Avoid scanning the FGPA board for data too often.

	* tools/leon2mt-fpga-ctl.in: Increase the scan delay in the main
	loop from 100 to 500ms.

2016-11-30  Raphael 'kena' Poss  <knz@thaumogen.net>

	LEON2/LEON2-MT: Simplify the initialization code.

	* tools/lib/mt/l2mt/bootstrap.c (__copyram): Use `bzero'
	(`memset') instead of a custom loop to initialize the BSS segment.

2016-11-30  Raphael 'kena' Poss  <knz@thaumogen.net>

	LEON2/LEON2-MT: enable use of the hardware divide instruction.

	* tools/bin/cce.in (slc_cflags): Remove `-malways-lib-div'.

2016-11-30  Raphael 'kena' Poss  <knz@thaumogen.net>

	LEON2/LEON2-MT: Simplify the addressing of thread stacks.

	With this change the thread stack addresses are prepared by
	symbols in the linker script, instead of pre-allocated space.  The
	size for each thread can also be configured with `_TLS_NBITS'.

	* tools/lib/mt/l2mt/tls.inc: Remove.
	* tools/lib/leon2mt-fpga/leon2-common.mk (LIBSLC_SRC),
	* tools/lib/mt/l2mt-sim/slrt.s,
	* tools/lib/mt/l2mt/slrt.s: Remove references to `tls.inc'.

	* tools/lib/leon2mt-fpga/linkram.in,
	* tools/lib/leon2mt-fpga/linkrom.in,
	* tools/lib/leon2mt-tbdef/linkram.in,
	* tools/lib/leon2mt-tbdef/linkrom.in: Define _TLS_NBITS.

	* tools/lib/mt/l2mt/start.inc: Ensure `__stop' is exported.

	* tools/slc/mt/leon2mt/asmproc/base.py: Use `_TLS_NBITS' and
	`_TLS_END' to compute TLS stack addresses.

2016-11-30  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix indexing of sequential families for LEON2-MT.

	* tools/slc/mt/leon2mt/gentfun.py
	(TFun_2_L2MTTFun.visit_indexdecl): LEON2-MT uses 9-bit dimensions
	for now, not 16.

	* tools/slc/mt/leon2mt/gentfun.py (TFun_2_L2MTTFun.visit_indexdecl),
	* tools/slc/mt/leon2mt/seq.py (TFun_2_L2MTCFun.visit_indexdecl):
	Expose the 1D index via new fields `i' and `n' in the Idx and Dim
	structs.

2016-11-30  Raphael 'kena' Poss  <knz@thaumogen.net>

	LEON2/LEON2-MT: Disable FP in `printf'.

	This reduces memory usage.

	* lib/leon2mt-fpga/leon2-common.mk (libc_a_CFLAGS): Compile the C
	library with FP support in `printf' disabled.
	* lib/libc/bsd/libc/stdio/printfcommon.h: Ensure that the headers
	are properly included when FP support is disabled.


2016-11-30  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix indexing of sequential families for LEON2-MT.

	* tools/slc/mt/leon2mt/seq.py (Create_2_L2MTLoop.visit_lowcreate)
	(TFun_2_L2MTCFun.visit_indexdecl): LEON2-MT uses 9-bit dimensions
	for now, not 16.

2016-11-24  Raphael 'kena' Poss  <knz@thaumogen.net>

	Packaging fix.

	* tools/runscripts.mk (EXTRA_DIST): Add the missing
	r-leon2mt-tbdef.sh.in.

2016-11-24  Alyssa Milburn  <amilburn@zall.org>

	Sync perf column names for LEON2(-MT).

	* lib/slsys/perf/perf.c: Add "pl_eff_x100" to mtperf_column_names
	for LEON2/LEON2-MT.

2016-11-24  Alyssa Milburn  <amilburn@zall.org>

	Flush stdout/stderr when outputting from FPGA buffer.

	* tools/leon2mt-fpga-ctl.in: Flush after writing.

2016-11-24  Alyssa Milburn  <amilburn@zall.org>

	Add uart_getchar function.

	* tools/lib/mt/l2mt/getchar.s: New.
	* tools/lib/leon2mt-fpga/leon2-common.mk: Use the new file.

2016-11-24  Alyssa Milburn  <amilburn@zall.org>

	Fix extra IPC statistic when using integer math.

	* lib/slsys/perf/perf.c: Multiply before dividing.

2016-11-24  Alyssa Milburn  <amilburn@zall.org>

	Fix printing large unsigned integers.

	* lib/libc/bsd/libc/stdio/printfcommon.h: Initialize svar.

2016-11-24  Alyssa Milburn  <amilburn@zall.org>

	Support starting/monitoring FPGA execution using openocd.

	* tools/leon2mt-fpga-ctl.in: Implement control script.
	* tools/lib/mt/l2mt/globals.inc: Initialize __exit_code.
	* tools/r-leon2mt-fpga.sh.in: Pass binary path onward.

2016-11-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Break a dependency on stdio in the boot code.

	* tools/lib/mt/l2mt/bootstrap.c: Remove uses of the `output_'
	macros, which on FPGA are redirected to the stdio routines, which
	during the boot code are not initialized yet.

2016-11-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Improve `slr' to drive both simulator and FPGA executions.

	* tools/r-leon2mt-fpga.sh.in: Rename to...
	* tools/r-leon2mt-tbdef.sh.in: ...this. Simplify. Fix to enable
	running when TMPDIR is not on the same filesystem as the program
	binary.
	* tools/r-leon2mt-fpga.sh.in,
	* tools/leon2mt-fpga-ctl.in: New.
	* tools/runscripts.mk: List and build the new files.

2016-11-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Ensure that `slr' cleans up upon termination.

	* tools/bin/slr.in (SLR_RDIR): Ignore signals in the watchdog
	process.

2016-11-21  Alyssa Milburn  <amilburn@zall.org>

	Implement stdio to a cyclic buffer.

	* lib/libc/stdio/mtstdio.c: Add buffer, and dbgstdout/dbgstderr.
	* lib/libc/stdio/mtstdio.h: Support new FK_BUFFER type.

2016-11-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Split the FPGA and simulator back-ends for LEON2-MT.

	* tools/bin/cce.in: Split target between `-fpga' and `-tbdef'
	(simulation).
	* tools/lib/leon2-fpga/Makefile.am,
	* tools/lib/leon2mt-fpga/Makefile.am: Use the new `cce' tags.
	* tools/lib/leon2-tbdef/Makefile.am,
	* tools/lib/leon2mt-tbdef/Makefile.am: New.
	* tools/lib/configure.ac,
	* tools/lib/Makefile.am: List the new sub-directories.

	* tools/lib/mt/l2mt/slrt.s: Extract common part into...
	* tools/lib/mt/l2mt/filler.inc,
	* tools/lib/mt/l2mt/globals.inc,
	* tools/lib/mt/l2mt/tls.inc,
	* tools/lib/mt/l2mt/start.inc: these new files.
	* tools/lib/mt/l2/slrt.s: Rewrite to use the new files.
	* tools/lib/mt/l2mt-sim/slrt.s: New.
	* tools/lib/mt/l2-sim/slrt.s: New.
	* tools/lib/leon2mt-fpga/leon2-common.mk: List the new files.
	Ensure that the assembler include path is also passed for `slrt.o'.

	* tools/lib/leon2mt-fpga/linkrom.in,
	* tools/lib/leon2mt-fpga/linkram.in: Copy to...
	* tools/lib/leon2mt-tbdef/linkrom.in,
	* tools/lib/leon2mt-tbdef/linkram.in: ...here. Fix the RAM size.
	* tools/lib/configure.ac: Generate the new linker scripts.

	* tools/include/svp/abort.h,
	* tools/include/svp/divide.h: Use the new os/arch tags.

	* tools/include/svp/testoutput.h: Use printf on debug streams
	for test output on FPGA.

	* lib/leon2-fpga/Makefile.am,
	* lib/leon2mt-fpga/Makefile.am: Use the new `cce' tags.
	* lib/leon2-tbdef/Makefile.am,
	* lib/leon2mt-tbdef/Makefile.am: New.
	* lib/configure.ac,
	* lib/Makefile.am: List the new sub-directories.

	* lib/libc/bsd/contrib/gdtoa/misc.c,
	* lib/libc/bsd/libc/stdio/printfcommon.h,
	* lib/libc/bsd/libc/stdio/vfprintf.c,
	* lib/libc/bsd/libc/stdlib/strtol.c,
	* lib/libc/bsd/libc/stdlib/strtoul.c,
	* lib/libc/bsd/libc/string/strerror.c,
	* lib/libc/malloc/malloc_excl.c,
	* lib/libc/malloc/mtmalloc.h,
	* lib/libc/stdio/mtstdio.h,
	* lib/mgos/posix-compat/exit.c,
	* lib/mgos/posix-compat/gtod.c,
	* lib/mgos/tlsmalloc/tlsconfig.h,
	* lib/slsys/include/svp/perf.h,
	* lib/slsys/perf/perf.c: Use the new os/arch macros.

	* lib/libc/bsd/libc/stdlib/strtol.c,
	* lib/libc/bsd/libc/stdlib/strtoul.c,
	* lib/libc/bsd/libc/string/strerror.c,
	* lib/libc/bsd/libc/stdio/vfprintf.c: Remove the special casing
	for integer division.

	* lib/mgos/posix-compat/exit.c,
	* tools/include/svp/abort.h: Ensure the global `__exit_code' is
	properly written to.

2016-11-21  Raphael 'kena' Poss  <knz@thaumogen.net>

	Small LEON2-MT startup fix.

	* tools/lib/mt/l2/slrt.s (__filler),
	* tools/lib/mt/l2mt/slrt.s (__filler): implement the filler using
	pre-assembled word values, so that slc/gas don't try to modify the
	code and thus break the alignment.

2016-11-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Configuration fixes for LEON2-MT.

	- on the FPGA board the PC start address can be 0x40000000 whereas
	it is 0x40000080 in simulation. Ensure that generated binaries can
	work on both.

	- the RAM size is 256KB in simulation, 128M on FPGA. This patch
	makes `slc' generate binaries that use the simulator RAM size by
	default. To make the binary use the entire RAM, use
	`-Wl,--defsym=_RAM_SIZE=128M-256K' when linking.

	* tools/lib/mt/l2/slrt.s (_start),
	* tools/lib/mt/l2mt/slrt.s (_start): Set the initial SP pointer to
	the end of the RAM area. Ensure that the filler bytes start
	with a useful instruction.

	* tools/lib/leon2mt-fpga/linkrom.in,
	* tools/lib/leon2mt-fpga/linkram.in: Set _RAM_SIZE as 256K away
	from whatever value is already set. Make the per-thread TLS space
	1KB again.

2016-11-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix a bug in the "small malloc()" implementation.

	* lib/mgos/smallmalloc/smallmalloc.c (small_malloc): Ensure that
	the size is always a multiple of 4 bytes. Also avoid aligning the
	HEAP pointer, as this is unneeded (the array being pointed to is
	already aligned by the linker).

2016-11-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix a FP-related code generation bug on LEON2-MT.

	* tools/bin/cce.in (slc_ppflags): alias sl_glfparm/sl_glfarg to
	sl_glparm/sl_glarg, since we are using soft float.

	* tools/slc/mt/leon2mt/gencreate.py
	(Create_2_L2MTCreate.visit_seta): Report a nice error message if
	no arguments were defined.

2016-11-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix a code generation bug on LEON2-MT.

	Prior to this patch every create would try to allocate all the
	physical threads, even if fewer were needed.

	* tools/slc/mt/leon2mt/gencreate.py
	(Create_2_L2MTCreate.visit_lowcreate): Ensure the `block'
	parameter is set to the number of threads if the default ("max")
	value is used.

2016-11-13  Alyssa Milburn  <amilburn@zall.org>

	LEON2-MT: add preliminary support for UART output.

	* tools/lib/mt/l2mt/init_uart.s,
	* tools/lib/mt/l2mt/putchar.s,
	* tools/lib/mt/l2mt/uart_defs.inc: New.

	* tools/lib/mt/l2/slrt.s,
	* tools/lib/mt/l2mt/slrt.s: Invoke the UART initialization
	routine.

	* tools/lib/leon2mt-fpga/leon2-common.mk: Include and build the
	new files.

	* lib/libc/stdio/mtstdio.h: Enable output to the UART via the FILE
	API.
	* lib/libc/stdio/mtstdio.c: Bind a new global FILE* object
	`stduart` to the UART.

2016-11-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	LEON2-MT/UT-LEON3: new code generation option.

	* tools/slc/mt/mtsparc/asmproc/opt.py (makedataflow): On UT-LEON3,
	we can't switch on a branch/delayed instruction that reads from a
	waiting register, in which case we must ensure that every register
	for which there is an uncertainy is full before the instruction is
	reached. Previously the code to do that was used always; with
	LEON2-MT this restriction is lifted so we now make this behavior
	conditional. The protection is now *disabled* by default and can
	be enabled from the command-line with
	`-fasmopt-flush-before-delayed'.

2016-11-13  Alyssa Milburn  <amilburn@zall.org>

	LEON2-MT: Use ASI 0x84, not 0x80.

	* tools/include/svp/abort.h,
	* tools/include/svp/testoutput.h,
	* tools/lib/mt/l2/slrt.s: Use ASI 0x84, not 0x80. This is needed
	because LEON2-FT ignores the upper 4 bits of the ASI and thus
	writes via ASI 0x80 would actually access memory.

2016-11-10  Alyssa Milburn  <amilburn@zall.org>

	Only clear (SPARC) annulled delay slots for unconditional
	branches, where the delay slot instruction will never be
	executed.

	* tools/slc/mt/mtsparc/asmproc/base.py: Only match b[n|a],a.

2016-11-07  Alyssa Milburn  <amilburn@zall.org>

	Suppress/redirect warnings when running LEON2-MT simulator.

	* tools/leon2mt-sim-ctl.in: Add info/warnings section, and
	try to redirect simulator debug/warning output there. Also,
	print last line before a failure, and wrap at 120 lines.

2016-11-07  Alyssa Milburn  <amilburn@zall.org>

	Avoid incorrect expansion of (early) escapes in source code.

	* tools/slc/input/cm4.py: Use raw strings to avoid backslash
	escapes being expanded.

2016-11-07  Alyssa Milburn  <amilburn@zall.org>

	Fix asm snippet for LEON2-MT thread creation (memargs offset).

	* tools/slc/mt/leon2mt/gencreate.py: remove 'wmb'.

2016-11-07  Alyssa Milburn  <amilburn@zall.org>

	Include COMMON section in BSS in LEON2-MT binaries.

	* tools/lib/leon2mt-fpga/linkram.in,
	* tools/lib/leon2mt-fpga/linkrom.in: include COMMON in BSS.

2016-11-01  Alyssa Milburn  <amilburn@zall.org>

	Fix overlooked perf sample function on LEON2/LEON2-MT.

	* lib/slsys/include/svp/perf.h (__inline_mtperf_sample1):
	Add support for reading LEON2/LEON2-MT counters.

2016-10-02  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix a MTSPARC/LEON2-MT optimization bug.

	* tools/slc/mt/mtsparc/regdefs.py (RegDefs.post_init_regmagic):
	Ensure that %r0 (phy zero register) is not part of the `allregs'
	array. This avoids considering it as potentially empty during
	computation of swch annotations.

2016-09-20  Raphael 'kena' Poss  <knz@thaumogen.net>

	Support new LEON2-MT performance counters.

	* tools/slc/mt/mtsparc/asmproc/opc/formats.db: New instruction
	format for `rd %wim, imm, reg'.
	* tools/slc/mt/mtsparc/asmproc/opc/mtsparc.py: Re-generate
	accordingly.
	* lib/slsys/include/svp/perf.h: Use it to extract the new LEON2-MT
	performance counters.
	* lib/slsys/perf/perf.c: Report the new counters too.

2016-09-17  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix the link on LEON2-MT/LEON2.

	* tools/lib/mt/l2/slrt.s,
	* tools/lib/mt/l2mt/slrt.s: new padding data.

	* tools/lib/leon2mt-fpga/linkram.in: Start the RAM at 0x40000000, and pad the initial 128 bytes.

2016-09-17  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix the RAM start address for LEON2/LEON2-MT.

	* tools/lib/leon2mt-fpga/linkram.in: Do it.

2016-09-16  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix a LEON2-MT code generation bug.

	* tools/slc/mt/leon2mt/asmproc/base.py (initspfp): Avoid using
	`killedsave' which is not defined any more.

2016-09-16  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix a code generation bug on LEON2.

	* tools/bin/cce.in: Ensure that the arch-specific compilation
	flags are enabled for LEON2, not just LEON2-MT.

2016-09-16  Raphael 'kena' Poss  <knz@thaumogen.net>

	Extend the library to better support LEON2.

	* lib/libc/bsd/libc/stdio/printfcommon.h,
	* lib/libc/bsd/libc/stdlib/strtol.c,
	* lib/libc/bsd/libc/stdlib/strtoul.c,
	* lib/libc/bsd/libc/string/strerror.c,
	* lib/mgos/posix-compat/exit.c,
	* tools/include/svp/divide.h: Test for `__slc_arch_leon2__' in
	addition to `__slc_arch_leon2mt__'.

2016-09-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Minor packaging fix.

	* lib/leon2mt-fpga/Makefile.am: Split common pieces to...
	* lib/leon2mt-fpga/leon2-common.mk: ...here. Add a missing
	reference to `math_private.h'.
	* lib/leon2-fpga/Makefile.am,
	* lib/leon2-fpga/Makefile.am: Use the new file.

2016-09-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Minor packaging fix.

	* tools/lib/leon2mt-fpga/leon2-common.mk (LIBSLC_SRC): List the
	missing files from `soft-fp/'.

2016-09-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Minor packaging fix.

	* tools/lib/leon2mt-fpga/leon2-common.mk (LIBSLC_SRC): List
	`fp-bit.h' too.

2016-09-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix `svp_abort()' and its uses on LEON2.

	* tools/include/svp/abort.h: Avoid using `t_end' directly. Instead
	jump to `__stop'.

	* tools/lib/mt/l2/slrt.s,
	* tools/lib/mt/l2mt/slrt.s: Define `__stop'.

2016-09-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Bootstrap the perf code on LEON2/LEON2-MT.

	* lib/libc/include/time.h: Use the %wim register to obtain the
	cycle counter on LEON2/LEON2-MT.
	* lib/slsys/include/svp/perf.h: Use `clock()' as only metric for
	LEON2/LEON2-MT.

	* lib/slsys/perf/perf.c: Adjust accordingly.

	* lib/leon2mt-fpga/Makefile.am: Ensure that `mtclock.c' is linked
	in, so that the function remains available even if inline versions
	are disabled.

2016-09-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix a bug with `slr -p' for LEON2/LEON2-MT.

	* tools/r-leon2mt-fpga.sh.in: Resolve the path to `tbdef' before
	checking whether it exists. This ensures that relative paths are
	properly looked up from `$SLR_ORIGPWD'.

2016-09-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Fix a RAM initialization bug.

	* tools/lib/leon2mt-fpga/linkrom.in: Define `_bss_end'.
	* tools/lib/mt/l2mt/bootstrap.c (__copyram): Ensure that the BSS
	section is always initialized.

2016-09-13  Raphael 'kena' Poss  <knz@thaumogen.net>

	Add support for compiling and running plain LEON2 programs.

	Also enable running programs both from embedded BRAM or DDR.

	* tools/bin/cce.in: New alias `leon2_s' for `spr-l2mtseq_naked-leon2-fpga'.
	Define corresponding env vars for external tools. Extend the rules for
	defining the toolchain for the new arch string `leon2'.

	* tools/lib/leon2mt-fpga/linkram: New.
	* tools/lib/leon2mt-fpga/Makefile.am: List and generate `linkram'.
	* tools/bin/cce.in: Use it.

	* tools/lib/mt/l2/slrt.s,
	* tools/lib/leon2-fpga/Makefile.am: New.
	* tools/lib/Makefile.am: List the new sub-dir.
	* tools/lib/configure.ac: Generate the new Makefile.

	* tools/lib/leon2mt-fpga/Makefile.am: Move common definitions to...
	* tools/lib/leon2mt-fpga/leon2-common.mk: ...here.
	* tools/lib/leon2-fpga/Makefile.am: Reuse them.

	* tools/r-leon2mt-fpga.sh.in: Alias ddr.dat to rom.dat. (May need
	later to generate one or the other).
	* tools/runscripts.mk: Generate `r-leon2-fpga.sh' as alias to
	`r-leon2mt-fpga.sh'.

	* lib/leon2-fpga/Makefile.am: New.
	* lib/Makefile.am: List the new sub-dir.
	* lib/configure.ac: Generate the new Makefile.

2016-08-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a bootstrap issue on LEON2-MT.

	* tools/lib/mt/l2mt/bootstrap.c: Avoid copying if the data already
	sits in the right place.

2016-08-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix `slr' for LEON2-MT.

	* tools/leon2mt-sim-ctl.in: Fix the handling of undefined values
	in the pipeline.

2016-08-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Work around a pipeline bug in LEON2-MT.

	* tools/lib/mt/l2mt/slrt.s (_start): Ensure that %o0-%o2 are ready
	for use before entering main, which may not use its arguments and
	reuse the regs before the loads are complete.

2016-08-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Ensure mem* functions are available in libslc early for LEON2-MT.

	* tools/lib/leon2mt-fpga/Makefile.am (LIBSLC_SRC): List them
	here. This is redundant with `libc.a' but the linker will sort it
	out. We need the functions early because the Soft-FP emulation
	code uses them.

2016-08-24  Alyssa Milburn  <amilburn@zall.org>

	Add soft-fp support for LEON2-MT.

	* lib/leon2mt-fpga/Makefile.am: Build libm, with sqrtf/roundf.
	* lib/libc/math/e_sqrtf.c,
	* lib/libc/math/s_roundf.c: Add (modified from musl).
	* lib/libc/math/math_private.h: Add minimal math_private.h for libm.
	* tools/bin/cce.in: Add soft-fp gcc flag.
	* tools/lib/leon2mt-fpga/Makefile.am: Build soft-fp files.
	* tools/lib/common/libgcc/soft-fp/sfp-machine.h: Add modified libgcc
	sfp-machine.h.
	* tools/lib/common/libgcc/clzsi2.c,
	* tools/lib/common/libgcc/ctzsi2.c: Add clzsi2 and ctzsi2 functions
	extracted from libgcc.
	* tools/lib/common/libgcc/fp-bit.c,
	* tools/lib/common/libgcc/fp-bit.h,
	* tools/lib/common/libgcc/soft-fp/soft-fp.h,
	* tools/lib/common/libgcc/soft-fp/longlong.h,
	* tools/lib/common/libgcc/soft-fp/op-1.h,
	* tools/lib/common/libgcc/soft-fp/op-2.h,
	* tools/lib/common/libgcc/soft-fp/op-4.h,
	* tools/lib/common/libgcc/soft-fp/op-8.h,
	* tools/lib/common/libgcc/soft-fp/op-common.h: Add soft-fp support
	from libgcc.

2016-08-24  Alyssa Milburn  <amilburn@zall.org>

	Include abort() in libslc.

	* lib/mgos.mk: Remove abort.c.
	* tools/lib/mt.mk: Add abort.c.
	* lib/mgos/posix-compat/abort.c: Move..
	* tools/lib/common/abort.c: .. to here.

2016-08-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Remove `dlmalloc' from LEON2-MT targets.

	.. since it does not have all necessary dependencies anyways.

	* lib/leon2mt-fpga/Makefile.am: Do it.

2016-08-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Implement a simple global heap for LEON2-MT.

	* lib/mgos/smallmalloc/smallmalloc.c,
	* lib/smallmalloc.mk: New.
	* lib/leon2mt-fpga/Makefile.am: Do not use `tlsmalloc'. Use
	`smallmalloc' instead.

	* tools/lib/leon2mt-fpga/linkrom.in: Ensure the RAM section is big
	enough for a heap.

2016-08-02  Alyssa Milburn  <amilburn@zall.org>

	Add wrapper functions which provide integer division, as called
	by the gcc code generator, and force them to be called.

	* tools/bin/cce.in: Always pass integer division flag to gcc.
	* tools/lib/common/divide.c: Add wrapper functions.

2016-07-28  Raphael 'kena' Poss  <r.poss@uva.nl>

	Minor build fix.

	* tools/include/svp/testoutput.h,
	* tools/include/svp/abort.h: Ensure the code still compiles for UTLEON3.

2016-07-14  Alyssa Milburn  <amilburn@zall.org>

	Copy LEON2-MT data segment starting from the (aligned) end of the
	text data, not the end of the text segment.

	* tools/lib/mt/l2mt/bootstrap.c: Use correct value for src.

2016-07-14  Alyssa Milburn <amilburn@zall.org>

	Remove pure attribute from non-pure divide functions.

	* tools/lib/include/svp/divide.h: Removed attributes.

2016-07-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Packaging fix.

	* tools/leon2mt-sim-ctl.in: Properly check in the file.

2016-06-29  Raphael 'kena' Poss  <r.poss@uva.nl>

	New code generation option for LEON2-MT.

	* tools/slc/mt/mtsparc/asmproc/base.py (fillannulnop): Allow the
	user to disable this fix using `slc
	-fno-asmfix-clear-annuled-delay-slots'.

2016-06-27  Raphael 'kena' Poss  <r.poss@uva.nl>

	Packaging fix.

	* tools/runscripts.mk (COMMON_SUBST): Properly substitute
	`slc_libdir'.

2016-06-27  Raphael 'kena' Poss  <r.poss@uva.nl>

	Packaging fix.

	* lib/leon2mt-fpga/Makefile.am (*_libsl_a_DEPENDENCIES): Ensure
	the dependencies refer to the proper source variables.

2016-06-27  Raphael 'kena' Poss  <r.poss@uva.nl>

	Enhance the interface with the LEON2-MT RTL simulator.

	* tools/slc/mt/mtsparc/asmproc/opc/decode.py: Support the assembly
	syntax for address space identifiers (ASIs).
	* tools/slc/mt/mtsparc/asmproc/opc/mtsparc.py: Regenerate.

	* tools/include/svp/abort.h,
	* tools/include/svp/testoutput.h: Use a new ASI-based output
	protocol.
	* tools/lib/mt/l2mt/slrt.s,
	* tools/lib/mt/l2mt/dbgout.c: Simplify accordingly.

	* tools/r-leon2mt-fpga.sh.in,
	* tools/leon2mt-sim-ctl.in: New.
	* tools/runscripts.mk: List the new files; generate their derived
	targets.

	* tools/bin/slr.in: Export the original PWD for use by runner
	scripts.

2016-06-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Polish the linking and loading process for LEON2-MT.

	* tools/lib/leon2mt-fpga/linkrom.in: New (linker script).
	* tools/lib/leon2mt-fpga/Makefile.am (nobase_sllib_DATA): List it.
	* tools/lib/configure.ac: Generate it.
	* tools/bin/cce.in: Use it.

	* tools/lib/mt/l2mt/bootstrap.c: New. This copies the data section
	to RAM.
	* tools/lib/leon2mt-fpga/Makefile.am (LIBSLC_SRC): List it.
	* tools/lib/mt/l2mt/slrt.s (_start): Use it.

2016-06-19  Raphael 'kena' Poss  <r.poss@uva.nl>

	Introduce software division routines for LEON2-MT.

	* tools/lib/include/svp/divide.h: New.
	* tools/slc.mk (nobase_dist_pkgdata_DATA): List the new file.

	* tools/lib/common/divide.c: New.
	* tools/lib/mt.mk (LIBSLC_SRC),
	* tools/lib/host.mk (LIBSLC_SRC): List the new file.

	* tools/lib/include/svp/testoutput.h: Use the new division
	functions when compiling for LEON2-MT. Declare the functions as
	`gnu_inline' to merge the instances during linking.

	* tools/lib/common/testoutput.c: New.
	* tools/lib/leon2mt-fpga/Makefile.am: List the new file.

	* lib/libc/bsd/libc/stdio/printfcommon.h,
	* lib/libc/bsd/libc/stdlib/strtol.c,
	* lib/libc/bsd/libc/stdlib/strtoul.c,
	* lib/libc/bsd/libc/string/strerror.c,
	* lib/libc/misc/rand.c,
	* lib/libc/stdio/fwrite.c,
	* lib/slsys/perf/perf.c: Modify to use the new division functions.

	* tools/include/svp/abort.h: Avoid a circular dependency with
	`divide.h' and `testoutput.h'.

2016-06-19  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix/extend the sequential execution targets for LEON2-MT.

	* slc/lib/leon2mt-fpga/Makefile.am,
	* tools/lib/leon2mt-fpga/Makefile.am: The sub-directory is called
	`l2mtseq_naked', not `seq_naked'.

	* tools/bin/cce.in: New alias `seqc_l2mt'.

	* tools/lib/host-host-l2mtseq/Makefile.am: New.
	* tools/lib/Makefile.am,
	* tools/lib/configure.ac: Add the new sub-target.

	* slc/lib/host-host-l2mtseq/Makefile.am: New.
	* slc/lib/Makefile.am,
	* slc/lib/configure.ac: Add the new sub-target.

2016-06-19  Raphael 'kena' Poss  <r.poss@uva.nl>

	Various LEON2-MT code generation fixes.

	* tools/slc/mt/leon2mt/seq.py (Create_2_L2MTLoop.visit_lowcreate):
	Increase bx in the inner sequential loop, not by.

	* tools/slc/mt/leon2mt/asmproc/opt.py: Remove `remdefaults' from
	the chain, since LEON2-MT does not initialize family entries at
	this point.

	* tools/slc/mt/leon2mt/gencreate.py
	(Create_2_L2MTCreate.visit_seta): Ensure that the global register
	offsets are properly computed.
	(Create_2_L2MTCreate.visit_lowcreate): Mark `allochtg' as volatile
	to prevent the compiler from re-ordering it.

2016-06-18  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a bug in LEON2-MT code generation.

	* tools/slc/mt/leon2mt/gencreate.py
	(Create_2_L2MTCreate.visit_lowcreate): Ensure the gmask is
	computed according to SPEC.

2016-06-18  Raphael 'kena' Poss  <r.poss@uva.nl>

	Reduce the TLS area for LEON2-MT binaries.

	* tools/lib/mt/l2mt/slrt.s: Hardware supports up to 32 threads at
	this point, not 256.

2016-06-18  Raphael 'kena' Poss  <r.poss@uva.nl>

	Enhance the layout of generated LEON2-MT binaries.

	* tools/bin/cce.in: Make the .init section start at address 0, so
	that `_start' gets there too.

2016-05-15  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a bug in the LEON2-MT bootstrap code.

	* tools/lib/mt/l2mt/slrt.s: Ensure that control bits are generated.

2016-05-15  Raphael 'kena' Poss  <r.poss@uva.nl>

	Kill some compiler warnings.

	* tools/include/svp/compiler.h,
	* lib/mgos/tlsmalloc/tricks.h: Use the `inline' keyword
	so that GCC avoids complaining the function may not be inlinable.

2016-05-15  Raphael 'kena' Poss  <r.poss@uva.nl>

	Extend the library support for LEON2-MT.

	* lib/leon2mt-fpga/Makefile.am: New.
	* lib/configure.ac,
	* lib/Makefile.am: List the new sub-directory.

	* lib/common.mk: Really remove the long-deprecated `io.c' and
	`div.c' from the standard build.

	* lib/libc/malloc/malloc_excl.c,
	* lib/libc/malloc/mtmalloc.h,
	* lib/libc/bsd/contrib/gdtoa/misc.c,
	* lib/libc/bsd/libc/stdio/vfprintf.c: Avoid compiling exclusive
	delegates on LEON2-MT.

	* lib/libc/include/assert.h: Avoid using a comma expression since
	`svp_abort()' may be a statement.

	* lib/libc/include/limits.h,
	* lib/libc/include/stddef.h,
	* lib/libc/include/stdint.h,
	* lib/libc/include/time.h: Support LEON2-MT.

	* lib/mgos/tlsmalloc/tls_arch_leon2mt_fpga.h: New.
	* lib/mgos/tlsmalloc/tlsconfig.h: Make the slot size smaller.
	* lib/mgos/tlsmalloc/tlsmalloc.c: Avoid emitting MGSim debug output.
	* lib/mgos/tlsmalloc/Makefile.am: List the new file.

	* lib/mgos/posix-compat/exit.c: Use the new interface (although
	this code is not yet linked in).

2016-05-15  Raphael 'kena' Poss  <r.poss@uva.nl>

	Preliminary library support for LEON2-MT.

	* tools/lib/mt/l2mt/slrt.s: New.
	* tools/include/svp/testoutput.h: On LEON2-MT, only use byte
	output. This requires to resurrect some code (borrowed from
	`lib/slsys/deprectated/io.c') to print numbers.
	* tools/lib/mt/l2mt/dbgout.c: Declare the global symbols that will
	serve as interface for debug output.

	* tools/lib/leon2mt-fpga/Makefile.am: New. List the new files.
	* tools/lib/configure.ac,
	* tools/lib/Makefile.am: List the new sub-directory.

	* tools/include/svp/abort.h: Adapt for use with LEON2-MT.
	* tools/lib/mt/mgsim.c: Only include code when not compiling for
	MGSim.

2016-05-15  Raphael 'kena' Poss  <r.poss@uva.nl>

	Miscellaneous LEON2-MT code generation improvements.

	* tools/slc/mt/leon2mt/asmproc/base.py (_cfilter_inner)
	(_filter_inner): Ensure that delayed "annul" slots are nops.

	* tools/slc/mt/leon2mt/gencreate.py
	(Create_2_L2MTCreate.visit_lowcreate): Support detached and
	spawned families. Ensure there is a `nop' between `fence' and
	`wait'.

	* tools/slc/front/chains.py: Add the spawn visitors to the
	LEON2-MT chains.

2016-05-08  Raphael 'kena' Poss  <r.poss@uva.nl>

	Packaging fix.

	* tools/slc.mk (nobase_python_PYTHON): List the new files.

2016-05-08  Raphael 'kena' Poss  <r.poss@uva.nl>

	Optimize further for LEON2-MT assembly.

	* tools/slc/mt/common/asmproc/remdefaults.py (remdefaults): Also
	recognize the LEON2-MT mnemonics for default elimination.

	* tools/slc/mt/leon2mt/asmproc/base.py (xjoin2): Annotate
	the layout parameters in a parseable comment.
	* tools/slc/mt/leon2mt/asmproc/base.py (scanparams, replparams)
	(_filter_end): Implement a two-pass traversal of the assembly code
	to gather the layout parameters for all functions and then
	optimize `t_allochtg' accordingly.

2016-05-08  Raphael 'kena' Poss  <r.poss@uva.nl>

	Compile for small code by default on LEON2-MT.

	* tools/bin/cce.in: Default to `-Os' when compiling for LEON2-MT.
	* tools/slc/mt/leon2mt/asmproc/base.py (ctlbits): Force function
	alignment, since `-Os' will disable the command-line flag to set it.

2016-05-07  Raphael 'kena' Poss  <r.poss@uva.nl>

	Initial support for family creation on LEON2-MT.

	Items worthy of interest:
	- LEON2-MT uses unsigned range parameters for families.
	- LEON2-MT uses 4-dimensional indexing.
	- The MT `start' parameter is ignored; `limit' sets the
	block size, `step' sets the grid size.
	- `sl_index' causes the appearance of CUDA-like thread/block/grid
	range variables `threadIdx', `blockIdx', `blockDim', `gridDim'.

	* tools/slc/lower/seq.py: Ensure that the visitor attributes are
	not hidden (prefixed with `__'), so that the visitors can be
	derived.
	* tools/slc/mt/leon2mt/seq.py: New, deriving the visitor in
	`lower/seq.py'. This implements 4-dimensional indexing, assumes
	the range parameters are declared unsigned.
	* tools/slc/lower/lowercreate.py: Introduce a new constructor
	parameter for `Create_2_LowCreate' to indicate whether range
	parameters should be declared signed or unsigned.
	* tools/slc/front/chains.py: Pass the parameter to
	`Create_2_LowCreate' in `_common_prefix'. Adapt all chains
	accordingly. Use the new sequential flattener for the LEON2-MT
	targets. Create a new `l2mtseq' target for LEON2-MT's special
	"naked seq" mode.
	* tools/bin/cce.in: Adapt the `l2mt_s' target alias to use the new
	spr `l2mtseq' target.

	* tools/slc/mt/leon2mt/gencreate.py: Preliminary support for
	LEON2-MT creation.
	* tools/slc/mt/front/chains.py: Remove the now-irrelevant
	constructor parameter `newisa' for the create transformer.
	* tools/bin/cce.in: Disable placement strategy computations when
	compiling for LEON2-MT, since LEON2-MT is not multi-core yet.

	* tools/slc/mt/leon2mt/gentfun.py,
	* tools/slc/mt/leon2mt/seq.py: Automatically instantiate
	`threadIdx', `blockIdx', `blockDim', `gridDim' upon `sl_index'.

2016-05-07  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix some LEON2-MT instruction formats.

	* tools/slc/mt/mtsparc/asmproc/opc/formats.db,
	* tools/slc/mt/mtsparc/asmproc/opc/mtsparc.py: Update the formats
	for `f_mapg', `f_maphtg', `r_allocsrb' and `t_allochtg'.

2016-05-07  Raphael 'kena' Poss  <r.poss@uva.nl>

	Polish the assembly post-processing for LEON2-MT.

	* tools/slc/mt/common/gentfun.py: Declare the initial `__slI'
	index holders as `unsigned' if the concrete visitor demands so.
	* tools/slc/mt/leon2mt/gentfun.py: New; derive from the MT-SPARC
	code, and add a 2-dimensional threadIdx definition. Demand `__slI'
	to be unsigned.
	* tools/slc/mt/leon2mt/gencreate.py: New; simply copy from
	MT-SPARC. Still needs to be re-written.
	* tools/slc/front/chains.py: Use the two new classes for the
	`l2mt' chains.

	* tools/slc/mt/mtsparc/asmproc/base.py (grouper): initialize
	`prologue' and `pprologue'.
	* tools/slc/mt/common/asmproc/regextract.py (regextract): mark the
	position of the removed `.registers' directive.
	* tools/slc/mt/mtsparc/asmproc/base.py (xsplit): Actually extract
	the function prologue, using the marked position of `.registers'
	as final boundary.
	* tools/slc/mt/mtsparc/asmproc/base.py (detectregs): Detect
	register usage also in the prologue (now that there is one) and
	mark SP adjustements.
	* tools/slc/mt/mtalpha/asmproc/base.py (avoidframespills): Ensure
	that any spaces are valid in the frame spill regexp, since SPARC
	uses tabs.
	* tools/slc/mt/leon2mt/asmproc/base.py (_filter_inner): Import the
	filters `avoidframespills' and `killspadjusts' from the `mtalpha'
	target and use them to remove unnecessary SP traffic from the prologue.
	* tools/slc/mt/leon2mt/asmproc/base.py (munchret, killrasave):
	New. More cleanup of the function prologue and also epilogue
	(frame activity just before `ret').
	* tools/slc/mt/leon2mt/asmproc/base.py (killnoregs): Remove the
	`.noregisters' directive potentially added by the `mtsparc' filters.
	* tools/slc/mt/leon2mt/asmproc/base.py (initspfp): Import and
	modify from the `mtsparc' target to use the new ISA.

	* tools/slc/mt/mtsparc/asmproc/base.py (replacebreakend): Update
	the special MT mnemonics `end' and `break' to the new ISA format.

	* tools/slc/mt/mtsparc/asmproc/base.py (ctlbits): Ensure that all
	procedures are emitted with control bits.

2016-05-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Preliminary support for the LEON2-MT ISA.

	* tools/slc/mt/mtsparc/asmproc/opc/formats.db,
	* tools/slc/mt/mtsparc/asmproc/opc/mtsparc.py: Update to support
	the new LEON2-MT mnemonics.

2016-05-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Initial support for LEON2-MT targets.

	* tools/bin/cce.in: Recognize `l2mt' targets.

	* build-aux/mgbinutils.m4: Search for the SPARC binary utilities.
	* build-aux/mgsim.m4: Search for the LEON2-MT MGSim.
	* build-aux/slctests.mk,
	* build-aux/sl.mk: Also build for `l2mt'.
	* configure.ac,
	* build-aux/slc.m4: Add flags to support `leon2mt' targets.
	* build-aux/slctests.m4: Check whether the LEON2-MT targets are
	being built.

	* tools/bin/Makefile.am: Substitute the tool paths for LEON2-MT.
	* tools/bin/cce.in: Preliminary support for various LEON2-MT targets.
	* tools/slc/front/chains.py: Define LEON2-MT chains based on
	existing SPARC chains.

	* tools/slc/mt/leon2mt/__init__.py,
	* tools/slc/mt/leon2mt/asmproc/__init__.py: New.
	* tools/slc/mt/leon2mt/compile.py,
	* tools/slc/mt/leon2mt/asmproc/base.py,
	* tools/slc/mt/leon2mt/asmproc/opt.py,
	* tools/slc/mt/leon2mt/regdefs.py: Initial implementation, based
	on the existing SPARC targets.

2016-01-01  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a MT-SPARC code generation bug.

	* tools/slc/mt/mtsparc/asmproc/base.py (markaligned): Only
	consider lines for which instruction metadata is available.

2016-01-01  Raphael 'kena' Poss  <r.poss@uva.nl>

	Assembly portability fix.

	* tools/include/svp/compiler.h: Ensure that the no-op inline
	assembly expansions always use the correct comment prefix.

2015-07-26  Raphael 'kena' Poss  <r.poss@uva.nl>

	Minor documentation updates.

	* doc/README.rst: Recommend using the SL installer.
	* doc/HACKING.rst: Do not mention `svn' any more.

2015-07-26  Raphael 'kena' Poss  <r.poss@uva.nl>

	Update the documentation for version 3.9.

	* doc/NEWS.rst: Do it.

2015-07-26  Raphael 'kena' Poss  <r.poss@uva.nl>

	Update the MT Gfx library code to the new MGSim 3.5 interface.

	* lib/mgos/gfx/mtgfx.c: Use the new command queue interface from
	MGSim 3.5. User programs are unaffected.

2015-07-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a code generation bug for MT-SPARC.

	This fixes the erroneous renaming/compression of reg windows
	containing floats that are operands of double-float operations
	(incl. `ldd' but also `faddd' etc.).

	* tools/slc/mt/mtsparc/asmproc/opc/decode.py: Properly mark the
	double-float instructions as updating a double operand.

	* tools/slc/mt/mtsparc/asmproc/opc/mtsparc.py: Update the
	generated file.

	* tools/slc/mt/mtsparc/asmproc/base.py: Use this information to
	mark the 2nd register of double-sized operands as used.

2015-07-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a code generation bug for MT-SPARC.

	* tools/slc/mt/mtsparc/regdefs.py: There are up to 23 local
	integer registers, not 24 (%g0 doesn't count).
	* tools/slc/mt/common/compress.py: There may be up to 32 FP
	locals to compress. In general it is a good idea to scan all
	32 register positions, not only the first 31, so as not to assume
	the ISA always has special register indices.

2015-07-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a code generation bug for MT-SPARC.

	* tools/slc/mt/mtsparc/gencreate.py: Ensure the right type name is
	used to define the pointer for memory-passed global arguments.

2015-07-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Simplify the MIPSel crt.

	* tools/lib/mt/mipsel/slrt.s: Remove the unused definition of
	`__stack'.

2015-07-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix the declaration of library functions on MT targets.

	* lib/libc/include/stdlib.h: Fix the prototype for `strtold'. Add
	the missing prototypes for `strtod' and `strtof'.

2015-07-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Add missing objects to the SL library of host targets.

	* lib/host-host-seqc/Makefile.am,
	* lib/host-host-ptld/Makefile.am,
	* lib/host-host-ptl/Makefile.am,
	* lib/host-host-hlsim/Makefile.am,
	* lib/host-host-hlsimd/Makefile.am: Use `LIBSL_SRC' to ensure the
	legacy SL library modules (incl. roman) are available in the
	produced library.

2015-07-25  Raphael 'kena' Poss  <r.poss@uva.nl>

	Enhance the usability of derived packages.

	* build-aux/sl.mk: Simplify the target generation rules. This also
	enables parallel builds of different targets.

2015-07-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a minor MT-SPARC code generation bug.

	* tools/slc/mt/mtsparc/asmproc/base.py (replsave): The removed
	instructions must be of type `empty' to appear in the output
	properly.

2015-07-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix an initialization bug on MT-SPARC.

	The reserved space for the stack on the initial thread
	(__tls_base) must be aligned on a 1024 byte boundary, because we
	want to only use `sethi' to compute a base pointer.

	* tools/lib/mt/mts/slrt.s: Do it.

2015-07-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a MT-SPARC code generation bug.

	* tools/include/svp/compiler.h: The comment syntax in SPARC
	assembly starts with a "!", not "#". A "#" confuses the assembly
	post-processor to generate a misplaced `swch'.

2015-07-24  Raphael 'kena' Poss  <r.poss@uva.nl>

	Enhance portability of derived packages.

	* build-aux/slc.m4: Capture the environment's PYTHONPATH during
	`configure' runs. This is needed when ancillary modules
	(eg. docutils) are installed in non-standard locations.

2015-07-23  Raphael 'kena' Poss  <r.poss@uva.nl>

	Increase the library compatibility with MIPS* targets.

	As the MIPS* back-end does not yet support FP, try to reduce uses
	of FP in the library.

	* lib/slsys/perf/perf.c: Derive computed values as integers, not
	floats.

2015-07-23  Raphael 'kena' Poss  <r.poss@uva.nl>

	Cosmetic fixes in the output of `slt'.

	* tools/bin/slt.in: Avoid reporting "left over" messages for
	unmatched glob patterns.

2015-07-23  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a linker error on the MIPS* targets.

	* tools/bin/cce.in (slc_ldflags): Avoid setting a base address for
	section `text'. Otherwise the test suite reveals ld fails due to
	`.reginfo' overlapping with `.bss'.

2015-03-28  Raphael 'kena' Poss  <r.poss@uva.nl>

	Implement srand(), rand() and {,l,ll}abs() in the libc.

	* lib/libc/misc/rand.c: New.
	* lib/libc/bsd/libc/stdlib/abs.c,
	* lib/libc/bsd/libc/stdlib/labs.c,
	* lib/libc/bsd/libc/stdlib/llabs.c: Import from FreeBSD.
	* lib/libc/include/stdlib.h: Declare the new functions.
	* lib/libc.mk (libc_a_SOURCES): List the new files.

2015-03-28  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix the POSIX read/write emulation.

	The MGSim interface only supports a fixed/limited buffer size for
	RPC operations. The read/write code would blindly pass the
	user-provided size to the MGSim RPC interface, resulting in short
	reads/writes when the specified size exceeded the MGSim buffer
	size.  This patch fixes this issue by introducing a loop in the
	read/write wrappers, that splits the I/O request into 512-byte
	chunks guaranteed to fit the MGsim buffer.

	* lib/mgos/posix-compat/mtunix.c (read, write): Do it.

2013-08-17  Raphael 'kena' Poss  <r.poss@uva.nl>

	Report time to completion when main() returns.

	* lib/mgos/init/mtinit.c (sys_init, sys_cleanup): Measure and
	report the execution time.
	* tools/lib/host/load.c,
	* tools/lib/mt/mta/slrt.s,
	* tools/lib/mt/mts/slrt.s,
	* tools/lib/mt/mipsel/slrt.s: Ensure `sys_cleanup' is called.

2013-08-17  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix an MT initialization bug.

	The bug was introduced in January 2013
	(ef5194dcd8158392d18590b254e1df0d91f327c3) when dropping support
	for slr variables.

	* tools/lib/host/load.c,
	* tools/lib/host/slrt.c: Declare `slr_init' with two arguments,
	not three.

2013-08-17  Raphael 'kena' Poss  <r.poss@uva.nl>

	Enhance the handling of MT profiles.

	* tools/bin/slr.in: Ensure that `SIMPROFILE' is defined before
	loading the profile, because it might use the variable.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Update the documentation for version 3.8b.

	* doc/NEWS.rst: Do it.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a MT-SPARC code generation bug.

	* tools/slc/mt/mtsparc/gencreate.py: Fix typo: `fputg', not `pfutg'.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Extend the library support with `getopt'.

	Since the "slr vars" mechanism is now unavailable, `getopt'
	becomes a welcome addition to the MT library. The support
	added in this patch is not thread-safe!

	* lib/libc/include/unistd.h: Declare `getopt' and friends.
	* lib/libc/bsd/stdlib/getopt.c: Import from FreeBSD.
	* lib/libc.mk: List and distribute it.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Improve the library support for MT-SPARC.

	* lib/mtsparc-sim/libgcc.a: Import from GCC 4.7.1. This was built
	by configuring gcc for `sparc-linux-gnu', then manually editing
	`sparc-linux-gnu/libgcc/Makefile' in the build tree to use `slc -b
	mtsn_s' as code generator. Also the flags `-fbuilding-libgcc',
	`-g' and `-fPIC' need to be removed.

	* lib/libc/math/mtsparc/acosf.o, lib/libc/math/mtsparc/acoshf.o,
	lib/libc/math/mtsparc/asinf.o, lib/libc/math/mtsparc/asinhf.o,
	lib/libc/math/mtsparc/atan2f.o, lib/libc/math/mtsparc/atanf.o,
	lib/libc/math/mtsparc/atanhf.o, lib/libc/math/mtsparc/cabsf.o,
	lib/libc/math/mtsparc/carg.o, lib/libc/math/mtsparc/cargf.o,
	lib/libc/math/mtsparc/cbrtf.o, lib/libc/math/mtsparc/ceilf.o,
	lib/libc/math/mtsparc/copysignf.o, lib/libc/math/mtsparc/cosf.o,
	lib/libc/math/mtsparc/coshf.o, lib/libc/math/mtsparc/e_acos.o,
	lib/libc/math/mtsparc/e_acosh.o, lib/libc/math/mtsparc/e_asin.o,
	lib/libc/math/mtsparc/e_atan2.o, lib/libc/math/mtsparc/e_atanh.o,
	lib/libc/math/mtsparc/e_cosh.o, lib/libc/math/mtsparc/e_exp.o,
	lib/libc/math/mtsparc/e_fmod.o, lib/libc/math/mtsparc/e_gamma.o,
	lib/libc/math/mtsparc/e_gamma_r.o,
	lib/libc/math/mtsparc/e_hypot.o, lib/libc/math/mtsparc/e_j0.o,
	lib/libc/math/mtsparc/e_j1.o, lib/libc/math/mtsparc/e_jn.o,
	lib/libc/math/mtsparc/e_lgamma.o,
	lib/libc/math/mtsparc/e_lgamma_r.o, lib/libc/math/mtsparc/e_log.o,
	lib/libc/math/mtsparc/e_log10.o, lib/libc/math/mtsparc/e_log2.o,
	lib/libc/math/mtsparc/e_pow.o, lib/libc/math/mtsparc/e_rem_pio2.o,
	lib/libc/math/mtsparc/e_remainder.o,
	lib/libc/math/mtsparc/e_scalb.o, lib/libc/math/mtsparc/e_sinh.o,
	lib/libc/math/mtsparc/e_sqrt.o, lib/libc/math/mtsparc/erfcf.o,
	lib/libc/math/mtsparc/erff.o, lib/libc/math/mtsparc/exp2f.o,
	lib/libc/math/mtsparc/expf.o, lib/libc/math/mtsparc/expm1f.o,
	lib/libc/math/mtsparc/fabsf.o, lib/libc/math/mtsparc/fdimf.o,
	lib/libc/math/mtsparc/floorf.o, lib/libc/math/mtsparc/fmaf.o,
	lib/libc/math/mtsparc/fmaxf.o, lib/libc/math/mtsparc/fminf.o,
	lib/libc/math/mtsparc/fmodf.o, lib/libc/math/mtsparc/frexpf.o,
	lib/libc/math/mtsparc/hypotf.o, lib/libc/math/mtsparc/ilogbf.o,
	lib/libc/math/mtsparc/k_cos.o, lib/libc/math/mtsparc/k_rem_pio2.o,
	lib/libc/math/mtsparc/k_sin.o, lib/libc/math/mtsparc/k_standard.o,
	lib/libc/math/mtsparc/k_tan.o, lib/libc/math/mtsparc/ldexpf.o,
	lib/libc/math/mtsparc/lgammaf.o, lib/libc/math/mtsparc/llrintf.o,
	lib/libc/math/mtsparc/llroundf.o, lib/libc/math/mtsparc/log10f.o,
	lib/libc/math/mtsparc/log1pf.o, lib/libc/math/mtsparc/log2f.o,
	lib/libc/math/mtsparc/logbf.o, lib/libc/math/mtsparc/logf.o,
	lib/libc/math/mtsparc/lrintf.o, lib/libc/math/mtsparc/lroundf.o,
	lib/libc/math/mtsparc/modff.o, lib/libc/math/mtsparc/nan.o,
	lib/libc/math/mtsparc/nearbyintf.o,
	lib/libc/math/mtsparc/nextafterf.o, lib/libc/math/mtsparc/powf.o,
	lib/libc/math/mtsparc/remainderf.o,
	lib/libc/math/mtsparc/remquof.o, lib/libc/math/mtsparc/rintf.o,
	lib/libc/math/mtsparc/roundf.o, lib/libc/math/mtsparc/s_asinh.o,
	lib/libc/math/mtsparc/s_atan.o, lib/libc/math/mtsparc/s_cbrt.o,
	lib/libc/math/mtsparc/s_ceil.o,
	lib/libc/math/mtsparc/s_copysign.o, lib/libc/math/mtsparc/s_cos.o,
	lib/libc/math/mtsparc/s_erf.o, lib/libc/math/mtsparc/s_expm1.o,
	lib/libc/math/mtsparc/s_fabs.o, lib/libc/math/mtsparc/s_fdim.o,
	lib/libc/math/mtsparc/s_finite.o,
	lib/libc/math/mtsparc/s_finitef.o,
	lib/libc/math/mtsparc/s_floor.o, lib/libc/math/mtsparc/s_fma.o,
	lib/libc/math/mtsparc/s_fmax.o, lib/libc/math/mtsparc/s_fmin.o,
	lib/libc/math/mtsparc/s_fpclassify.o,
	lib/libc/math/mtsparc/s_fpclassifyf.o,
	lib/libc/math/mtsparc/s_frexp.o, lib/libc/math/mtsparc/s_ilogb.o,
	lib/libc/math/mtsparc/s_isinf.o, lib/libc/math/mtsparc/s_isinff.o,
	lib/libc/math/mtsparc/s_isnan.o, lib/libc/math/mtsparc/s_isnanf.o,
	lib/libc/math/mtsparc/s_ldexp.o,
	lib/libc/math/mtsparc/s_lib_version.o,
	lib/libc/math/mtsparc/s_llrint.o,
	lib/libc/math/mtsparc/s_llround.o,
	lib/libc/math/mtsparc/s_log1p.o, lib/libc/math/mtsparc/s_logb.o,
	lib/libc/math/mtsparc/s_lrint.o, lib/libc/math/mtsparc/s_lround.o,
	lib/libc/math/mtsparc/s_matherr.o, lib/libc/math/mtsparc/s_modf.o,
	lib/libc/math/mtsparc/s_nearbyint.o,
	lib/libc/math/mtsparc/s_nextafter.o,
	lib/libc/math/mtsparc/s_remquo.o, lib/libc/math/mtsparc/s_rint.o,
	lib/libc/math/mtsparc/s_round.o,
	lib/libc/math/mtsparc/s_scalbln.o,
	lib/libc/math/mtsparc/s_scalbn.o,
	lib/libc/math/mtsparc/s_signbit.o,
	lib/libc/math/mtsparc/s_signbitf.o,
	lib/libc/math/mtsparc/s_signgam.o,
	lib/libc/math/mtsparc/s_significand.o,
	lib/libc/math/mtsparc/s_sin.o, lib/libc/math/mtsparc/s_tan.o,
	lib/libc/math/mtsparc/s_tanh.o, lib/libc/math/mtsparc/s_trunc.o,
	lib/libc/math/mtsparc/scalblnf.o, lib/libc/math/mtsparc/scalbnf.o,
	lib/libc/math/mtsparc/sinf.o, lib/libc/math/mtsparc/sinhf.o,
	lib/libc/math/mtsparc/sqrtf.o, lib/libc/math/mtsparc/tanf.o,
	lib/libc/math/mtsparc/tanhf.o, lib/libc/math/mtsparc/tgammaf.o,
	lib/libc/math/mtsparc/truncf.o, lib/libc/math/mtsparc/w_acos.o,
	lib/libc/math/mtsparc/w_acosh.o, lib/libc/math/mtsparc/w_asin.o,
	lib/libc/math/mtsparc/w_atan2.o, lib/libc/math/mtsparc/w_atanh.o,
	lib/libc/math/mtsparc/w_cabs.o, lib/libc/math/mtsparc/w_cosh.o,
	lib/libc/math/mtsparc/w_drem.o, lib/libc/math/mtsparc/w_exp.o,
	lib/libc/math/mtsparc/w_exp2.o, lib/libc/math/mtsparc/w_fmod.o,
	lib/libc/math/mtsparc/w_gamma.o, lib/libc/math/mtsparc/w_hypot.o,
	lib/libc/math/mtsparc/w_j0.o, lib/libc/math/mtsparc/w_j1.o,
	lib/libc/math/mtsparc/w_jn.o, lib/libc/math/mtsparc/w_lgamma.o,
	lib/libc/math/mtsparc/w_lgamma_r.o, lib/libc/math/mtsparc/w_log.o,
	lib/libc/math/mtsparc/w_log10.o, lib/libc/math/mtsparc/w_log2.o,
	lib/libc/math/mtsparc/w_pow.o,
	lib/libc/math/mtsparc/w_remainder.o,
	lib/libc/math/mtsparc/w_sinh.o, lib/libc/math/mtsparc/w_sqrt.o,
	lib/libc/math/mtsparc/w_tgamma.o: Import from uCLibc
	0.9.30.1. This was built by configuring uClibc for the `sparc'
	architecture, SPARCv8 ISA, Big Endian, STATIC FLAT ABI, with FP
	support, but no MMU. Then the file `Rules.mak' was manually
	modified to set `CC' to `slc -b mtsn_s' and remove `-fPIC'.

	* doc/README.rst: Report the new precompiled binaries (math
	objects and libgcc.a).

	* lib/mtsparc-sim/mtsmathobjs.mk: List the new files.
	* lib/mtsparc-sim/Makefile.am: Use the MT-SPARC math objects for
	`libm'. List and install `libgcc.a'.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix some FP-related MT-SPARC code generation bugs.

	* tools/slc/mt/common/gentfun.py (TFun_2_MTFun.visit_setp):
	Determine which FP register-to-register move instruction to use
	from the regmagic (e.g. `fmov' is not valid on MT-SPARC).

	* tools/slc/mt/mtalpha/regdefs.py,
	* tools/slc/mt/mtsparc/regdefs.py: Define the instruction
	mnemonics here.

	* tools/slc/mt/mtsparc/gencreate.py: Propagate FP globals/shareds
	to the child family.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Minor packaging fixes.

	* tools/runscripts.mk: Propagate @spp_helper@ to the
	scripts. Factor the common substitutions.
	* tools/slc.mk: Distribute `slc/mt/mipsel/compile.py'.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a bug in the MT-SPARC slrt.

	* tools/lib/mt/mts/slrt.s: Ensure the `slr_runner' tag is prefixed
	with a nul byte.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Add support for `-nostdinc' to `slc'.

	This is required to compile uCLibc, which provides its own
	`math.h'.

	* tools/bin/slc.in,
	* tools/bin/cce.in: Do it.

2013-01-06  Raphael 'kena' Poss  <r.poss@uva.nl>

	Simplify the test suites.

	* build-aux/slctest.m4: Disable support for muTC core compiler,
	`ppp' translation and separate ZLCOMA testing. The latter can be
	tested using SIMPROFILE anyways.
	* build-aux/slctests.mk: Update accordingly.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Enhance the MT-SPARC slrt.

	* tools/lib/mt/mts/slrt.s: Enhance to use the same initialization
	strategy as MT-Alpha and MIPSel. This enables common system
	initialization.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Simplify the MT-Alpha slrt.

	* tools/lib/mt/mta/slrt.s: Do not initialize the registers to
	zero, since D-RISC automatically reads zero from locals.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Provide more compatibility with MT-SPARC's single-precision FP support.

	* lib/libc/misc/dtoa_simple.c (dtoa_simple): Avoid using large
	exponents when using short doubles.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Optimize the conversion of Fibre input to binary data.

	* tools/bin/sag: Emit output data directly. This requires to know
	the data layout (big endian vs little endian, 32-bit vs 64-bit longs,
	32-bit doubles vs 64-bit doubles).

	* tools/bin/slr.in: Use it. Fetch the data layout from the `slr_datatag'.
	* tools/r-host.sh.in,
	* tools/r-mt-sim.sh.in: Simplify, since recursion is not needed
	any more.

	* tools/lib/host/slrt.c,
	* tools/lib/mt/mipsel/slrt.s,
	* tools/lib/mt/mta/slrt.s,
	* tools/lib/mt/mts/slrt.s: Set the data layout.

	* tools/arggen.c,
	* tools/mt-profiles/arggen: Remove, as they are not obsolete.
	* tools/slc.mk: Update accordingly.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Preliminary support for floating-point for MT-SPARC.

	At this point we force `double' to single precision because MT
	argument passing can only use 1 register and 64-bit doubles would
	require 2 registers. (To overcome this, either FP arguments should
	be passed via memory, or a new mechanism must be devised to split
	the values across two registers.)

	Note that the MT binutils must be upgraded, as the versions prior
	to this date used an invalid locals offset for FP registers.

	* tools/bin/cce.in: Re-enable hardware floating-point, but forcing
	single precision only with -fshort-double.

	* tools/slc/mt/common/regmagic.py: Use separate `mt_locals_offset'
	for integer and FP registers. This is required because (at least)
	on SPARC FP register %f0 is a regular register, not zero, so it
	should not be offset when mapping to locals.

	* tools/slc/mt/mtalpha/regdefs.py: Set the FP locals offset to 0.

	* tools/slc/mt/mtsparc/regdefs.py: Define mappings for
	floating-point registers. Define the FP locals offset to 0
	(integer locals offset stays 1 since %g0 is zero).

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Synchronize library support with the latest MGSim sources.

	* lib/mgos/mgsim/mgsim.h,
	* lib/mgos/mgsim/mtconf.c: Import from MGSim. This uses
	memory-mapped I/O for ASRs/APRs and the global heap for the
	configuration data.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Drop support for "slr variables".

	This mechanism can be advantageously replaced by command-line
	arguments passed to `main' (argc/argv) or Fibre input.

	* tools/include/svp/slr.h: Remove.
	* tools/slc.mk (nobase_dist_pkgdata_DATA): Update accordingly.

	* tools/bin/slr.in: Do not recognize the command-line
	arguments. Do not prepare the data.

	* tools/lib/mt/mipsel/slrt.s,
	* tools/lib/mt/mta/slrt.s,
	* tools/r-mt-sim.sh.in,
	* tools/r-host.sh.in,
	* tools/r-mtsparc-fpga.sh.in: Do not pass the data.

	* tools/lib/host/load.c,
	* lib/mgos/init/mtinit.c,
	* lib/mgos/input/mtinput.c: Do not initialize the var data.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix an assembly generation bug on MT-SPARC.

	The MT-SPARC assembler needs to know when the effects of
	`.registers' stop with `.noregisters', so as to translate register
	names outside of MT mode properly. Prior to this patch
	`.noregisters' was not generated and assembler warnings would
	ensue.

	* tools/slc/mt/mtsparc/asmproc/base.py (grouper): Add
	`.noregisters' at the end of MT functions.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Simplify the MGSim run scripts.

	Recent MGSim versions are able to read the symbol table
	automatically from the ELF executable. Therefore, `slr' does not
	need to prepare the symbol table itself any more.

	* build-aux/mgbinutils.m4,
	* tools/runscripts.mk: Do not propagate `nm' any more.

	* tools/r-mt-sim.sh.in: Simplify.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Tell MGSim about register aliases for easier debugging.

	Recent MGSim versions are able to list register aliases next to
	the physical register names when inspecting the register file. The
	list of aliases is configurable, and defaults to the ISA's
	standard ABI names. Since `slc' uses non-standard register mappings,
	it is thus useful to tell MGSim about our choices when running
	with `slr'.

	* tools/slc/mt/common/compile.py (Compile.showregs),
	* tools/slc/mt/mipsel/compile.py (Compile.showregs): New: list the
	mapping from local registers to legacy register aliases.

	* tools/bin/spp: Recognize a new function `showregs' which invokes
	`compile.showregs' to list mappings to local registers to aliases.

	* tools/runscripts.mk: Also substitute '@mtarch@' to a name suitable
	for use with `spp' (name of submodule of `slc.mt').

	* tools/r-mt-sim.sh.in: Use `spp' to pass the options
	`IntRegAliases' and `FltRegAliases' to MGSim.


2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Minor packaging fix.

	* build-aux/slc.m4: Also place `$srcdir/lib' in `SLC_LIBDIR' so that
	`cce' can find a precompiled `libgcc.a'.

2013-01-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Provide some compiler intrinsics for MT-SPARC.

	* lib/mtsparc-sim/builtin_ffs.c: Remove. Replace by...
	* lib/mtsparc-sim/div.h,
	* lib/mtsparc-sim/clzdi2.c,
	* lib/mtsparc-sim/clzsi2.c,
	* lib/mtsparc-sim/ctzdi2.c,
	* lib/mtsparc-sim/ctzsi2.c,
	* lib/mtsparc-sim/divdi3.c,
	* lib/mtsparc-sim/ffsdi2.c,
	* lib/mtsparc-sim/ffssi2.c,
	* lib/mtsparc-sim/moddi3.c,
	* lib/mtsparc-sim/udivdi3.c,
	* lib/mtsparc-sim/umoddi3.c: ... these new files.
	* lib/mtsparc-sim/Makefile.am: Use them to define `libgcc.a'.

2013-01-03  Raphael 'kena' Poss  <r.poss@uva.nl>

	Extend the library with more ffs/fls functions.

	* lib/libc/include/strings.h: Declare ffsl, ffsll, fsl, fsll,
	fslll.

	* lib/libc/string/ffs.c: Delete, replace by...
	* lib/libc/bsd/libc/string/ffs.c: ... this. (imported from
	FreeBSD)
	* lib/libc/bsd/libc/string/ffsl.c,
	* lib/libc/bsd/libc/string/ffsll.c,
	* lib/libc/bsd/libc/string/fls.c,
	* lib/libc/bsd/libc/string/flsl.c,
	* lib/libc/bsd/libc/string/flsll.c: Import from FreeBSD.

	* lib/libc.mk: Include them in `libc.a'.

2013-01-03  Raphael 'kena' Poss  <r.poss@uva.nl>

	Provide compiler built-ins for ffs() on MT-SPARC.

	These are required by dlmalloc(). This support enables
	running MGSim's compiled unit tests.

	* lib/mtsparc-sim/builtin_ffs.c (__ffssi2, __ffsdi2): New.
	* lib/mtsparc-sim/Makefile.am: Build `libgcc.a' from it.

2012-11-18  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix a bug in `gettimeofday_virtual' on MIPSel.

	* lib/mgos/posix-compat/gtod_virtual.c (gettimeofday_virtual): Use
	`unsigned long' arithmetic to avoid hitting limitations with `long
	long' on MIPSel. The extra bits are not needed anyways.

2012-11-05  Raphael 'kena' Poss  <r.poss@uva.nl>

	Packaging fix.

	* build-aux/mgsim.m4: Use `AC_PATH_PROGS' to try out multiple
	candidate program names.

2012-11-02  Raphael 'kena' Poss  <r.poss@uva.nl>

	Packaging fixes.

	* tools/lib.mk (distclean-local): Avoid recursing into `lib' since
	Automake does it already based on DIST_SUBDIRS.

	* lib/common.mk (nobase_dist_sllib_DATA): New variable.
	* lib/mipsel-sim/Makefile.am (nobase_dist_sllib_DATA): Use it to
	also distribute `libgcc.a'.

	* lib/mipsel-sim/mipselmathobjs.mk (EXTRA_DIST): Ensure that
	`$(MIPSELMATHOBJS)' gets distributed.

	* lib/mgos/tlsmalloc/Makefile.am (EXTRA_DIST): Also distribute
	`tls_arch_mipsel_sim.h'.

2012-11-02  Raphael 'kena' Poss  <r.poss@uva.nl>

	Adapt the `arggen' MT machine profile for use with MGSim 3.3.

	* tools/mt-profiles/arggen: use the new device names in overrides.

2012-11-02  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix the `output_*' interfaces on MT targets.

	* tools/include/svp/testoutput.h: Place a compiler memory barrier
	after each output to prevent the compiler from reordering writes
	to separate memory addresses.

2012-11-02  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix `output_char' on MT targets.

	* tools/include/svp/testoutput.h (output_char): Ensure that bytes
	are written to the debug output as full words, to ensure
	compatibility regardless of endianness.

2012-11-02  Raphael 'kena' Poss  <r.poss@uva.nl>

	Minor packaging fix.

	* bootstrap: Avoid forcing Automake 1.11, since 1.12 is now out.

2012-11-02  Raphael 'kena' Poss  <r.poss@uva.nl>

	Update the automatic configuration to recognize the latest MGSim naming.

	* build-aux/mgsim.m4: Recognize/detect the names `mtalpha-mgsim', etc.

2012-10-21  Raphael 'kena' Poss  <r.poss@uva.nl>

	Synchronize library support with MGSim 3.3.

	* lib/mgos/mgsim/mgsim.h: Import from MGSim 3.3. This extends the
	ASR/APR support to MIPS.

2012-10-21  Raphael 'kena' Poss  <r.poss@uva.nl>

	Provide library support for MIPSel.

	* lib/mipsel-sim/libgcc.a: Import from GCC 4.7.1. This was built by
	configuring gcc for `mipsel-linux-gnu', then manually editing
	`mipsel-linux-gnu/libgcc/Makefile' in the build tree to use `slc
	-b mipsel_s' as code generator.

	* lib/libc/math/mipsel/acosf.o, lib/libc/math/mipsel/acoshf.o,
	lib/libc/math/mipsel/asinf.o, lib/libc/math/mipsel/asinhf.o,
	lib/libc/math/mipsel/atan2f.o, lib/libc/math/mipsel/atanf.o,
	lib/libc/math/mipsel/atanhf.o, lib/libc/math/mipsel/cabsf.o,
	lib/libc/math/mipsel/carg.o, lib/libc/math/mipsel/cargf.o,
	lib/libc/math/mipsel/cbrtf.o, lib/libc/math/mipsel/ceilf.o,
	lib/libc/math/mipsel/copysignf.o, lib/libc/math/mipsel/cosf.o,
	lib/libc/math/mipsel/coshf.o, lib/libc/math/mipsel/e_acos.o,
	lib/libc/math/mipsel/e_acosh.o, lib/libc/math/mipsel/e_asin.o,
	lib/libc/math/mipsel/e_atan2.o, lib/libc/math/mipsel/e_atanh.o,
	lib/libc/math/mipsel/e_cosh.o, lib/libc/math/mipsel/e_exp.o,
	lib/libc/math/mipsel/e_fmod.o, lib/libc/math/mipsel/e_gamma.o,
	lib/libc/math/mipsel/e_gamma_r.o, lib/libc/math/mipsel/e_hypot.o,
	lib/libc/math/mipsel/e_j0.o, lib/libc/math/mipsel/e_j1.o,
	lib/libc/math/mipsel/e_jn.o, lib/libc/math/mipsel/e_lgamma.o,
	lib/libc/math/mipsel/e_lgamma_r.o, lib/libc/math/mipsel/e_log.o,
	lib/libc/math/mipsel/e_log10.o, lib/libc/math/mipsel/e_log2.o,
	lib/libc/math/mipsel/e_pow.o, lib/libc/math/mipsel/e_rem_pio2.o,
	lib/libc/math/mipsel/e_remainder.o,
	lib/libc/math/mipsel/e_scalb.o, lib/libc/math/mipsel/e_sinh.o,
	lib/libc/math/mipsel/e_sqrt.o, lib/libc/math/mipsel/erfcf.o,
	lib/libc/math/mipsel/erff.o, lib/libc/math/mipsel/exp2f.o,
	lib/libc/math/mipsel/expf.o, lib/libc/math/mipsel/expm1f.o,
	lib/libc/math/mipsel/fabsf.o, lib/libc/math/mipsel/fdimf.o,
	lib/libc/math/mipsel/floorf.o, lib/libc/math/mipsel/fmaf.o,
	lib/libc/math/mipsel/fmaxf.o, lib/libc/math/mipsel/fminf.o,
	lib/libc/math/mipsel/fmodf.o, lib/libc/math/mipsel/frexpf.o,
	lib/libc/math/mipsel/hypotf.o, lib/libc/math/mipsel/ilogbf.o,
	lib/libc/math/mipsel/k_cos.o, lib/libc/math/mipsel/k_rem_pio2.o,
	lib/libc/math/mipsel/k_sin.o, lib/libc/math/mipsel/k_standard.o,
	lib/libc/math/mipsel/k_tan.o, lib/libc/math/mipsel/ldexpf.o,
	lib/libc/math/mipsel/lgammaf.o, lib/libc/math/mipsel/llrintf.o,
	lib/libc/math/mipsel/llroundf.o, lib/libc/math/mipsel/log10f.o,
	lib/libc/math/mipsel/log1pf.o, lib/libc/math/mipsel/log2f.o,
	lib/libc/math/mipsel/logbf.o, lib/libc/math/mipsel/logf.o,
	lib/libc/math/mipsel/lrintf.o, lib/libc/math/mipsel/lroundf.o,
	lib/libc/math/mipsel/modff.o, lib/libc/math/mipsel/nan.o,
	lib/libc/math/mipsel/nearbyintf.o,
	lib/libc/math/mipsel/nextafterf.o, lib/libc/math/mipsel/powf.o,
	lib/libc/math/mipsel/remainderf.o, lib/libc/math/mipsel/remquof.o,
	lib/libc/math/mipsel/rintf.o, lib/libc/math/mipsel/roundf.o,
	lib/libc/math/mipsel/s_asinh.o, lib/libc/math/mipsel/s_atan.o,
	lib/libc/math/mipsel/s_cbrt.o, lib/libc/math/mipsel/s_ceil.o,
	lib/libc/math/mipsel/s_copysign.o, lib/libc/math/mipsel/s_cos.o,
	lib/libc/math/mipsel/s_erf.o, lib/libc/math/mipsel/s_expm1.o,
	lib/libc/math/mipsel/s_fabs.o, lib/libc/math/mipsel/s_fdim.o,
	lib/libc/math/mipsel/s_finite.o, lib/libc/math/mipsel/s_finitef.o,
	lib/libc/math/mipsel/s_floor.o, lib/libc/math/mipsel/s_fma.o,
	lib/libc/math/mipsel/s_fmax.o, lib/libc/math/mipsel/s_fmin.o,
	lib/libc/math/mipsel/s_fpclassify.o,
	lib/libc/math/mipsel/s_fpclassifyf.o,
	lib/libc/math/mipsel/s_frexp.o, lib/libc/math/mipsel/s_ilogb.o,
	lib/libc/math/mipsel/s_isinf.o, lib/libc/math/mipsel/s_isinff.o,
	lib/libc/math/mipsel/s_isnan.o, lib/libc/math/mipsel/s_isnanf.o,
	lib/libc/math/mipsel/s_ldexp.o,
	lib/libc/math/mipsel/s_lib_version.o,
	lib/libc/math/mipsel/s_llrint.o, lib/libc/math/mipsel/s_llround.o,
	lib/libc/math/mipsel/s_log1p.o, lib/libc/math/mipsel/s_logb.o,
	lib/libc/math/mipsel/s_lrint.o, lib/libc/math/mipsel/s_lround.o,
	lib/libc/math/mipsel/s_matherr.o, lib/libc/math/mipsel/s_modf.o,
	lib/libc/math/mipsel/s_nearbyint.o,
	lib/libc/math/mipsel/s_nextafter.o,
	lib/libc/math/mipsel/s_remquo.o, lib/libc/math/mipsel/s_rint.o,
	lib/libc/math/mipsel/s_round.o, lib/libc/math/mipsel/s_scalbln.o,
	lib/libc/math/mipsel/s_scalbn.o, lib/libc/math/mipsel/s_signbit.o,
	lib/libc/math/mipsel/s_signbitf.o,
	lib/libc/math/mipsel/s_signgam.o,
	lib/libc/math/mipsel/s_significand.o,
	lib/libc/math/mipsel/s_sin.o, lib/libc/math/mipsel/s_tan.o,
	lib/libc/math/mipsel/s_tanh.o, lib/libc/math/mipsel/s_trunc.o,
	lib/libc/math/mipsel/scalblnf.o, lib/libc/math/mipsel/scalbnf.o,
	lib/libc/math/mipsel/sinf.o, lib/libc/math/mipsel/sinhf.o,
	lib/libc/math/mipsel/sqrtf.o, lib/libc/math/mipsel/tanf.o,
	lib/libc/math/mipsel/tanhf.o, lib/libc/math/mipsel/tgammaf.o,
	lib/libc/math/mipsel/truncf.o, lib/libc/math/mipsel/w_acos.o,
	lib/libc/math/mipsel/w_acosh.o, lib/libc/math/mipsel/w_asin.o,
	lib/libc/math/mipsel/w_atan2.o, lib/libc/math/mipsel/w_atanh.o,
	lib/libc/math/mipsel/w_cabs.o, lib/libc/math/mipsel/w_cosh.o,
	lib/libc/math/mipsel/w_drem.o, lib/libc/math/mipsel/w_exp.o,
	lib/libc/math/mipsel/w_exp2.o, lib/libc/math/mipsel/w_fmod.o,
	lib/libc/math/mipsel/w_gamma.o, lib/libc/math/mipsel/w_hypot.o,
	lib/libc/math/mipsel/w_j0.o, lib/libc/math/mipsel/w_j1.o,
	lib/libc/math/mipsel/w_jn.o, lib/libc/math/mipsel/w_lgamma.o,
	lib/libc/math/mipsel/w_lgamma_r.o, lib/libc/math/mipsel/w_log.o,
	lib/libc/math/mipsel/w_log10.o, lib/libc/math/mipsel/w_log2.o,
	lib/libc/math/mipsel/w_pow.o, lib/libc/math/mipsel/w_remainder.o,
	lib/libc/math/mipsel/w_sinh.o, lib/libc/math/mipsel/w_sqrt.o,
	lib/libc/math/mipsel/w_tgamma.o: Import from uCLibc 0.9.30.1. This
	was built by configuring uClibc for the `mips' architecture, MIPS
	I ISA, Little Endian, O32 ABI, with FP support, but no MMU. Then
	the file `Rules.mak' was manually modified to set `CC' to `slc -b
	mipsel_s'.

	* doc/README.rst: Report the new precompiled binaries (math
	objects and libgcc.a).

	* lib/mipsel-sim/mipselmathobjs.mk: List the new files.

	* lib/common.mk: Predefine `nobase_sllib_DATA'.

	* lib/mtalpha-sim/Makefile.am: Copy to...
	* lib/mipsel-sim/Makefile.am: ...here. Define library support only
	for `seq_naked' code generation. Use the MIPS math objects for
	`libm'. List and install `libgcc.a'.

	* lib/libc/bsd/libc/include/fpmath.h,
	* lib/libc/bsd/libc/stdio/vfprintf.c,
	* lib/mgos/posix-compat/heap.c,
	* lib/libc/include/limits.h,
	* lib/libc/include/stddef.h,
	* lib/libc/include/stdint.h,
	* lib/libc/malloc/mtmalloc.h: Extend the preprocessor conditionals
	to `__mips__'.

	* lib/libc/include/time.h: Also support MIPS. Use the MGSim
	performance counters to support clock() since MIPS I does not
	define a TSC natively.

	* lib/mgos/tlsmalloc/tls_arch_mtalpha_sim.h: Copy to...
	* lib/mgos/tlsmalloc/tls_arch_mipsel_sim.h: ... here.

	* lib/mgos/tlsmalloc/tls_arch_mipsel_sim.h,
	* lib/mgos/tlstack_malloc.c: Also support MIPS. Use the `mfc2'
	instruction directly for ldbp/ldfp since we don't use a modified
	assembler yet.
	* lib/mipsel-sim/Makefile.am: Use it to build the `tlsmalloc' code.

	* lib/mgos/uart/mtuart.c: Use `move' to drain a waiting register
	on MIPS, because the GNU assembler for MIPS does not support the
	alias `mov'.

	* lib/configure.ac,
	* lib/Makefile.am: Recurse into `mipsel-sim' if configured.

2012-10-21  Raphael 'kena' Poss  <r.poss@uva.nl>

	Provide tool support for MIPSel.

	We support only sequential code for now.

	* tools/bin/Makefile.am: Forward the tool configuration to `cce'.

	* tools/bin/cce.in: Configure tool chain to generate MIPS code
	with tag `spr-seq_naked-mipsel-sim' (shorthand `mipsel_s').

	* tools/include/svp/compiler.h: Do not use `swch' for `nop' with
	MIPS targets, since we don't use a modified assembler yet.

	* tools/include/svp/delegate.h: Use the `mfc2' instruction
	directly for getpid/getcid, since we don't use a modified
	assembler yet.

	* tools/lib/mt/mipsel/slrt.s: New.
	* tools/lib/mipsel-sim/Makefile.am: New.

	* tools/lib/Makefile.am,
	* tools/lib/configure.ac: Also recurse in `mipsel-sim' if
	configured.

	* tools/runscripts.mk: Generate a new script `r-mipsel-sim'.

	* tools/slc/mt/mipsel/__init__.py: New.
	* tools/slc/mt/mipsel/regdefs.py: New; do not define any MT magic for now.
	* tools/slc/mt/mipsel/asmproc/__init__.py: New.

	* tools/slc/mt/mtsparc/asmproc/base.py,
	* tools/slc/mt/mtsparc/asmproc/common.py,
	* tools/slc/mt/mtsparc/asmproc/opt.py: Copy to...

	* tools/slc/mt/mipsel/asmproc/base.py,
	* tools/slc/mt/mipsel/asmproc/common.py,
	* tools/slc/mt/mipsel/asmproc/opt.py: ... here. Remove all the
	assembly massaging code for now. Note that MIPS assembly uses
	'.type NAME, @function' instead of '.type NAME, #function' as in
	SPARC.

	* tools/slc/mt/mipsel/asmproc/opt.py (noreorder): Replace all
	occurrences of '.set reorder' by `.set noreorder' because
	otherwise the assembler would pull instructions in the delay slot
	of branches.

	* tools/slc.mk: List the new files.

2012-10-21  Raphael 'kena' Poss  <r.poss@uva.nl>

	Provide infrastructure to support MIPSel compatibility.

	* build-aux/mgbinutils.m4: Detect ar, ranlib and nm for mipsel-linux-gnu.
	* build-aux/mgsim.m4: Detect mgsim for mipsel.
	* build-aux/slc.m4: Detect gcc for mipsel-linux-gnu; support a new
	flag --enable-mipsel.
	* configure.ac: Determine whether MIPSel is supported based on detected tools.

	* build-aux/slctests.m4: Provide a new Automake conditional
	ENABLE_CHECK_SPR_MIPSEL.

2012-10-21  Raphael 'kena' Poss  <r.poss@uva.nl>

	Enhance the heap memory manager and fix a long-standing bug.

	Multiple changes packaged in one commit:

	- enable use of the MGSim MMU to map/unmap memory pages dynamically.

	- use smaller page sizes to accommodate the MGSim MMU granularity.

	- fix a bug in `sbrk': `sbrk' must return the *previous* brk, not
	the new one (as per man page). Prior to this patch, with the
	introduction of dynamic page mapping `malloc' would get an error
	when it tried to write to the area above the pointer returned to
	`sbrk'.

	- better accommodate for the MGSim memory address space. This is
	because the default MGsim configuration places I/O ranges just
	below the 4GB boundary; with a 10GB heap on MT-Alpha there would
	be a conflict if heap space directly follows program code.
	Instead, place the heap base into its own section
	(`MGOS_HEAPBASE'), then tell the linker to place this either below
	I/O (on 32-bit targets) or above I/O (on 64-bit targets).

	* lib/mgos/posix-compat/heap.c (PAGESIZE, PAGE_BITS),
	* lib/mtalpha-sim/Makefile.am (PAGESIZE),
	* lib/mtsparc-fpga/Makefile.am (PAGESIZE),
	* lib/mtsparc-sim/Makefile.am (PAGESIZE): Use 4K pages on 32-bit platforms,
	32K on 64-bit.

	* lib/mgos/posix-compat/heap.c (__heap, brk): When MGSim is
	targeted, place a 1-byte heap base in the section `MGOS_HEAPBASE',
	then use the MMU to dynamically map/unmap pages.

	* tools/bin/cce.in: Place the code at 0x1000, and the heap at
	either 0x40000000 or 0x1000000000 depending on whether the target
	is 32-bit or 64-bit MGSim.

	* lib/mgos/posix-compat/heap.c (sbrk): Return the old brk, not the
	new one.

	* lib/malloc.mk: Enable use of `sys/types.h' which now exists; as
	well as shrinking the HEAP space with `sbrk' and negative
	increments which we now support.

2012-10-21  Raphael 'kena' Poss  <r.poss@uva.nl>

	Link with `libgcc.a' if it is configured.

	* tools/bin/cce.in: If `libgcc.a' is present in an SL library
	directory, then link it in as part of the C standard library.

2012-10-21  Raphael 'kena' Poss  <r.poss@uva.nl>

	Kill some compiler warnings.

	* lib/mgos/tlsmalloc/tls_arch_mtalpha.h (UNMAP_STORAGE, MAP_STORAGE),
	* lib/mgos/tlsmalloc/tls_arch_mtsparc.h (UNMAP_STORAGE)
	(MAP_STORAGE): Cast the pointers before calling `mgsim_control',
	since it is now a function and the compiler now tries to check
	types.

2012-10-21  Raphael 'kena' Poss  <r.poss@uva.nl>

	Extend the performance counter interface to the latest MGSim.

	* lib/slsys/include/svp/perf.h,
	* lib/slsys/perf/perf.c: Add support for the number of created
	threads/families and the number of core cycles, as per MGSim 3.3.

2012-10-20  Raphael 'kena' Poss  <r.poss@uva.nl>

	Align MT code with MGSim 3.3

	* tools/r-mt-sim.sh.in (runner_cmdline): Set boot ROM file name in
	`rom_boot' instead of `*BootROM'.

	* tools/include/svp/testoutput.h: Use MMIO to the debug channel instead
	of `mgsim_control'.

	* tools/include/svp/mgsim.h: Use MMIO to the action and MMU interfaces
	instead of the `print' instruction.

	* tools/lib/mt/mgsim.c,
	* tools/include/svp/mgsim.h: Remove the `mgsim_outfloat' interface
	as it was not used anyways.

	* tools/lib/mt/mta/slrt.s,
	* tools/lib/mt/mts/slrt.s: Use MMIO to the action interface to report
	main's exit code.

2012-10-20  Raphael 'kena' Poss  <r.poss@uva.nl>

	Declare `signam' in the embedded `math.h'.

	* lib/libc/include/math.h: Do it.

2012-10-20  Raphael 'kena' Poss  <r.poss@uva.nl>

	Improve compatibility with the latest Automake versions.

	* build-aux/slctests.mk (SL_LOG_COMPILER): Prefix the command line
	with `env' since the latest versions of Automake require a command as first
	word.

2012-10-18  Raphael 'kena' Poss  <r.poss@uva.nl>

	Fix the output formatting in mtperf_report_intervals.

	* lib/slsys/perf/perf.c: Ensure that the first column of the CSV
	header is separated from the next with a space.

2012-07-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Optimize the MT-Alpha code generation.

	The "create" instruction implies a memory barrier in the MT
	architecture. However, until this point the compiler would insert
	an extra barrier just before the instruction in the generated
	code. This was a vestige of a time where the architecture
	implementation had not yet implemented the barrier in
	hardware. This patch removes the unnecessary barrier.

	* tools/slc/mt/mtalpha/gencreate.py
	(Create_2_MTACreate.visit_lowcreate): Do it.

2012-05-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for `malloc'.

	* slc/lib/libc.mk: Do not link in `malloc_wrappers' by default, as
	this will plainly disable the TLS-based `malloc'.

2012-05-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase compatibility with the latest Automake.

	* slc/lib/common.mk,
	* slc/lib/malloc.mk,
	* slc/lib/tlsmalloc.mk,
	* slc/tools/lib/common.mk: Avoid using `pkglib_DATA' which is not
	valid as per Automake 1.11.2/3.

2012-05-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* Makefile.am (README, NEWS): Fix the aliasing.

2012-05-25  Irfan Uddin  <mirfanud@gmail.com>

	Fix a bug in the hlsim code generation.

	* tools/slc/ptl/genptlcreate.py
	(Create_2_ptlCreate.visit_lowcreate): Use the named family handle
	in `sync'.

2012-05-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase portability of the tools towards compatibility with Solaris.

	* tools/bin/cce.in (archvar,basearchvar): Use the explicit form of
	`tr' to increase portability of `cce'.

2012-04-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix for compatibility with Automake 1.11.2+.

	* tools/Makefile.am: Rename `pkglib_SCRIPTS' to `sllib_SCRIPTS'
	since Automake 1.11.2+ is not happy about putting scripts in a lib
	dir.
	* tools/runscripts.mk: Use it.

2012-04-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update the documentation.

	* slc/doc/HACKING.txt: Rename to...
	* slc/doc/HACKING.rst: ...here. Simplify. Update to reflect the
	existence of the separate `deploy' package.

	* slc/doc/README.txt: Rename to...
	* slc/doc/README.rst: ...here. Update to reflect the existence of
	the separate `deploy' package. Detail the licensing terms.

	* slc/doc/NEWS.txt,
	* slc/doc/acronyms.txt: Rename to...
	* slc/doc/NEWS.rst,
	* slc/doc/acronyms.rst: ...here.

	* slc/doc/requirements.txt: Remove, as is now outdated.

	* slc/doc/Makefile.am: Update accordingly.

2012-04-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for MGSim graphics.

	Since MGSim 3.2 the configuration interface has evolved. Make `slr
	-X' use it.

	* tools/bin/slr.in,
	* tools/r-mt-sim.sh.in: Do it.

2012-04-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the POSIX file interface.

	* lib/mgos/posix-compat/mtunix.c: Add support for `lseek'.

2012-02-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Simplify `slc'.

	* tools/bin/slc.in: Remove support for `-combine' since this
	feature was abandoned with GCC 4.6 and is not used by SL
	applications anyways.

2012-01-12  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance code documentation.

	* lib/mgos/posix-compat/gtod_virtual.c (gettimeofday_virtual):
	Explain the ratio between core ticks and mgconf frequency.

2012-01-12  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement "fast" wall clock time access for MGSim.

	With MGSim 3.2.21+ it is possible to (unrealistically) extract
	wall clock time from a virtual performance counter. Make this
	visible through the SL API.

	* lib/slsys/include/svp/perf.h: Declare the new "performance
	counters".

	* lib/libc/include/sys/time.h,
	* lib/libc/include/time.h: Expose `gettimeofday_mgsim' and
	`time_mgsim'. Alias `gettimeofday' and `time' to them if the macro
	`MG_FAST_TIME' is defined.

	* lib/mgos/posix-compat/gtod_mgsim.c,
	* lib/mgos/posix-compat/time_mgsim.c: Implement them.

	* lib/mtalpha-sim/Makefile.am: Compile them.

2012-01-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support hlsim in test suites.

	* build-aux/slctests.mk,
	* build-aux/slctests.m4: Do it.

2012-01-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update `slr' and MT profiles to mgsim 3.2.18+.

	MGSim 3.2.18+ uses short component names without a `system.'
	prefix. Make the tools compatible with it.

	* tools/r-mt-sim.sh.in (runner_cmdline),
	* tools/mt-profiles/mlcoma256_4chan (simargs_base),
	* tools/mt-profiles/mlcoma128_2chan (simargs_base),
	* tools/mt-profiles/lzcoma256_4chan (simargs_base),
	* tools/mt-profiles/lzcoma128_2chan (simargs_base),
	* tools/mt-profiles/arggen (simargs_base),
	* tools/mt-profiles/default (simargs_base): Prefix the configured
	variables with `*' instead of `*.'.

2012-01-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Applied the following patch.

        2011-12-06  Irfan Uddin  <mirfanud@gmail.com>

	Debug print info added to create and sync for ptl/hlsim.

	* tools/slc/ptl/genptlcreate.py: Use DPRINT.

	* tools/t-spr/include/sl_support.h: Ensure DPRINT is defined after
	translation.

2012-01-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a bug in the MT C standard library.

	* lib/libc/stdio/fputs.c: Do not append a newline char, contrary
	to `puts' which does.

2011-03-08  Irfan Uddin  <mirfanud@uva.nl>

	sl_index fixed for hl-sim.

	* tools/slc/ptl/gentfun.py: Indexes were wrong in hlsim. The
	problem was in conversion, because in ptl indices are objects and
	conversion to long gives wrong results. In the translater code I
	generate a temp object of index, and then convert that index to
	long.

2011-11-22  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Better integration for `hls' and `ptl' targets.

	* tools/bin/cce.in: Define `__slc_os_init_via_main__' (run-time
	initialized during `main', thus not available in global
	constructors) and `__slc_multiple_places__' (more than 1 place
	supported) for all targets where they are true.

	* tools/include/svp/delegate.h,
	* tools/lib/host/load.c,
	* lib/mgos/init/mtinit.c: Use the new macros.

2011-11-22  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix debugging of `hlsd' and `ptld' targets.

	* tools/bin/cce.in: Preset the compiler flags before defining the
	compiler, so that the hlsim/ptl overrides are appended after the
	preset. In particular this allows things like `-g -O0' to be
	imported after the default `-O2'.

2011-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor build fixes.

	* tools/lib/host/load.c: Include `stdint.h' for 'uintptr_t'.
	* tools/include/svp/delegate.h: Include `stdlib.h' to declare
	`abort()' (required with GNU which may also have throw specifiers
	in the declaration).

2011-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix initialization on the sequential target.

	* lib/mgos/init/mtinit.c (sys_init): Do not handle `-n' if running
	on the sequential target.

2011-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Homogeneize MT and host system initialization.

	* tools/lib/mt/mtplaces.c: Rename to...
	* tools/lib/common/places.c: ... here.

	* tools/lib/host.mk,
	* tools/lib/mt.mk: Use it.

	* tools/lib/common/dummyplaces.c: Remove.

	* tools/include/svp/delegate.h: Implement the inlinable primitives
	here.

	* tools/lib/host/load.c,
	* tools/lib/host/slrt.c: Call `sys_init' before the program starts.

	* tools/r-host.sh.in: Ensure the sub-process that generates data
	is run as if `-n 0' was passed, and reduce the output with
	`MGSYS_QUIET'.

	* lib/mgos/init/mtinit.c: Separate sub-parts into...
	* lib/mgos/init/mtinit.h,
	* lib/mgos/init/initmain.h,
	* lib/mgos/init/initplaces.h,
	* lib/mgos/init/inienvt.h: ...here.

	* lib/mgos.mk: Update accordingly.

	* lib/mgos/init/mtinit.c: Call only the initializers relevant on
	each target.

	* lib/mgos-host.mk: Include the initialization code and the same
	SEP as other platforms.

	* lib/host-host-hlsim/Makefile.am,
	* lib/host-host-hlsimd/Makefile.am: Use it.

	* lib/mgos-hlsim.mk,
	* lib/mgos/sep/dummysep.c: Remove.

2011-11-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* build-aux/slc.m4: Update the include path so that `slc' can find
	the slsys headers.

2011-11-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase compatibility with `hlsim'.

	* lib/mgos/sep/mtsep.c: Avoid reading the MGSim configuration
	variables if MGSim is not used.

	* tools/include/svp/delegate.h: Share the definition of
	`get_local_place()' over all targets.

	* tools/lib/common/dummyplaces.c: Implement primitives also for
	hlsim.

	* tools/lib/host/slrt.c: Initialize the SEP when using hlsim.

	* lib/mgos-hlsim.mk: New.

	* lib/host-host-hlsim/Makefile.am,
	* lib/host-host-hlsimd/Makefile.am: Use it to include the SEP in
	the library.

	* lib/mgos/sep/dummysep.c: Avoid the word `unused' which may be
	defined by a header.

2011-11-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix the entry point for ptl and hlsim programs.

	* tools/lib/host/slrt.c: Implement the `_main'/`Pmain' magic.

2011-11-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update the documentation for version 3.7b.

	* doc/NEWS.txt: Do it.

2011-11-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* bootstrap: Properly recurse into `tools/lib' and `lib'.

2011-11-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* tools/slc.mk (nobase_dist_pkgdata_DATA): Distribute and install
	the files needed for the `mta_on' target.

2011-11-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Remove old files.

	* tools/lib/attic,
	* lib/attic: Remove.

2011-11-12  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement a new build layout for `lib'.

	* lib/mtalpha-sim/include: Move the standard C headers to...
	* lib/libc/include: ...here.

	* lib/include: Move the SL-specific headers to...
	* lib/slsys/include: ...here.

	* lib/Makefile.am,
	* lib/mtalpha.mk,
	* lib/mtsparc.mk,
	* lib/mtsparc2.mk,
	* lib/ptl.mk,
	* lib/seqc.mk: Retire to...

	* lib/attic/Makefile.am,
	* lib/attic/mtalpha.mk,
	* lib/attic/mtsparc.mk,
	* lib/attic/mtsparc2.mk,
	* lib/attic/ptl.mk,
	* lib/attic/seqc.mk: ... here.

	* lib/slsys/Makefile.am: New. Distribute / install the SL-specific
	headers.

	* lib/slsys/include/svp/deprecated/io.h,
	* lib/slsys/deprecated/div.c,
	* lib/slsys/deprecated/io.c: Adjust the include paths.

	* lib/mtamathobjs.mk: Rename to...
	* lib/mtalpha-sim/mtamathobjs.mk: ...here. Adjust the paths.

	* tools/lib.mk: Extract the include to `slcvars.mk' and the
	definition of `DIST_SUBDIRS' to...
	* tools/Makefile.am: ...here.

	* lib/configure.ac,
	* lib/Makefile.am,
	* lib/host-host-seqc/Makefile.am,
	* lib/host-host-ptl/Makefile.am,
	* lib/host-host-ptld/Makefile.am,
	* lib/host-host-hlsim/Makefile.am,
	* lib/host-host-hlsimd/Makefile.am,
	* lib/mtalpha-sim/Makefile.am,
	* lib/mtsparc-sim/Makefile.am,
	* lib/mtsparc-fpga/Makefile.am,
	* lib/common.mk,
	* lib/libc-headers.mk,
	* lib/libc.mk,
	* lib/malloc.mk,
	* lib/mgos-host.mk,
	* lib/mgos.mk,
	* lib/tlsmalloc.mk: New.

	* lib/gdtoa.mk: Change the path to be relative to one subdirectory
	deeper.

	* lib/libc/bsd/contrib/gdtoa/misc.c: Fix to support compilation of
	UTLEON3.

	* lib/libc/bsd/contrib/gdtoa/qnan.c: Use plain C syntax for `main'
	and C's `printf'.

	* lib/slsys/perf/perf.c,
	* lib/libc/bsd/stdio/printfcommon.h,
	* lib/libc/malloc/malloc_excl.c,
	* lib/libc/malloc/malloc_wrappers.c,
	* lib/mgos/gfx/mtgfx.c,
	* lib/mgos/init/mtinit.c,
	* lib/mgos/input/mtargs.c,
	* lib/mgos/input/mtinput.c,
	* lib/mgos/mgsim/mtconf.c,
	* lib/mgos/posix-compat/gtod.c,
	* lib/mgos/posix-compat/gtod_virtual.c,
	* lib/mgos/posix-compat/heap.c,
	* lib/mgos/posix-compat/mtunix.c,
	* lib/mgos/sep/mtsep.c,
	* lib/mgos/tlsmalloc/tls_arch_mtalpha.h,
	* lib/mgos/tlsmalloc/tls_arch_mtsparc_sim.h,
	* lib/mgos/uart/mtuart.c: Adjust includes after header renaming.

	* lib/mgos/posix-compat/time.c,
	* lib/mgos/posix-compat/time_virtual.c: Remove unnecessary
	includes.

	* lib/libc/bsd/libc/string/strdup.h: Use C's `stdlib.h'.

	* Makefile.am: Use `tools/lib.mk' to recurse into `lib'. Also
	recurse explicitely in `lib/mgos/tlsmalloc'.
	* configure.ac: Adjust accordingly.

	* tools/lib/common.mk: Preset `AM_CPPFLAGS' to empty.
	* tools/lib/mt.mk (AM_CPPFLAGS): Refer to the libc include directory.

	* tools/bin/cce.in: Define `_GLIBCXX_USE_C99_MATH' always
	for `ptl' and `hlsim'.
	* tools/t-spr/include/sl_support.h: Import the `std' namespace
	when using C++, since the math functions are stolen there.

	* tools/bin/slc.in,
	* tools/bin/cce.in: Support linking with `libmgos', `libc' and
	`libm' if they are available for the target. New `slr' flag
	`-nomgos' to disable linking against `libmgos'. Implied by
	`-nostdlib' and `-nostartfiles'.

2011-11-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Move files around for a new build layout for `lib'.

	* include/calloca.h,
	* include/cassert.h,
	* include/cctype.h,
	* include/cerrno.h,
	* include/cfloat.h,
	* include/climits.h,
	* include/cmalloc.h,
	* include/cmath.h,
	* include/cstdarg.h,
	* include/cstdbool.h,
	* include/cstddef.h,
	* include/cstdint.h,
	* include/cstdio.h,
	* include/cstdlib.h,
	* include/cstring.h,
	* include/cstrings.h,
	* include/ctime.h: Rename to...

	* attic/calloca.h,
	* attic/cassert.h,
	* attic/cctype.h,
	* attic/cerrno.h,
	* attic/cfloat.h,
	* attic/climits.h,
	* attic/cmalloc.h,
	* attic/cmath.h,
	* attic/cstdarg.h,
	* attic/cstdbool.h,
	* attic/cstddef.h,
	* attic/cstdint.h,
	* attic/cstdio.h,
	* attic/cstdlib.h,
	* attic/cstring.h,
	* attic/cstrings.h,
	* attic/ctime.h: ...here.

	* include/svp/argslot.h,
	* include/svp/assert.h,
	* include/svp/callgate.h,
	* include/svp/div.h,
	* include/svp/fast_malloc.h,
	* include/svp/io.h,
	* include/svp/iomacros.h,
	* include/svp/minimath.h,
	* include/svp/roman.h: Rename to...

	* include/svp/deprecated/argslot.h,
	* include/svp/deprecated/assert.h,
	* include/svp/deprecated/callgate.h,
	* include/svp/deprecated/div.h,
	* include/svp/deprecated/fast_malloc.h,
	* include/svp/deprecated/io.h,
	* include/svp/deprecated/iomacros.h,
	* include/svp/deprecated/minimath.h,
	* include/svp/deprecated/roman.h: ...here.

	* src/gdtoa/README,
	* src/gdtoa/arith-mtalpha.h,
	* src/gdtoa/arith.h,
	* src/gdtoa/arithchk.c,
	* src/gdtoa/dmisc.c,
	* src/gdtoa/dtoa.c,
	* src/gdtoa/g_Qfmt.c,
	* src/gdtoa/g__fmt.c,
	* src/gdtoa/g_ddfmt.c,
	* src/gdtoa/g_dfmt.c,
	* src/gdtoa/g_ffmt.c,
	* src/gdtoa/g_xLfmt.c,
	* src/gdtoa/g_xfmt.c,
	* src/gdtoa/gd_qnan-mtalpha.h,
	* src/gdtoa/gd_qnan.h,
	* src/gdtoa/gdtoa.c,
	* src/gdtoa/gdtoa.h,
	* src/gdtoa/gdtoa_fltrnds.h,
	* src/gdtoa/gdtoaimp.h,
	* src/gdtoa/gethex.c,
	* src/gdtoa/gmisc.c,
	* src/gdtoa/hd_init.c,
	* src/gdtoa/hexnan.c,
	* src/gdtoa/makefile,
	* src/gdtoa/misc.c,
	* src/gdtoa/qnan.c,
	* src/gdtoa/smisc.c,
	* src/gdtoa/strtoIQ.c,
	* src/gdtoa/strtoId.c,
	* src/gdtoa/strtoIdd.c,
	* src/gdtoa/strtoIf.c,
	* src/gdtoa/strtoIg.c,
	* src/gdtoa/strtoIx.c,
	* src/gdtoa/strtoIxL.c,
	* src/gdtoa/strtod.c,
	* src/gdtoa/strtodI.c,
	* src/gdtoa/strtodg.c,
	* src/gdtoa/strtodnrp.c,
	* src/gdtoa/strtof.c,
	* src/gdtoa/strtopQ.c,
	* src/gdtoa/strtopd.c,
	* src/gdtoa/strtopdd.c,
	* src/gdtoa/strtopf.c,
	* src/gdtoa/strtopx.c,
	* src/gdtoa/strtopxL.c,
	* src/gdtoa/strtorQ.c,
	* src/gdtoa/strtord.c,
	* src/gdtoa/strtordd.c,
	* src/gdtoa/strtorf.c,
	* src/gdtoa/strtorx.c,
	* src/gdtoa/strtorxL.c,
	* src/gdtoa/sum.c,
	* src/gdtoa/ulp.c: Rename to...

	* libc/bsd/contrib/gdtoa/README,
	* libc/bsd/contrib/gdtoa/arith-mtalpha.h,
	* libc/bsd/contrib/gdtoa/arith.h,
	* libc/bsd/contrib/gdtoa/arithchk.c,
	* libc/bsd/contrib/gdtoa/dmisc.c,
	* libc/bsd/contrib/gdtoa/dtoa.c,
	* libc/bsd/contrib/gdtoa/g_Qfmt.c,
	* libc/bsd/contrib/gdtoa/g__fmt.c,
	* libc/bsd/contrib/gdtoa/g_ddfmt.c,
	* libc/bsd/contrib/gdtoa/g_dfmt.c,
	* libc/bsd/contrib/gdtoa/g_ffmt.c,
	* libc/bsd/contrib/gdtoa/g_xLfmt.c,
	* libc/bsd/contrib/gdtoa/g_xfmt.c,
	* libc/bsd/contrib/gdtoa/gd_qnan-mtalpha.h,
	* libc/bsd/contrib/gdtoa/gd_qnan.h,
	* libc/bsd/contrib/gdtoa/gdtoa.c,
	* libc/bsd/contrib/gdtoa/gdtoa.h,
	* libc/bsd/contrib/gdtoa/gdtoa_fltrnds.h,
	* libc/bsd/contrib/gdtoa/gdtoaimp.h,
	* libc/bsd/contrib/gdtoa/gethex.c,
	* libc/bsd/contrib/gdtoa/gmisc.c,
	* libc/bsd/contrib/gdtoa/hd_init.c,
	* libc/bsd/contrib/gdtoa/hexnan.c,
	* libc/bsd/contrib/gdtoa/makefile,
	* libc/bsd/contrib/gdtoa/misc.c,
	* libc/bsd/contrib/gdtoa/qnan.c,
	* libc/bsd/contrib/gdtoa/smisc.c,
	* libc/bsd/contrib/gdtoa/strtoIQ.c,
	* libc/bsd/contrib/gdtoa/strtoId.c,
	* libc/bsd/contrib/gdtoa/strtoIdd.c,
	* libc/bsd/contrib/gdtoa/strtoIf.c,
	* libc/bsd/contrib/gdtoa/strtoIg.c,
	* libc/bsd/contrib/gdtoa/strtoIx.c,
	* libc/bsd/contrib/gdtoa/strtoIxL.c,
	* libc/bsd/contrib/gdtoa/strtod.c,
	* libc/bsd/contrib/gdtoa/strtodI.c,
	* libc/bsd/contrib/gdtoa/strtodg.c,
	* libc/bsd/contrib/gdtoa/strtodnrp.c,
	* libc/bsd/contrib/gdtoa/strtof.c,
	* libc/bsd/contrib/gdtoa/strtopQ.c,
	* libc/bsd/contrib/gdtoa/strtopd.c,
	* libc/bsd/contrib/gdtoa/strtopdd.c,
	* libc/bsd/contrib/gdtoa/strtopf.c,
	* libc/bsd/contrib/gdtoa/strtopx.c,
	* libc/bsd/contrib/gdtoa/strtopxL.c,
	* libc/bsd/contrib/gdtoa/strtorQ.c,
	* libc/bsd/contrib/gdtoa/strtord.c,
	* libc/bsd/contrib/gdtoa/strtordd.c,
	* libc/bsd/contrib/gdtoa/strtorf.c,
	* libc/bsd/contrib/gdtoa/strtorx.c,
	* libc/bsd/contrib/gdtoa/strtorxL.c,
	* libc/bsd/contrib/gdtoa/sum.c,
	* libc/bsd/contrib/gdtoa/ulp.c: ...here.

	* src/_hdtoa.c: Rename to...
	* libc/bsd/libc/gdtoa/_hdtoa.c: ...here.

	* src/errlst.c: Rename to...
	* libc/bsd/libc/gen/errlst.c: ...here.
	* src/fpmath.h: Rename to...

	* libc/bsd/libc/include/fpmath.h: ...here.
	* src/floatio.h: Rename to...

	* src/fprintf.c,
	* src/printf-pos.c,
	* src/printf.c,
	* src/printfcommon.h,
	* src/printflocal.h,
	* src/sprintf.c,
	* src/vfprintf.c: Rename to...

	* libc/bsd/libc/stdio/floatio.h,
	* libc/bsd/libc/stdio/fprintf.c,
	* libc/bsd/libc/stdio/printf-pos.c,
	* libc/bsd/libc/stdio/printf.c,
	* libc/bsd/libc/stdio/printfcommon.h,
	* libc/bsd/libc/stdio/printflocal.h,
	* libc/bsd/libc/stdio/sprintf.c,
	* libc/bsd/libc/stdio/vfprintf.c: ...here.

	* src/atoi.c,
	* src/atol.c,
	* src/atoll.c,
	* src/getenv.c,
	* src/strtol.c,
	* src/strtoll.c,
	* src/strtoul.c,
	* src/strtoull.c: Rename to...

	* libc/bsd/libc/stdlib/atoi.c,
	* libc/bsd/libc/stdlib/atol.c,
	* libc/bsd/libc/stdlib/atoll.c,
	* libc/bsd/libc/stdlib/getenv.c,
	* libc/bsd/libc/stdlib/strtol.c,
	* libc/bsd/libc/stdlib/strtoll.c,
	* libc/bsd/libc/stdlib/strtoul.c,
	* libc/bsd/libc/stdlib/strtoull.c: ...here.

	* src/bcopy.c,
	* src/bzero.c,
	* src/memchr.c,
	* src/memcmp.c,
	* src/memcpy.c,
	* src/memmove.c,
	* src/memset.c,
	* src/stpcpy.c,
	* src/stpncpy.c,
	* src/strcat.c,
	* src/strchr.c,
	* src/strcmp.c,
	* src/strcpy.c,
	* src/strdup.c,
	* src/strerror.c,
	* src/strlcat.c,
	* src/strlcpy.c,
	* src/strlen.c,
	* src/strncat.c,
	* src/strncmp.c,
	* src/strncpy.c,
	* src/strnlen.c: Rename to...

	* libc/bsd/libc/string/bcopy.c,
	* libc/bsd/libc/string/bzero.c,
	* libc/bsd/libc/string/memchr.c,
	* libc/bsd/libc/string/memcmp.c,
	* libc/bsd/libc/string/memcpy.c,
	* libc/bsd/libc/string/memmove.c,
	* libc/bsd/libc/string/memset.c,
	* libc/bsd/libc/string/stpcpy.c,
	* libc/bsd/libc/string/stpncpy.c,
	* libc/bsd/libc/string/strcat.c,
	* libc/bsd/libc/string/strchr.c,
	* libc/bsd/libc/string/strcmp.c,
	* libc/bsd/libc/string/strcpy.c,
	* libc/bsd/libc/string/strdup.c,
	* libc/bsd/libc/string/strerror.c,
	* libc/bsd/libc/string/strlcat.c,
	* libc/bsd/libc/string/strlcpy.c,
	* libc/bsd/libc/string/strlen.c,
	* libc/bsd/libc/string/strncat.c,
	* libc/bsd/libc/string/strncmp.c,
	* libc/bsd/libc/string/strncpy.c,
	* libc/bsd/libc/string/strnlen.c: ...here.


	* src/malloc.c,
	* src/malloc_excl.c,
	* src/malloc_wrappers.c,
	* include/svp/mtmalloc.h: Rename to...

	* libc/malloc/malloc.c,
	* libc/malloc/malloc_excl.c,
	* libc/malloc/malloc_wrappers.c,
	* libc/malloc/mtmalloc.h: ...here.

	* src/missing_uclibc_math.c: Rename to...
	* libc/math/missing_uclibc_math.c: ...here.

	* src/mtalpha/divide.S,
	* src/mtalpha/m/acosf.o,
	* src/mtalpha/m/acoshf.o,
	* src/mtalpha/m/asinf.o,
	* src/mtalpha/m/asinhf.o,
	* src/mtalpha/m/atan2f.o,
	* src/mtalpha/m/atanf.o,
	* src/mtalpha/m/atanhf.o,
	* src/mtalpha/m/cabsf.o,
	* src/mtalpha/m/carg.o,
	* src/mtalpha/m/cargf.o,
	* src/mtalpha/m/cbrtf.o,
	* src/mtalpha/m/ceilf.o,
	* src/mtalpha/m/copysignf.o,
	* src/mtalpha/m/cosf.o,
	* src/mtalpha/m/coshf.o,
	* src/mtalpha/m/e_acos.o,
	* src/mtalpha/m/e_acosh.o,
	* src/mtalpha/m/e_asin.o,
	* src/mtalpha/m/e_atan2.o,
	* src/mtalpha/m/e_atanh.o,
	* src/mtalpha/m/e_cosh.o,
	* src/mtalpha/m/e_exp.o,
	* src/mtalpha/m/e_fmod.o,
	* src/mtalpha/m/e_gamma.o,
	* src/mtalpha/m/e_gamma_r.o,
	* src/mtalpha/m/e_hypot.o,
	* src/mtalpha/m/e_j0.o,
	* src/mtalpha/m/e_j1.o,
	* src/mtalpha/m/e_jn.o,
	* src/mtalpha/m/e_lgamma.o,
	* src/mtalpha/m/e_lgamma_r.o,
	* src/mtalpha/m/e_log.o,
	* src/mtalpha/m/e_log10.o,
	* src/mtalpha/m/e_log2.o,
	* src/mtalpha/m/e_pow.o,
	* src/mtalpha/m/e_rem_pio2.o,
	* src/mtalpha/m/e_remainder.o,
	* src/mtalpha/m/e_scalb.o,
	* src/mtalpha/m/e_sinh.o,
	* src/mtalpha/m/e_sqrt.o,
	* src/mtalpha/m/erfcf.o,
	* src/mtalpha/m/erff.o,
	* src/mtalpha/m/exp2f.o,
	* src/mtalpha/m/expf.o,
	* src/mtalpha/m/expm1f.o,
	* src/mtalpha/m/fabsf.o,
	* src/mtalpha/m/fdimf.o,
	* src/mtalpha/m/floorf.o,
	* src/mtalpha/m/fmaf.o,
	* src/mtalpha/m/fmaxf.o,
	* src/mtalpha/m/fminf.o,
	* src/mtalpha/m/fmodf.o,
	* src/mtalpha/m/frexpf.o,
	* src/mtalpha/m/hypotf.o,
	* src/mtalpha/m/ilogbf.o,
	* src/mtalpha/m/k_cos.o,
	* src/mtalpha/m/k_rem_pio2.o,
	* src/mtalpha/m/k_sin.o,
	* src/mtalpha/m/k_standard.o,
	* src/mtalpha/m/k_tan.o,
	* src/mtalpha/m/ldexpf.o,
	* src/mtalpha/m/lgammaf.o,
	* src/mtalpha/m/llrintf.o,
	* src/mtalpha/m/llroundf.o,
	* src/mtalpha/m/log10f.o,
	* src/mtalpha/m/log1pf.o,
	* src/mtalpha/m/log2f.o,
	* src/mtalpha/m/logbf.o,
	* src/mtalpha/m/logf.o,
	* src/mtalpha/m/lrintf.o,
	* src/mtalpha/m/lroundf.o,
	* src/mtalpha/m/modff.o,
	* src/mtalpha/m/nan.o,
	* src/mtalpha/m/nearbyintf.o,
	* src/mtalpha/m/nextafterf.o,
	* src/mtalpha/m/powf.o,
	* src/mtalpha/m/remainderf.o,
	* src/mtalpha/m/remquof.o,
	* src/mtalpha/m/rintf.o,
	* src/mtalpha/m/roundf.o,
	* src/mtalpha/m/s_asinh.o,
	* src/mtalpha/m/s_atan.o,
	* src/mtalpha/m/s_cbrt.o,
	* src/mtalpha/m/s_ceil.o,
	* src/mtalpha/m/s_copysign.o,
	* src/mtalpha/m/s_cos.o,
	* src/mtalpha/m/s_erf.o,
	* src/mtalpha/m/s_expm1.o,
	* src/mtalpha/m/s_fabs.o,
	* src/mtalpha/m/s_fdim.o,
	* src/mtalpha/m/s_finite.o,
	* src/mtalpha/m/s_finitef.o,
	* src/mtalpha/m/s_floor.o,
	* src/mtalpha/m/s_fma.o,
	* src/mtalpha/m/s_fmax.o,
	* src/mtalpha/m/s_fmin.o,
	* src/mtalpha/m/s_fpclassify.o,
	* src/mtalpha/m/s_fpclassifyf.o,
	* src/mtalpha/m/s_frexp.o,
	* src/mtalpha/m/s_ilogb.o,
	* src/mtalpha/m/s_isinf.o,
	* src/mtalpha/m/s_isinff.o,
	* src/mtalpha/m/s_isnan.o,
	* src/mtalpha/m/s_isnanf.o,
	* src/mtalpha/m/s_ldexp.o,
	* src/mtalpha/m/s_lib_version.o,
	* src/mtalpha/m/s_llrint.o,
	* src/mtalpha/m/s_llround.o,
	* src/mtalpha/m/s_log1p.o,
	* src/mtalpha/m/s_logb.o,
	* src/mtalpha/m/s_lrint.o,
	* src/mtalpha/m/s_lround.o,
	* src/mtalpha/m/s_matherr.o,
	* src/mtalpha/m/s_modf.o,
	* src/mtalpha/m/s_nearbyint.o,
	* src/mtalpha/m/s_nextafter.o,
	* src/mtalpha/m/s_remquo.o,
	* src/mtalpha/m/s_rint.o,
	* src/mtalpha/m/s_round.o,
	* src/mtalpha/m/s_scalbln.o,
	* src/mtalpha/m/s_scalbn.o,
	* src/mtalpha/m/s_signbit.o,
	* src/mtalpha/m/s_signbitf.o,
	* src/mtalpha/m/s_signgam.o,
	* src/mtalpha/m/s_significand.o,
	* src/mtalpha/m/s_sin.o,
	* src/mtalpha/m/s_tan.o,
	* src/mtalpha/m/s_tanh.o,
	* src/mtalpha/m/s_trunc.o,
	* src/mtalpha/m/scalblnf.o,
	* src/mtalpha/m/scalbnf.o,
	* src/mtalpha/m/sinf.o,
	* src/mtalpha/m/sinhf.o,
	* src/mtalpha/m/sqrtf.o,
	* src/mtalpha/m/tanf.o,
	* src/mtalpha/m/tanhf.o,
	* src/mtalpha/m/tgammaf.o,
	* src/mtalpha/m/truncf.o,
	* src/mtalpha/m/w_acos.o,
	* src/mtalpha/m/w_acosh.o,
	* src/mtalpha/m/w_asin.o,
	* src/mtalpha/m/w_atan2.o,
	* src/mtalpha/m/w_atanh.o,
	* src/mtalpha/m/w_cabs.o,
	* src/mtalpha/m/w_cosh.o,
	* src/mtalpha/m/w_drem.o,
	* src/mtalpha/m/w_exp.o,
	* src/mtalpha/m/w_exp2.o,
	* src/mtalpha/m/w_fmod.o,
	* src/mtalpha/m/w_gamma.o,
	* src/mtalpha/m/w_hypot.o,
	* src/mtalpha/m/w_j0.o,
	* src/mtalpha/m/w_j1.o,
	* src/mtalpha/m/w_jn.o,
	* src/mtalpha/m/w_lgamma.o,
	* src/mtalpha/m/w_lgamma_r.o,
	* src/mtalpha/m/w_log.o,
	* src/mtalpha/m/w_log10.o,
	* src/mtalpha/m/w_log2.o,
	* src/mtalpha/m/w_pow.o,
	* src/mtalpha/m/w_remainder.o,
	* src/mtalpha/m/w_sinh.o,
	* src/mtalpha/m/w_sqrt.o,
	* src/mtalpha/m/w_tgamma.o,
	* src/mtalpha/mtdiv.s: Rename to...

	* libc/math/mtalpha/divide.S,
	* libc/math/mtalpha/m/acosf.o,
	* libc/math/mtalpha/m/acoshf.o,
	* libc/math/mtalpha/m/asinf.o,
	* libc/math/mtalpha/m/asinhf.o,
	* libc/math/mtalpha/m/atan2f.o,
	* libc/math/mtalpha/m/atanf.o,
	* libc/math/mtalpha/m/atanhf.o,
	* libc/math/mtalpha/m/cabsf.o,
	* libc/math/mtalpha/m/carg.o,
	* libc/math/mtalpha/m/cargf.o,
	* libc/math/mtalpha/m/cbrtf.o,
	* libc/math/mtalpha/m/ceilf.o,
	* libc/math/mtalpha/m/copysignf.o,
	* libc/math/mtalpha/m/cosf.o,
	* libc/math/mtalpha/m/coshf.o,
	* libc/math/mtalpha/m/e_acos.o,
	* libc/math/mtalpha/m/e_acosh.o,
	* libc/math/mtalpha/m/e_asin.o,
	* libc/math/mtalpha/m/e_atan2.o,
	* libc/math/mtalpha/m/e_atanh.o,
	* libc/math/mtalpha/m/e_cosh.o,
	* libc/math/mtalpha/m/e_exp.o,
	* libc/math/mtalpha/m/e_fmod.o,
	* libc/math/mtalpha/m/e_gamma.o,
	* libc/math/mtalpha/m/e_gamma_r.o,
	* libc/math/mtalpha/m/e_hypot.o,
	* libc/math/mtalpha/m/e_j0.o,
	* libc/math/mtalpha/m/e_j1.o,
	* libc/math/mtalpha/m/e_jn.o,
	* libc/math/mtalpha/m/e_lgamma.o,
	* libc/math/mtalpha/m/e_lgamma_r.o,
	* libc/math/mtalpha/m/e_log.o,
	* libc/math/mtalpha/m/e_log10.o,
	* libc/math/mtalpha/m/e_log2.o,
	* libc/math/mtalpha/m/e_pow.o,
	* libc/math/mtalpha/m/e_rem_pio2.o,
	* libc/math/mtalpha/m/e_remainder.o,
	* libc/math/mtalpha/m/e_scalb.o,
	* libc/math/mtalpha/m/e_sinh.o,
	* libc/math/mtalpha/m/e_sqrt.o,
	* libc/math/mtalpha/m/erfcf.o,
	* libc/math/mtalpha/m/erff.o,
	* libc/math/mtalpha/m/exp2f.o,
	* libc/math/mtalpha/m/expf.o,
	* libc/math/mtalpha/m/expm1f.o,
	* libc/math/mtalpha/m/fabsf.o,
	* libc/math/mtalpha/m/fdimf.o,
	* libc/math/mtalpha/m/floorf.o,
	* libc/math/mtalpha/m/fmaf.o,
	* libc/math/mtalpha/m/fmaxf.o,
	* libc/math/mtalpha/m/fminf.o,
	* libc/math/mtalpha/m/fmodf.o,
	* libc/math/mtalpha/m/frexpf.o,
	* libc/math/mtalpha/m/hypotf.o,
	* libc/math/mtalpha/m/ilogbf.o,
	* libc/math/mtalpha/m/k_cos.o,
	* libc/math/mtalpha/m/k_rem_pio2.o,
	* libc/math/mtalpha/m/k_sin.o,
	* libc/math/mtalpha/m/k_standard.o,
	* libc/math/mtalpha/m/k_tan.o,
	* libc/math/mtalpha/m/ldexpf.o,
	* libc/math/mtalpha/m/lgammaf.o,
	* libc/math/mtalpha/m/llrintf.o,
	* libc/math/mtalpha/m/llroundf.o,
	* libc/math/mtalpha/m/log10f.o,
	* libc/math/mtalpha/m/log1pf.o,
	* libc/math/mtalpha/m/log2f.o,
	* libc/math/mtalpha/m/logbf.o,
	* libc/math/mtalpha/m/logf.o,
	* libc/math/mtalpha/m/lrintf.o,
	* libc/math/mtalpha/m/lroundf.o,
	* libc/math/mtalpha/m/modff.o,
	* libc/math/mtalpha/m/nan.o,
	* libc/math/mtalpha/m/nearbyintf.o,
	* libc/math/mtalpha/m/nextafterf.o,
	* libc/math/mtalpha/m/powf.o,
	* libc/math/mtalpha/m/remainderf.o,
	* libc/math/mtalpha/m/remquof.o,
	* libc/math/mtalpha/m/rintf.o,
	* libc/math/mtalpha/m/roundf.o,
	* libc/math/mtalpha/m/s_asinh.o,
	* libc/math/mtalpha/m/s_atan.o,
	* libc/math/mtalpha/m/s_cbrt.o,
	* libc/math/mtalpha/m/s_ceil.o,
	* libc/math/mtalpha/m/s_copysign.o,
	* libc/math/mtalpha/m/s_cos.o,
	* libc/math/mtalpha/m/s_erf.o,
	* libc/math/mtalpha/m/s_expm1.o,
	* libc/math/mtalpha/m/s_fabs.o,
	* libc/math/mtalpha/m/s_fdim.o,
	* libc/math/mtalpha/m/s_finite.o,
	* libc/math/mtalpha/m/s_finitef.o,
	* libc/math/mtalpha/m/s_floor.o,
	* libc/math/mtalpha/m/s_fma.o,
	* libc/math/mtalpha/m/s_fmax.o,
	* libc/math/mtalpha/m/s_fmin.o,
	* libc/math/mtalpha/m/s_fpclassify.o,
	* libc/math/mtalpha/m/s_fpclassifyf.o,
	* libc/math/mtalpha/m/s_frexp.o,
	* libc/math/mtalpha/m/s_ilogb.o,
	* libc/math/mtalpha/m/s_isinf.o,
	* libc/math/mtalpha/m/s_isinff.o,
	* libc/math/mtalpha/m/s_isnan.o,
	* libc/math/mtalpha/m/s_isnanf.o,
	* libc/math/mtalpha/m/s_ldexp.o,
	* libc/math/mtalpha/m/s_lib_version.o,
	* libc/math/mtalpha/m/s_llrint.o,
	* libc/math/mtalpha/m/s_llround.o,
	* libc/math/mtalpha/m/s_log1p.o,
	* libc/math/mtalpha/m/s_logb.o,
	* libc/math/mtalpha/m/s_lrint.o,
	* libc/math/mtalpha/m/s_lround.o,
	* libc/math/mtalpha/m/s_matherr.o,
	* libc/math/mtalpha/m/s_modf.o,
	* libc/math/mtalpha/m/s_nearbyint.o,
	* libc/math/mtalpha/m/s_nextafter.o,
	* libc/math/mtalpha/m/s_remquo.o,
	* libc/math/mtalpha/m/s_rint.o,
	* libc/math/mtalpha/m/s_round.o,
	* libc/math/mtalpha/m/s_scalbln.o,
	* libc/math/mtalpha/m/s_scalbn.o,
	* libc/math/mtalpha/m/s_signbit.o,
	* libc/math/mtalpha/m/s_signbitf.o,
	* libc/math/mtalpha/m/s_signgam.o,
	* libc/math/mtalpha/m/s_significand.o,
	* libc/math/mtalpha/m/s_sin.o,
	* libc/math/mtalpha/m/s_tan.o,
	* libc/math/mtalpha/m/s_tanh.o,
	* libc/math/mtalpha/m/s_trunc.o,
	* libc/math/mtalpha/m/scalblnf.o,
	* libc/math/mtalpha/m/scalbnf.o,
	* libc/math/mtalpha/m/sinf.o,
	* libc/math/mtalpha/m/sinhf.o,
	* libc/math/mtalpha/m/sqrtf.o,
	* libc/math/mtalpha/m/tanf.o,
	* libc/math/mtalpha/m/tanhf.o,
	* libc/math/mtalpha/m/tgammaf.o,
	* libc/math/mtalpha/m/truncf.o,
	* libc/math/mtalpha/m/w_acos.o,
	* libc/math/mtalpha/m/w_acosh.o,
	* libc/math/mtalpha/m/w_asin.o,
	* libc/math/mtalpha/m/w_atan2.o,
	* libc/math/mtalpha/m/w_atanh.o,
	* libc/math/mtalpha/m/w_cabs.o,
	* libc/math/mtalpha/m/w_cosh.o,
	* libc/math/mtalpha/m/w_drem.o,
	* libc/math/mtalpha/m/w_exp.o,
	* libc/math/mtalpha/m/w_exp2.o,
	* libc/math/mtalpha/m/w_fmod.o,
	* libc/math/mtalpha/m/w_gamma.o,
	* libc/math/mtalpha/m/w_hypot.o,
	* libc/math/mtalpha/m/w_j0.o,
	* libc/math/mtalpha/m/w_j1.o,
	* libc/math/mtalpha/m/w_jn.o,
	* libc/math/mtalpha/m/w_lgamma.o,
	* libc/math/mtalpha/m/w_lgamma_r.o,
	* libc/math/mtalpha/m/w_log.o,
	* libc/math/mtalpha/m/w_log10.o,
	* libc/math/mtalpha/m/w_log2.o,
	* libc/math/mtalpha/m/w_pow.o,
	* libc/math/mtalpha/m/w_remainder.o,
	* libc/math/mtalpha/m/w_sinh.o,
	* libc/math/mtalpha/m/w_sqrt.o,
	* libc/math/mtalpha/m/w_tgamma.o,
	* libc/math/mtalpha/mtdiv.s: ...here.

	* src/ctype.c,
	* src/dtoa_simple.c,
	* src/errno.c: Rename to...

	* libc/misc/ctype.c,
	* libc/misc/dtoa_simple.c,
	* libc/misc/errno.c: ...here.

	* src/fputc.c,
	* src/fputs.c,
	* src/fwrite.c,
	* src/mtstdio.c,
	* src/mtstdio.h,
	* src/perror.c,
	* src/putc.c,
	* src/putchar.c,
	* src/puts.c,
	* src/snprintf.c,
	* src/vprintf.c,
	* src/vsnprintf.c: Rename to...

	* libc/stdio/fputc.c,
	* libc/stdio/fputs.c,
	* libc/stdio/fwrite.c,
	* libc/stdio/mtstdio.c,
	* libc/stdio/mtstdio.h,
	* libc/stdio/perror.c,
	* libc/stdio/putc.c,
	* libc/stdio/putchar.c,
	* libc/stdio/puts.c,
	* libc/stdio/snprintf.c,
	* libc/stdio/vprintf.c,
	* libc/stdio/vsnprintf.c: ...here.

	* src/ffs.c: Rename to...
	* libc/string/ffs.c: ...here.

	* src/gfx.c,
	* src/mtgfx.c: Rename to...
	* mgos/gfx/gfx.c,
	* mgos/gfx/mtgfx.c: ...here.

	* src/mtinit.c: Rename to...
	* mgos/init/mtinit.c: ...here.

	* src/mtargs.c,
	* src/mtinput.c: Rename to...
	* mgos/input/mtargs.c,
	* mgos/input/mtinput.c: ...here.

	* src/RPCServiceDatabase.h,
	* src/mgsim.h,
	* src/mtconf.c,
	* src/mtconf.h: Rename to...
	* mgos/mgsim/RPCServiceDatabase.h,
	* mgos/mgsim/mgsim.h,
	* mgos/mgsim/mtconf.c,
	* mgos/mgsim/mtconf.h: ...here.

	* src/abort.c,
	* src/exit.c,
	* src/gtod.c,
	* src/gtod_virtual.c,
	* src/heap.c,
	* src/heap.h,
	* src/mtclock.c,
	* src/mtunix.c,
	* src/time.c,
	* src/time_virtual.c: Rename to...

	* mgos/posix-compat/abort.c,
	* mgos/posix-compat/exit.c,
	* mgos/posix-compat/gtod.c,
	* mgos/posix-compat/gtod_virtual.c,
	* mgos/posix-compat/heap.c,
	* mgos/posix-compat/heap.h,
	* mgos/posix-compat/mtclock.c,
	* mgos/posix-compat/mtunix.c,
	* mgos/posix-compat/time.c,
	* mgos/posix-compat/time_virtual.c: ...here.

	* src/dummysep.c: Rename to...
	* mgos/sep/dummysep.c: ...here.
	* src/mtsep.c: Rename to...
	* mgos/sep/mtsep.c: ...here.

	* src/tlsmalloc/Makefile.am,
	* src/tlsmalloc/tls_arch_mtalpha.h,
	* src/tlsmalloc/tls_arch_mtsparc_fpga.h,
	* src/tlsmalloc/tls_arch_mtsparc_sim.h,
	* src/tlsmalloc/tls_arch_pthreads.h,
	* src/tlsmalloc/tlsconfig.h,
	* src/tlsmalloc/tlsmalloc.c,
	* src/tlsmalloc/tlsmalloc.h,
	* src/tlsmalloc/tlsmcheck.c,
	* src/tlsmalloc/tricks.h,
	* src/tlstack_malloc.c: Rename to...

	* mgos/tlsmalloc/Makefile.am,
	* mgos/tlsmalloc/tls_arch_mtalpha.h,
	* mgos/tlsmalloc/tls_arch_mtsparc_fpga.h,
	* mgos/tlsmalloc/tls_arch_mtsparc_sim.h,
	* mgos/tlsmalloc/tls_arch_pthreads.h,
	* mgos/tlsmalloc/tlsconfig.h,
	* mgos/tlsmalloc/tlsmalloc.c,
	* mgos/tlsmalloc/tlsmalloc.h,
	* mgos/tlsmalloc/tlsmcheck.c,
	* mgos/tlsmalloc/tricks.h,
	* mgos/tlstack_malloc.c: ...here.

	* src/mtuart.c: Rename to...
	* mgos/uart/mtuart.c: ...here.

	* src/mtamathobjs.mk: Rename to...
	* mtamathobjs.mk: ...here.

	* src/div.c,
	* src/io.c,
	* src/roman.c: Rename to...

	* slsys/deprecated/div.c,
	* slsys/deprecated/io.c,
	* slsys/deprecated/roman.c: ...here.

	* src/perf.c,
	* src/perf_wrappers.c: Rename to...
	* slsys/perf/perf.c,
	* slsys/perf/perf_wrappers.c: ...here.

	* src/empty.c: Remove.

	* lib/mtalpha.mk,
	* lib/gdtoa.mk,
	* lib/mtamathobjs.mk,
	* lib/Makefile.am: Update accordingly.

2011-11-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor package clean-up.

	* tools/Makefile.am: Extrate sub-parts into into...
	* tools/slc.mk,
	* tools/lib.ml: ...here.

	* tools/lib/r-host.sh.in,
	* tools/lib/r-mt-sim.sh.in,
	* tools/lib/r-mt-fpga.sh.in: Rename to...
	* tools/r-host.sh.in,
	* tools/r-mt-sim.sh.in,
	* tools/r-mt-fpga.sh.in: ...here.

	* tools/lib/Makefile.am: Move the related rules to...
	* tools/runscripts.mk: ...here.
	* tools/Makefile.am: include it.

	* build-aux/slc.m4 (SLC_LIBDIR): Update accordingly.

2011-11-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement a new build layout for `tools'.

	* tools/lib/t-seqc/,
	* tools/lib/t-spr/,
	* tools/lib/t-sppalpha/,
	* tools/lib/t-utc/,
	* tools/lib/t-utc0/,
	* tools/lib/arggen.c,
	* tools/lib/mt-profiles/
	* tools/lib/slc/,
	* tools/lib/slc_config.py.in: Rename to...

	* tools/t-seqc/,
	* tools/t-spr/,
	* tools/t-sppalpha/,
	* tools/t-utc/,
	* tools/t-utc0/,
	* tools/arggen.c,
	* tools/mt-profiles/
	* tools/slc/,
	* tools/slc_config.py.in: ... here.

	* tools/lib/Makefile.am: Move the corresponding rules to...
	* tools/Makefile.am: ... here.

	* tools/lib/Makefile.am,
	* tools/lib/hrt.mk,
	* tools/lib/seqc.mk,
	* tools/lib/ptl.mk,
	* tools/lib/mtalpha.mk,
	* tools/lib/mtsparc.mk,
	* tools/lib/host-host-ptl/,
	* tools/lib/t-ptl/: Retire to...

	* tools/lib/attic/Makefile.am,
	* tools/lib/attic/hrt.mk,
	* tools/lib/attic/seqc.mk,
	* tools/lib/attic/ptl.mk,
	* tools/lib/attic/mtalpha.mk,
	* tools/lib/attic/mtsparc.mk,
	* tools/lib/attic/host-host-ptl/,
	* tools/lib/attic/t-ptl/: ... here.

	* tools/lib/dummyplaces.c,
	* tools/lib/empty.c,
	* tools/lib/fibre.c,
	* tools/lib/main.c: Rename to...

	* tools/lib/common/dummyplaces.c,
	* tools/lib/common/empty.c,
	* tools/lib/common/fibre.c,
	* tools/lib/common/main.c: ...here.

	* tools/lib/host-host-seqc/load.c,
	* tools/lib/host-host-seqc/slrt.c: Rename to...

	* tools/lib/host/load.c,
	* tools/lib/host/slrt.c: ...here.

	* tools/lib/host-host-hrt/include/sl_hrt.h,
	* tools/lib/host-host-hrt/tc.c,
	* tools/lib/host-host-hrt/slrt.c: Rename to...

	* tools/lib/hrt/include/sl_hrt.h,
	* tools/lib/hrt/tc.c,
	* tools/lib/hrt/slrt.c: ...here.

	* tools/lib/mgsim.c,
	* tools/lib/mtplaces.c: Rename to...
	* tools/lib/mt/mgsim.c,
	* tools/lib/mt/mtplaces.c: ...here.

	* tools/lib/mtalpha-sim/slrt.s,
	* tools/lib/mtalpha-sim/callgate.s,
	* tools/lib/mtsparc-fpga/slrt.s,
	* tools/lib/mtsparc-fpga/callgate.s: Rename to...

	* tools/lib/mt/mta/slrt.s,
	* tools/lib/mt/mta/callgate.s,
	* tools/lib/mt/mts/slrt.s,
	* tools/lib/mt/mts/callgate.s: ...here.

	* tools/lib/configure.ac,
	* tools/lib/Makefile.am,
	* tools/lib/host-host-seqc/Makefile.am,
	* tools/lib/host-host-ptl/Makefile.am,
	* tools/lib/host-host-ptld/Makefile.am,
	* tools/lib/host-host-hlsim/Makefile.am,
	* tools/lib/host-host-hlsimd/Makefile.am,
	* tools/lib/mtalpha-sim/Makefile.am,
	* tools/lib/mtsparc-sim/Makefile.am,
	* tools/lib/mtsparc-fpga/Makefile.am,
	* tools/lib/common.mk,
	* tools/lib/mt.mk,
	* tools/lib/host.mk: New.

	* tools/Makefile.am: Define rules to recurse into `lib' with CC
	set to the newly-built `slc'.

	* configure.ac: Adjust the list of generated files accordingly.

	* build-aux/slc.m4: Also pass `SLRAR' and `SLRANLIB'.

	* tools/bin/cce.in: Define a new set of `ptl' and `hlsim'
	targets. Find `slrt' using the new directory layout.

	* lib/ptl.mk: Use the new `ptl' target name.

2011-11-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Clean-up to prepare for a new build layout.

	* Makefile.am: Fix target `show-vars': use `tools' instead of
	`slc/tools'.

	* build-aux/slc.m4: Split the `--enable' flag detection into a
	separate macro `SLC_CHECK_TARGETS'.

	* lib/src/empty.c: Replace the symlink by a copy.

	* tools/lib/arggen.c: Make the special case about the host
	platform, not the MT targets.

	* tools/lib/dummyplaces.c: Include `stdlib.h' for `abort'.

	* tools/bin/slranlib.in,
	* tools/bin/slar.in: Lookup the tools via `cce' as if `-nostdlib'
	was passed, to reduce warnings when used to build slrt/libslc
	initially.

2011-11-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Integrate utc-ptl / hlsim better into the tool chain.

	* tools/bin/cce.in: New aliases `hls' next to `ptl'. Use the
	former for compilation through hlsim, the latter for pure
	utc-ptl. Extract the compiler / flag information from the
	configuration file installed with both libraries.

	* build-aux/slc.m4,
	* configure.ac,
	* tools/bin/Makefile.am (edit_scripts): Allow to configure the
	path to the hlsim/ptl libraries+headers. Pass them as variables
	when generating `cce'.

	* tools/lib/ptl.mk (SLC_PTL): Remove the extra flags, as these are
	now inherited from the hlsim/ptl installation.

2011-10-24  M. Irfan-Ud-Din <m.irfan-ud-din@uva.nl>

	Start integration with latest utc-ptl/hlsim revisions.

	* tools/bin/cce.in: New aliases `ptl_n', `ptl_s'. Set these and
	`ptl' to use the `spr' front-end.

	* tools/lib/slc/ptl/__init__.py,
	* tools/lib/slc/ptl/genptlcreate.py,
	* tools/lib/slc/ptl/gentfun.py: New.
	* tools/lib/Makefile.am: List the new files.

	* tools/lib/slc/front/chains.py: Add the corresponding chains.

	* tools/lib/t-spr/include/sl_support.h: Extend accordingly.

	* tools/include/svp/delegate.h: Simplify (use the same definition
	of `sl_place_t').

	* tools/lib/slc/lower/split.py (SplitFuns.visit_fundef): Mark the
	handling of `extern' and `static' for future work (they don't
	behave well with ptl/hlsim yet).

2011-10-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Allow to disable automatic `swch' placement.

	A new pseudo-directive pair `.swch' and `.noswch' configure
	whether the assembly post-processor automatically adds the `swch'
	annotation.

	* tools/lib/slc/mt/common/asmproc/swch.py (rmswchdir):
	New. Removes the pseudo-directives at the end of processing (since
	they are not recognized by the assembler).

	* tools/lib/slc/mt/mtsparc/asmproc/opt.py (makedataflow),
	tools/lib/slc/mt/mtalpha/asmproc/opt.py (addswchll): Use the new
	pseudo-directives. Also invoke `rmswchdir'.

2011-10-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Simplify the delegation API.

	* tools/include/svp/delegate.h: Simplify. Use the same constants
	(0/1) for the symbolic place identifiers across all
	implementations. Provide new primitives (macros)
	`sl_default_placement', `sl_local_processor_address',
	`sl_placement_size', `sl_first_processor_address' for use in
	programs.

	* tools/lib/dummyplaces.c: Homogeneise the
	implementation. Anything else than MT targets and `seqc' are not
	implemented yet.

2011-10-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	New MT code generation optimization.

	As of MGSim r4608, reads to empty *local* registers automatically
	translate to reads of zero. This allows the compiler to spill
	these registers without an initial setup, so we can avoid forcing
	them to zero upon thread start-up explicitly.

	* tools/lib/slc/mt/mtalpha/asmproc/base.py (protectcallregs)
	(makeprotectspecial, protectallcallregs, protectcallsave),
	* tools/lib/slc/mt/mtsparc/asmproc/base.py (protectallcallregs):
	Only emit the instructions to pre-clear local registers if the
	configuration option `clear-local-regs' is enabled.

	* tools/bin/cce.in: Enable the option `clear-local-regs' only for
	the UTLEON3 target.

	* tools/bin/slc.in: Document the new option.

2011-10-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update the handling of local places as per MGSim r4608.

	* tools/include/svp/delegate.h (__inline_get_local_place): Ensure
	that the explicit local place identifier has valid capability bits
	by copying the capability from the default place.
	(PLACE_LOCAL): Use `1' as this is now normalized properly by
	MGSim.

2011-10-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Avoid using the entire grid by default for `t_main.'

	* lib/src/mtinit.c (sys_check_ncores): Use the entire grid if
	`SLR_NCORES' is explicitly set to 0.

	* tools/bin/slr.in (SLR_NCORES): Delegate t_main to a 1-core place
	by default. Document the new behavior of -n 0.

2011-09-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for clearing the graphical output.

	* lib/include/svp/gfx.h: New API `gfx_clear()'.

	* lib/src/mtgfx.c: Implement it. This uses the latest display I/O
	device feature from MGSim 3.1.202 or later.

	* lib/src/gfx.c: Implement the software replacement.

2011-09-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a bug in the I/O subsystem.

	* lib/src/mtconf.c: Import the latest version from MGSim. This
	ensures that the `mg_io_place_id' is a 1-core place identifier.

2011-09-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix the configurability of the Python interpreter.

	* tools/bin/cce.in (slc_translator): Ensure that the
	Autoconf-detected @PYTHON@ is used to run `spr', since the default
	Python might not be appropriate (v2.7 will do, v3.x will not).

	* doc/README.txt: Document the Python version requirement.

2011-09-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Remove support for "infinite" families.

	* tools/lib/t-seqc/slimpl.m4,
	* tools/lib/slc/lower/seq.py (Create_2_Loop.visit_lowcreate):
	Do it.

2011-08-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement an UART driver for the Microgrid.

	* lib/src/mtstdio.h: Extend C's `FILE' to support output via a
	callback function.

	* lib/src/mtuart.c: New. Define `uart_getc', `uart_putc', and
	`FILE *stduart' for use by programs.

	* lib/mtalpha.mk: Compile it.
	* lib/Makefile.am: Distribute it.

2011-08-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the C library for MT platforms.

	* lib/src/memchr.c,
	* lib/src/memcmp.c: New.

	* lib/mtalpha-sim/include/string.h: Declare them.

	* lib/mtalpha.mk: Compile them.

2011-08-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a code generation bug for MT-SPARC.

	The bug was caused by invalid renaming (for reg. window
	compression) of registers involved in a double-register operation
	(eg. `ldd', `std'). These should be renamed in pairs in a way that
	preserves the odd- or even-ness of the register number.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py (markaligned): Detect
	registers involved in a double-register operation (ldd,std).

	* tools/lib/slc/mt/common/asmproc/compress.py
	(makespecialtransform): Avoid renaming special registers if they
	are involved in a double-register operation.

	* tools/lib/slc/mt/common/asmproc/compress.py (compress): Ensure
	that the reduced local window size is even if any globals or
	shared are involved in a ldd/std operation. Likewise with the
	global window size and shared registers.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py (renamelocals): Rename
	any registers involved in a double-registers operation in pairs
	atomically, or not at all (ie avoid renaming only one half).

2011-08-05  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `slc -fdump-fixup-XXX' on MT-SPARC.

	* tools/bin/slc.in: Ensure that `extra_f1flags' are passed to
	`cce' so that `cce' can append any new values (eg `-x
	tls-via-gettid') to the values specified on `slc's command line.

	* tools/slc/cce.in: Acknowledge any previously set value to
	`extra_f1flags'.

2011-08-05  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a code generation bug for MT-SPARC.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py (initsp, replsave):
	Rename `initsp' to `initspfp'. Ensure that %fp is set when `save'
	was removed, because `save' would have initialized %fp as an alias
	for the original value of %sp.

2011-07-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Align the MT profiles to the latest MGSim configuration.

	* tools/lib/mt-profiles/default,
	* tools/lib/mt-profiles/coma128: Do it.

	* tools/lib/mt-profiles/lzcoma_default,
	* tools/lib/mt-profiles/mlcoma_default: Delete.

	* tools/lib/Makefile.am: Update accordingly.

2011-07-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* lib/mtsparc2.mk (nobase_dist_pkgdata_DATA),
	* lib/mtsparc2.mk (nobase_dist_pkgdata_DATA): List all the MT
	header files.

2011-07-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix passing of command-line arguments when `MGSYS_QUIET' is set.

	* tools/lib/mtalpha-sim/slrt.s: Put the pseudo `$progname' in
	section .rodata.

	* lib/src/mtconf.c: Import the latest version from MGSim. This
	detects devices properly even when `verbose_boot' is not set.

	* lib/src/mtini.c: Ensure that `__main_place_id' is set properly
	even when `verbose_boot' is not set.

2011-07-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the POSIX file interface.

	* lib/src/mtunix.c: Separate argument and result data as per the
	latest RPC code in MGSim.

2011-07-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix an overflow error in `gettimeofday_virtual'.

	* lib/src/gtod_virtual.c (gettimeofday_virtual): Use types large
	enough for the results of large multiplies.

2011-07-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance `slr'.

	* tools/bin/slr.in: Fix the behavior of `--'. Allow to set the
	program name after `--'.

2011-07-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement some POSIX file interfaces for MT targets.

	* lib/mtalpha-sim/include/sys/types.h: Add some type definitions
	useful for `struct stat'.

	* lib/mtalpha-sim/include/sys/stat.h,
	* lib/mtalpha-sim/include/unistd.h,
	* lib/mtalpha-sim/include/fcntl.h: New.

	* lib/src/RPCServiceDatabase.h: Import from MGSim.

	* lib/src/mtunix.c: New.

	* lib/mtalpha.mk: List the new files.

2011-07-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the C library for MT platforms.

	* lib/mtalpha-sim/include/errno.h: Import more codes from FreeBSD.

	* lib/src/sys_errlist.c: Delete, replace by...
	* lib/src/errlst.c: ...this (imported from FreeBSD).

	* lib/src/perror.c: Use the stdio output functions.
	* lib/src/puts.c: Include `stdio.h' to check the function
	prototype.

	* lib/mtalpha-sim/include/sys/types.h: New definition for
	`suseconds_t'.

	* lib/mtalpha-sim/include/sys/time.h,
	* lib/src/gtod.c,
	* lib/src/gtod_virtual.c: New.

	* lib/src/time.c: Replace to use `gettimeofday'.

	* lib/mtalpha-sim/include/time.h: Declare `time_virtual'.
	* lib/src/time_virtual.c: New.

	* lib/mtalpha.mk: List the new files. Separate MG-specific sources
	that need SL extensions (MTALIB_SIM_SRC) from those that don't
	(MTALIB_SIM_CSRC). Compile the latter only once.
	* lib/mtsparc.mk: Also compile the sources from MTALIB_SIM_CSRC.

2011-07-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update the MG initialization code from upstream.

	* lib/src/mtconf.h,
	* lib/src/mtconf.c: Import the latest version from MGSim. This
	detects the RPC interface and configures its notification channel.

2011-07-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor library clean-ups.

	* lib/src/perf.c (mtperf_counter_names): Ensure that all columns
	have unique names (requested by D. Rolls).

	* lib/include/svp/gfx.h,
	* lib/include/svp/perf.h: Remove unused definitions.

2011-06-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the I/O APIs.

	* lib/src/mtconf.h,
	* lib/src/mtconf.c: Import the latest version from MGSim. This
	preserves the I/O place ID during device detection.

	* lib/src/time.c: Use the I/O place ID.

	* lib/include/svp/gfx.h: Turn the inlinable code into...
	* lib/src/mtgfx.c: ...delegations to the I/O core on the
	Microgrid.
	* lib/src/gfx.c: Provide alternate implementations for other
	targets.

2011-06-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Ensure that the debug objects for `malloc' use assertions.

	* lib/mtalpha.mk (TLSMALLOC_DEFS): Do not use `-DNDEBUG' here.

2011-06-23  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Install the debug objects for `malloc'.

	(Requested by C. Joslin.)

	* lib/Makefile.am (pkglib_DATA): New.
	* lib/mtalpha.mk,
	* lib/mtsparc.mk,
	* lib/mtsparc2.mk: Install all the alternate implementations of
	`malloc'.

2011-06-22  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* lib/gdtoa.mk (EXTRA_DIST): Ensure all sources are listed.

2011-06-22  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Ensure that argv[0] is properly provided to MT programs.

	* tools/lib/r-mt-sim.sh.in (exec): Do it.

2011-06-22  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix argument data generation for `slr'.

	* tools/lib/mt-profiles/arggen: Ensure there are enough cores for
	the system places.

2011-06-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Externalize the MGSim configuration code.

	* lib/src/mtconf.c: Move the argv-specific code to...
	* lib/src/mtargs.c: ...here.
	* lib/mtalpha.mk: List the new file.

	* lib/src/mtconf.h,
	* lib/src/mtconf.c: Push to MGSim 3.1. Then import back the
	modified copy.

	* lib/src/mtinit.c: Remove the definitions for `verbose_boot' and
	`boot_ts' which are now defined by `mtconf.c'. Declare
	`sys_argv_init'.

2011-06-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement proper locking of some non-reentrant library functions.

	* lib/src/mtinit.c: Reserve 3 system places for stdio
	(`vfprintf'), dlmalloc and dtoa.

	* lib/src/gdtoa/misc.c,
	* lib/src/vfprintf.c,
	* lib/include/svp/mtmalloc.h: Use them.

	* lib/gdtoa.mk,
	* lib/mtalpha.mk: Ensure that the source files that use
	`sl_create' are compiled separately for each compiler target.

2011-06-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance debugging facilities for the TLS heap allocator.

	* lib/src/tlsmalloc/tlsmalloc.c: New check code with footers to
	data structures and magic numbers. This is defined when compiled
	with `-DFOOTERS'. New feature to disable garbage collection when
	compiled with `-DDISABLE_GC'.

	* lib/src/tlsmalloc/Makefile.am: Compile the test code with
	footers enables and extra debugging.

	* lib/mtsparc.mk,
	* lib/mtalpha.mk: New compilation targets `*_tlsmalloc_fast*` and
	`*_tlsmalloc_*_nogc'. The basic (default) object `tlsmalloc.o' now
	uses footer and magic checking with assertions enabled. Link with
	the `_fast' version to disable assertion checking and footers.

2011-06-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Simplify `assert' on MT targets.

	* lib/mtalpha-sim/include/assert.h: Use `svp_abort' to terminate
	so that the failure will be reported in the surrounding code.

	* tools/include/svp/abort.h: Remove an extraneous semicolon.

	* tools/include/svp/mgsim.h: Allow to use the `mgsim_control'
	functions as (void) expressions.

2011-06-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support C's `clock()' on MT-SPARC.

	* lib/mtalpha-sim/include/time.h: Use `%tick' (ASR4) to read the
	processor's cycle counter on MT-SPARC.

2011-06-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor configuration fix.

	* configure.ac: Check for `pthread_barrier_wait' before enabling
	the TLS malloc test code.

2011-06-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor usability enhancement for `slr -p'.

	* tools/lib/r-mt-sim.sh.in: Ensure that extra command-line
	arguments provided to the generated `run.h' are passed to MGSim,
	not the executed program.

2011-06-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for `slr -Mv list'.

	* tools/bin/slr.in: Use `-l' instead of `-D' as required by MGSim
	3.1.

2011-06-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support command-line arguments for programs on MT targets.

	* tools/bin/slr.in,
	* tools/lib/r-mt-sim.sh.in: Ensure that trailing arguments are
	propagated to the simulator.

	* tools/lib/mtalpha-sim/slrt.s: Define `__argc' and `__argv' as a
	writable variable. Use them to load the arguments to `main'.

	* lib/src/mtconf.h,
	* lib/src/mtconf.c,
	* lib/src/mtinit.c: Recognize the argument data ROM if configured
	and load argc/argv[] from it.

2011-06-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the behavior of `slr -n'.

	To prevent result variations due to placement, it is useful to
	allow various values of `-n' to place the execution from the same
	first core. For this a new environment variable `SLR_PLACESIZE' is
	introduced. When this is set, its value is used to allocate a
	place and the value of `-n' (`SLR_NCORES') is then use to adjuste
	the size field within the allocated place identifier.

	* lib/src/mtinit.c (sys_check_ncores): Do it.

2011-06-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix an error reporting bug in `spr'.

	* tools/lib/slc/mt/common/asmproc/fixup.py: Ensure that `die' is
	defined.

2011-06-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance the reporting during the MT boot sequence.

	* lib/src/mtinit.c (sys_environ_init): Properly detect when
	`MGSYS_QUIET' is set.

	* lib/src/mtinit.c,
	* lib/src/mtconf.h: New macro `output_ts' which tracks the number
	of clock cycles elapsed between uses.

	* lib/src/mtinit.c,
	* lib/src/heap.c,
	* lib/src/mtconf.c,
	* lib/src/mtinput.c,
	* lib/src/mtsep.c: Use it.

2011-06-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Simplify the MT profile used to generate input data.

	* tools/lib/mt-profiles/arggen: Disable the configuration ROM, Gfx
	and LCD devices.

2011-06-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor code cleanups.

	* lib/src/mtclock.c: Use `time.h', not the deprecated `ctime.h'.

	* lib/src/perf.c: Drop the labels for the columns that were
	previously reporting wall clock times. These are not implemented
	any more (currently unused).

2011-06-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in `slr'.

	(Reported by Irfan.)

	* tools/lib/load.c (load_binary_data): Use the file size, not the
	padded size, when calling `fread'.

2011-06-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `getenv' for MGSim targets.

	* lib/src/mtinit.c (sys_environ_init): Ensure that the data is
	copied to heap from ROM. Also, detect verbosity early while
	scanning the environment data and avoid printing anything if not
	verbose.

2011-05-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `slr' for MGSim targets.

	* tools/lib/mt-profiles/arggen: New profile for input data
	generation.

	* tools/lib/r-mt-sim.sh.in: Use the new profile when running
	`arggen'.

	* tools/lib/Makefile.am (nobase_dist_pkgdata_DATA): List the new
	file.

2011-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update the Microgrid machine profiles.

	* tools/lib/mt-profiles/lzcoma128_2chan,
	* tools/lib/mt-profiles/lzcoma256_4chan,
	* tools/lib/mt-profiles/mlcoma128_2chan,
	* tools/lib/mt-profiles/mlcoma256_4chan: Update to use the new
	MGSim configuration format.

	* tools/lib/mt-profiles/simple,
	* tools/lib/mt-profiles/lzcoma128_1chan,
	* tools/lib/mt-profiles/lzcoma256_1chan,
	* tools/lib/mt-profiles/mlcoma128_1chan,
	* tools/lib/mt-profiles/mlcoma256_1chan: Delete the rarely-used,
	meaningless profiles.

	* tools/lib/mt-profiles/rbm128,
	* tools/lib/mt-profiles/rbm256: Document that these profiles are
	not realistic.

	* tools/lib/Makefile.am (nobase_dist_pkgdata_DATA): Update
	accordingly.

	* doc/NEWS.txt: Document the change.

2011-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Clearly distinguish 3.5b from 3.6b in the documentation.

	* doc/NEWS.txt: Do it.

2011-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Align the input data on addresses multiple of 64 bytes.

	(feature requested by Bert Gijsbers)

	* build-aux/ax_func_posix_memalign.m4: New.
	* configure.ac: Use it to detect `posix_memalign()'.

	* tools/lib/seqc.mk,
	* tools/lib/ptl.mk,
	* lib/ptl.mk,
	* lib/seqc.mk: Ensure that the configuration defines from Autoconf
	are propagated to all `slc' commands.

	* tools/lib/load.c: Align the data, using `posix_memalign' if
	available.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the documentation.

	* doc/NEWS.txt: Initialize for 3.6.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the documentation.

	* doc/NEWS.txt: Update for version 3.5.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add a missing file.

	* lib/src/mgsim.h: Import from mgsim 3.1.
	* lib/mtalpha.mk (MTALIB_EXTRA): List the new file.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	More changes towards the integration of mgsim 3.1.

	* lib/src/time.c: Use the RTC device (if any) to fetch the time.
	* lib/mtalpha.mk: Compile `time.c' as a MT target.

	* lib/include/svp/gfx.h: Use the same primitives for all targets.
	* lib/src/mtgfx.c: New.
	* lib/mtalpha.mk: List the new file.

	* lib/src/mtconf.c: Also declare the configuration variables...
	* lib/src/mtconf.h: ...here.

	* tools/lib/r-mt-sim.sh.in: Pass the executable file as a ROM
	image.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Ensure that initialization messages are printed to stderr.

	* lib/src/mtconf.c: Do it.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix input of slr variables.

	* tools/bin/sag: Ensure that the data size is populated in the
	last entry.

	* lib/src/mtinput.c: Simplify.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adjust the MT-Alpha entry point.

	* tools/lib/mtalpha-sim/slrt.s: Compute PV locally instead of
	assuming it was set by the environment.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initialize the root SEP based on the size of its "current" place.

	* lib/src/mtsep.c (sys_sep_init): Use `get_current_place()' to
	retrieve the number of cores instead of a configuration
	variable. Assume an homogeneous grid.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Use the configuration ROM to find the architecture parameters.

	* tools/lib/mtalpha-sim/slrt.s: Do not expect a configuration
	pointer in $l2 any more.

	* lib/src/mtconf.h,
	* lib/src/mtconf.c: Instead, use the new ancillary registers and
	SMC device to enumerate the I/O bus, find the configuration ROM
	and copy the configuration values from there. The `mgconf'
	variables now hold the value, instead of a reference.

	* lib/src/mtsep.c,
	* lib/src/perf.c: Use the `mgconf' variables by value.

	* lib/src/mtinit.c: Update accordingly.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support loading the input data from ROMs.

	* tools/bin/slr.in: Ensure that the slr data file is not empty.

	* tools/bin/sag: Mark the end of the data and register the offset,
	so that the size of the data is known. Also, align each generated
	Fibre array on a 64-byte boundary.

	* tools/include/svp/fibre.h: Expose the number of Fibre items with
	`fibre_nitems()'.
	* tools/lib/fibre.c: Implement it.

	* lib/src/mtinit.c: Move the input data pointer initialization to...
	* lib/src/mtinput.c: ... here. Split the initialization. For both
	types of input, copy the data from ROM to the heap.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Declare `dlmemalign' for use during system initialization.

	* lib/include/svp/mtmalloc.h: Declare `dlmemalign'.

2011-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support `strcmp' in the standard library.

	* lib/src/strcmp.c: Import from FreeBSD.
	* lib/mtalpha-sim/include/string.h: Declare it.
	* lib/mtalpha.mk: List it.

2011-05-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance `slt'.

	* tools/bin/slt.in: Escape more characters when generating
	build/test directory names.

2011-04-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Avoid a potential pitfall with the MT-Alpha code generation.

	* tools/lib/slc/mt/mtalpha/gencreate.py
	(Create_2_MTACreate.visit_lowcreate)
	(Create_2_MTACreate.visit_seta): Do not copy the argument names in
	the instruction comment. This is because the other engines may use
	special words (`DELAYED', etc) which might appear in argument
	names in programs.

2011-04-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Small MT-Alpha code generation optimization.

	* tools/lib/slc/mt/mtalpha/regdefs.py
	(RegDefs.post_init_regmagic): Add the register global parameters
	to the list of candidate registers for long latency reads. This
	allows the dataflow analysis to mark access to globals as
	potentially suspending.

2011-04-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance the MT-SPARC code generation.

	* tools/lib/slc/mt/mtsparc/gencreate.py: Annotate creates with the
	list of registers that hold thread arguments.

	* tools/lib/slc/mt/mtsparc/asmproc/opt.py (addswchll): Factor into
	a `DetectDataflow' class. Enhance to drain thread argument
	registers. Use it here, and...
	* tools/lib/slc/mt/mtsparc/asmproc/base.py: ...here.

2011-04-18  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a bug in the Fibre input conversion.

	* tools/bin/sag (FibreGenerator.unfold): Support very large
	integer constants.

2011-04-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix in library.

	* lib/include/svp/perf.h: Do not generate comments in the inline
	assembly, since the comment prefix may vary across targets (in
	particular it is `!' on SPARC).

2011-04-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	MT-Alpha code generation improvements.

	* tools/lib/slc/mt/mtalpha/asmproc/base.py (detectregs): Split
	into `detectgp' and `detectsp'.  New phase `killspadjusts' to
	remove unneeded uses of SP in thread functions.

	* tools/lib/slc/mt/mtalpha/asmproc/opt.py (seereg): Also consider
	accesses to globals as potentially suspending.

2011-04-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	MT-SPARC code generation fixes and improvements.

	* tools/lib/slc/mt/mtsparc/asmproc/delay.py (markdelay): indicate
	which instruction is involved when reporting delayed-in-delay-slot.

	* tools/lib/slc/mt/mtsparc/asmproc/opc/mtsparc.py,
	* tools/lib/slc/mt/mtsparc/asmproc/opc/decode.py (regref), Also
	recognize the legacy register forms.

	* tools/lib/slc/mt/mtsparc/asmproc/opt.py (addswchll): Ignore
	extra outputs to %y (for now).

	* tools/lib/slc/mt/mtsparc/asmproc/base.py (fillannulnop): Insert
	`nop' in the delay slot of "annul" branches.

2011-04-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Preliminary support for `swch' annotations for MT-SPARC.

	* tools/lib/slc/mt/mtsparc/asmproc/decode.py: New.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py: Move `markdelay' to...

	* tools/lib/slc/mt/mtsparc/asmproc/delay.py: ...here.

	* tools/lib/slc/mt/mtsparc/asmproc/opt.py: Use them.

	* tools/lib/slc/mt/common/asmproc/end.py (prunenopend): Avoid
	removing nops in delay slots.

2011-04-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make a database of MT-SPARC instructions.

	* tools/lib/slc/mt/mtsparc/asmproc/opc/formats.db: import
	the MT-SPARC instruction formats from GNU as.

	* tools/lib/slc/mt/mtsparc/asmproc/opc/decode.py: Translate
	`formats.db' to `mtsparc.py'.

	* tools/lib/slc/mt/mtsparc/asmproc/opc/mtsparc.py: Result of
	translation.

	* tools/lib/slc/mt/mtsparc/asmproc/opc/__init__.py: New.

	* tools/lib/Makefile.am: Distribute and install the new files.

2011-04-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add some version-based run-time consistency checks.

	* lib/include/svp/perf.h,
	* lib/src/perf.c (mtperf_report_intervals): Remember the number of
	counters in intervals when sampling. Check them.

	* tools/bin/cce.in: Pass the compiler version numbers at compile
	time.

	* lib/src/mtinit.c (sys_init),
	* lib/src/perf.c (mtperf_report_intervals): Print the version
	number.

2011-04-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a SEP bug.

	* lib/src/mtsep.c (do_sep_alloc): Properly handle the case where
	`ncores' was set to 0.

2011-04-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Prevent some spurious warnings.

	* tools/include/svp/compiler.h: Also define `unused'.

	* lib/mtalpha-sim/include/time.h,
	* lib/include/svp/perf.h,
	* lib/include/svp/mtmalloc.h:
	* tools/include/svp/delegate.h: Use it.

2011-04-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make some additional debugging features for `malloc'.

	* lib/src/malloc.c: Include `assert.h' not `cassert.h' which is
	now obsolete.

	* lib/src/tlsmalloc/tlsmalloc.c (tls_free): When `DEBUG_MALLOC' is
	set check whether a stack pointer is given to free().

2011-04-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix an assembly optimization bug on MT-Alpha.

	* tools/lib/slc/mt/mtalpha/asmproc/opt.py (addswchll): Recognize
	the new `allocate' format.

2011-04-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Warn when compiler options are not used.

	* tools/lib/slc/front/opts.py (check_unused): New.

	* tools/lib/slc/front/main.py,
	* tools/lib/slc/mt/common/asmproc/enhance.py,
	* tools/lib/slc/mt/common/asmproc/fixup.py: Check for unused
	options at the end of processing.

2011-04-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a bug with counter sampling.

	* lib/include/svp/perf.h (__inline_mtperf_sample): Do not
	read/write more counters than are defined.

2011-04-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the documentation.

	* doc/NEWS.txt: Document the latest command-line options.

2011-04-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add command-line options to control the create strategies.

	* tools/lib/slc/mt/common/strategy.py: Recognize and obey options
	`create-strategies' (enable strategies) and
	`collapse-singletons' (automatically use strategy `single' for
	singleton families).

	* tools/bin/slc.in: Document the options.

2011-04-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Unify the option handling between `spr' and the assembly stages.

	* tools/lib/slc/front/opts.py: Provide a dictionary-like interface
	that allows to query the provided extra options (`-x'). Boolean
	value is set depending on whether `no-' is prefixed.

	* tools/bin/slc.in: Recognize option forms `-fspr-OPT',
	`-fno-spr-OPT', `-fasmfix-OPT', `-fno-asmfix-OPT', `-fasmopt-OPT',
	`-fno-asmopt-OPT'. Rename the stage activation options to the form
	`-fasmopt-do-STAGE' / `-fno-asmopt-do-STAGE'. Document the
	existing options.

	* tools/lib/slc/front/chains.py (run_chain): Pass the extra
	options to each visitor.

	* tools/lib/slc/mt/common/asmproc/enhance.py (filter),
	* tools/lib/slc/mt/common/asmproc/fixup.py (filter),
	* tools/lib/slc/mt/common/asmproc/stageopts.py (makestageopts),
	* tools/lib/slc/mt/mtalpha/asmproc/opt.py (addswchll),
	* tools/lib/slc/mt/mtsparc/asmproc/base.py (initsp): Use the new
	extra options interface.

2011-04-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the documentation.

	* doc/NEWS.txt: Document the create specifiers.

2011-04-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement MT allocation strategies.

	* tools/lib/t-spr/slimpl.m4: New create specifier
	`sl__strategy(xxx)'. This replaces the embryonic `sl__allcores'
	which meant `sl__strategy(exact)'.

	* tools/lib/slc/mt/common/strategy.py: New. This prepares the
	`allocate' flags depending on the strategy specifiers and any
	statically known information about the index range.

	* tools/lib/slc/mt/front/chains.py,
	* tools/lib/slc/mt/mtalpha/gencreate.py,
	* tools/lib/slc/mt/mtsparc/gencreate.py: Use it.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new file.

2011-04-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix mis-definition of the service place for `malloc'.

	With the new place format introduced on March 28th, the target of
	place `15' (0xf) used by `dlmalloc' was changed from "core 0,
	suspending" to "core 7, size 1". However core 7 is not isolated
	from programs. This was reported by Q Yang.

	* lib/include/svp/mtmalloc.h (malloc_place): Change back to target
	core 0.

2011-04-05  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix the performance counter offset for UTLEON3.

	* lib/include/svp/perf.h: Do it.

2011-04-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add precision digits to the efficiency computation on uT-LEON3.

	* lib/src/perf.c (mtperf_compute_extra): Set `core_rate' to 100
	to get 2 digits precision

2011-04-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase compatibility with the FPGA environment.

	* tools/lib/mtalpha-fpga/slrt.s: Allocate some space for TLS
	stacks.

	* tools/lib/mtsparc.mk: Also link in `fibre.o' for the FPGA
	environment.

	* lib/src/tlsmalloc/tlsconfig.h: Use a small slot size on the
	FPGA (256 bytes).
	* lib/src/tlsmalloc/tls_arch_mtsparc.h: Rename to...
	* lib/src/tlsmalloc/tls_arch_mtsparc_sim.h: ...this.
	* lib/src/tlsmalloc/tls_arch_mtsparc_fpga.h: New. (broken for now)

	* lib/src/tlsmalloc/Makefile.am: Update the file list.

	* lib/include/svp/mtmalloc.h: Disable the exclusive delegations
	for now, since exclusive creates are not yet supported on FPGA.

	* lib/include/svp/perf.h,
	* lib/src/perf.c: Support the uT-LEON3 performance counters.

	* lib/src/time.c: Stub implementation for the FPGA environment.

	* lib/mtalpha-sim/include/assert.h: Avoid using `printf' as this
	may not be supported yet.

	* lib/src/mtinit.c: Move the definition of `__fibre_base' and `__slr_base'...
	* lib/src/mtinput.c: ...here.
	* lib/Makefile.am: List the new file.

	* lib/mtalpha.mk: Separate the MGSim-specific sources into a
	distinct list.
	* lib/mtsparc.mk: Use it.

	* lib/mtsparc2.mk: New.
	* lib/Makefile.am: Include the new file.

2011-04-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement TLS access using `gettid' on MT-Sparc.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py: Rename `initspecial'
	to `initsp'. Use option `tls-via-gettid' to decide which scheme to
	use. Implement the scheme using `gettid' when selected, using
	`__first_tls_top' as an indicator where to start addressing.

	* tools/bin/cce.in: Enable `tls-via-gettid' for uT-LEON3 by
	default.

2011-04-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	New assembly enhance option `no-swch-before-ll-use'.

	* tools/lib/slc/mt/mtalpha/asmproc/opt.py (addswchll): Do it.

2011-04-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Create a mechanism to parameterize the assembly stages.

	* tools/lib/slc/mt/common/asmproc/stageopts.py (makestageopts):
	Recognize a new command-line argument `-x'. Store the names
	provided in an `extras' array.

	* tools/lib/slc/mt/common/asmproc/fixup.py (filter),
	* tools/lib/slc/mt/common/asmproc/enhance.py (filter): provide the
	extra options to the individual stages.

	* tools/bin/slc.in: New command-line arguments `-fasmfix-arg-XXX'
	and `-fasmopt-arg-XXX'. This provides `-x XXX' to the underlying
	filter.

2011-03-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fixes to codegen for MT-Sparc.

	For uT-LEON3 the allocation failure is -1, not 0. Test that.

	As of this writing the index limit on uT-LEON3 is inclusive, so
	add -1 to the value provided in SL code. This breaks the
	"remdefaults" optimization which will now improperly remove
	"setlimit" for families of 2 threads. Hopefully the hardware
	design will be changed soon so we can avoid adding -1 to the
	limit.

	The uT-LEON3 does not support allocate/x and allocate/s. Fail when
	they are used.

	* tools/lib/slc/mt/mtsparc/gencreate.py (Create_2_MTSCreate.visit_lowcreate): Do it.

2011-03-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix in codegen for MT-Sparc.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py: Use `.global' not
	`.globl'.

2011-03-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	More assembly enhance code for MT-Sparc.

	* tools/lib/slc/mt/mtalpha/asmproc/opt.py: Move common code to...

	* tools/lib/slc/mt/common/remdefaults.py,
	* tools/lib/slc/mt/common/swch.py,
	* tools/lib/slc/mt/common/end.py: ... here.

	* tools/lib/slc/mt/mtsparc/asmproc/opt.py: Use them.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new files.

2011-03-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Small codegen optimization for MT-Sparc

	* tools/lib/slc/mt/mtsparc/asmproc/base.py (replsave): skip the
	`save' instruction in thread functions when it was spuriously
	generated because of some shared/global parameter being used.

2011-03-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a thread creation bug on MT-Sparc.

	* tools/lib/slc/mt/mtsparc/gencreate.py (Create_2_MTSCreate.visit_lowcreate):
	Avoid setting register names for arguments if compiling for the
	new ISA. Collect the shared arguments after sync in all cases.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add primitives to manipulate place identifiers.

	* tools/include/svp/delegate.h: Introduce `get_current_place',
	`get_core_id', `get_local_place'. Use them to define `PLACE_LOCAL'
	and `PLACE_DEFAULT'.

	* tools/lib/mtplaces.c,
	* tools/lib/dummyplaces.c: New. This implements the primitives
	when inline assembly from `delegate.h' is not desired.

	* tools/lib/Makefile.am: List the new files.
	* tools/lib/mtalpha.mk,
	* tools/lib/mtsparc.mk,
	* tools/lib/ptl.ml,
	* tools/lib/seqc.ml: Compile and link them.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Document changes for 3.5b.

	* doc/NEWS.txt: Explain create attributes and refer to the new
	place semantics documentation.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix in the SEP interface header.

	* lib/include/svp/sep.h (SP_IS_COMPOUND): Fix typo.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the SEP implementation.

	* lib/src/mtsep.c (sep_dump_info):  New debugging function.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update the MT profiles to match the new Microgrid place handling.

	* tools/lib/mt-profiles/lzcoma128_1chan,
	* tools/lib/mt-profiles/lzcoma128_2chan,
	* tools/lib/mt-profiles/lzcoma256_1chan,
	* tools/lib/mt-profiles/lzcoma256_4chan,
	* tools/lib/mt-profiles/mlcoma128_1chan,
	* tools/lib/mt-profiles/mlcoma128_2chan,
	* tools/lib/mt-profiles/mlcoma256_1chan,
	* tools/lib/mt-profiles/mlcoma256_4chan,
	* tools/lib/mt-profiles/rbm1,
	* tools/lib/mt-profiles/rbm128,
	* tools/lib/mt-profiles/rbm16,
	* tools/lib/mt-profiles/rbm256: Use a single core count since the
	SEP can now carve new places itself.

	* tools/lib/mt-profiles/ml-npcrypt-p1,
	* tools/lib/mt-profiles/ml-npcrypt-p2,
	* tools/lib/mt-profiles/ml-npcrypt-p4,
	* tools/lib/mt-profiles/ml-npcrypt-p8: Delete, since these are
	meaningless with the new place handling.

	* tools/lib/Makefile.am: Update accordingly.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Re-implement the root SEP for the new Microgrid place format.

	* lib/src/mtconf.c: Recognize the new place layout.

	* lib/src/mtsep.c: New SEP, courtesy of Mike Lankamp.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adapt code generation for `create' to the new MT ISAs.

	* tools/lib/slc/lower/split.py: Avoid dual behavior when
	`forcewait' is set.

	* tools/lib/slc/mt/mtalpha/gencreate.py,
	* tools/lib/slc/mt/mtsparc/gencreate.py: Generate different
	`allocate' instructions depending on which attributes are set.

	* tools/lib/t-sppalpha/include/sl_support.h: Use `allocate/s'
	always.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add some create attributes to the language.

	* tools/lib/t-spr/slimpl.m4: New attributes `forcewait', `nowait',
	`allcores'.

	* tools/lib/slc/ast.py (Extras): New method `has_attr'.

	* tools/lib/slc/input/check.py (CheckVisitor.visit_create): Check
	for consistent use of create attributes.

	* tools/lib/slc/visitors.py (PrintVisitor.visit_create): Also
	print create attributes.

2011-03-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update the documentation.

	* doc/NEWS.txt: Update for version 3.4.

2011-03-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* build-aux/git-version-gen: Do not test for dirtiness if a
	`package-version' file is available.

2011-03-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for target `mta_on'.

	* tools/lib/t-sppalpha/include/sl_support.h: Set the "suspend" bit
	on creation since an alternate behavior is not available.

2011-03-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor enhancement to `slt'.

	* tools/bin/slt.in: Also substitute occurrences of `SRCDIR' in
	SLT_RUN specifications.

2011-03-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor library enhancement.

	* lib/mtalpha-sim/include/time.h (__inline_clock): Use
	`alwaysinline' from <compiler.h>.

2011-03-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* lib/Makefile.am: Also distribute `dummysep.c'.

2011-03-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix a small SEP bug.

	* lib/src/mtsep.c (root_sep_ctl): Return -1 if an invalid place id
	is provided to query.

2011-03-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Redesign the SEP interface.

	* lib/include/svp/sep.h: Do it.
	* lib/src/mtsep.c: Implement it.

	* lib/src/dummysep.c: New. This guarantees the interface is
	available on all targets.

	* lib/ptl.mk,
	* lib/seqc.mk: Compile and link in `dummysep'.

	* lib/src/mtinit.c: Use the new SEP interface.

	* tools/lib/mtalpha-sim/slrt.s,
	* tools/lib/mtsparc-fpga/slrt.s: Do not declare
	`__main_placeinfo', as this is not needed any more.

2011-03-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Target MGSim when testing for MT-Sparc.

	* build-aux/sl.mk: Use the `mtsn' targets when compiling for
	MT-Sparc.

2011-03-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enable tests for MT-Sparc when applicable.

	* build-aux/slctests.m4: New Automake conditional
	`ENABLE_CHECK_SPR_MTS'.

2011-03-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix the version numbering.

	To this point version numbering used an explicit version number in
	a file (`build-aux/package-version') to work around issues with
	broken VCS installs. Now that the source is hosted with git proper
	git tags can be used instead.

	* build-aux/version-gen: Rename to...
	* build-aux/version-gen.old: ...this.
	* build-aux/package-version: Remove.

	* build-aux/git-version-gen: New (import from gnulib).

	* build-aux/version.mk,
	* configure.ac: Use it.

	* build-aux/Makefile.am: Distribute it.
	* build-aux/sl-init-autoconf: Copy it.

2011-03-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support `spawn' for all compilation targets.

	* tools/lib/t-ptl/slimpl.m4,
	* tools/lib/t-seqc/slimpl.m4,
	* tools/lib/t-sppalpha/slimpl.m4,
	* tools/lib/t-utc/slimpl.m4,
	* tools/lib/t-utc0/slimpl.m4: Do it.

	* tools/lib/t-spr/slimpl.m4: Avoid newline in the expansion of
	`sl_spawn'.

2011-03-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initial implementation for `spawn'.

	* tools/lib/t-spr/slimpl.m4: New syntax `sl_spawndecl', `sl_spawn'
	and `sl_spawnsync'.

	* tools/lib/slc/ast.py: Create IR nodes for the new constructs.
	* tools/lib/slc/input/parse.py: Parse them.
	* tools/lib/slc/visitors.py: Visit them (DefaultVisitor,
	PrintVisitor).

	* tools/lib/slc/lower/lowerspawnsync.py,
	* tools/lib/slc/lower/spawndecl.py: New.

	* tools/lib/slc/mt/mtalpha/genssync.py,
	* tools/lib/slc/mt/mtalpha/gencreate.py: Compile them to
	MT-Alpha. `sl_spawn' is equivalent to `sl_create();sl_detach()'
	without code in between, and without the actual
	`detach'. `sl_spawnsync' performs `sync' then `release'.

	* tools/lib/Makefile.am: List the new files.

	* tools/lib/slc/lower/seq.py: Compile them as a sequential
	schedule. Ensure that the FID is set to 0 so that `spawnsync' with
	MT stays a no-op.

	* tools/lib/slc/lower/split.py: Also support splitting
	`spawnsync'.

	* tools/lib/slc/front/chains.py: Extend the chains with the new
	visitors.

2011-03-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix reporting bug in benchmarking framework.

	* lib/src/perf.c (mtperf_compute_extra): Use the ratio between
	master and core frequency to compute the pipeline efficiency.

	* lib/src/mtconf.h,
	* lib/src/mtconf.c: Save the master frequency.

2011-03-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Reduce compiler warnings about unused variables.

	* tools/lib/slc/ast.py (CVarDecl.__init__),
	* tools/lib/slc/visitors.py (PrintVisitor.visit_cvardecl),
	* tools/lib/slc/lower/lowcvars.py (ReduceCVars.visit_cvardecl):
	New attribute `attrs' on C variable declarations. Generate
	`__attribute__' when it is specified.

	* tools/lib/slc/lower/lowercreate.py (Create_2_LowCreate.visit_create):
	Use it for the variable holding the family exit code.

	* tools/lib/slc/mt/common/gentfun.py (TFun_2_MTFun.visit_fundef),
	* tools/lib/slc/lower/seq.py (TFun_2_CFun.visit_fundecl): Use
	`__attribute__((unused))' for the index declaration.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Release version 3.3.

	* build-aux/package-version: Update to 3.3.

	* doc/NEWS.txt: Document recent changes.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix to allow to build for MT-Sparc without MT-Alpha.

	* lib/mtalpha.mk (MALLOC_DEFS, TLSMALLOC_DEFS): Move the common
	defines outside of the conditional.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for measuring external memory requests.

	* lib/include/svp/perf.h: Counters 7 and 8 are actually L2
	operations. Add two new counters for the external memory
	operations.

	* lib/src/perf.c: Update the column labels accordingly.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fixes.

	* tools/lib/mtsparc.mk (EXTRA_DIST): Also list the files in
	`mtsparc-sim'.

	* tools/lib/mtsparc.mk (CLEANFILES): List `callgate.o' where
	appropriate.

	* tools/lib/seqc.mk (seq_naked-host-host-seqc/%.o): Create
	directories with the correct name.

	* lib/src/empty.c: New. This is needed for the MT-Sparc library.
	* lib/Makefile.am (EXTRA_DIST): List the new file.

	* lib/mtsparc-fpga,
	* lib/mtsparc-sim: Link to...
	* lib/mtalpha-sim: ...here.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Preliminary library support for MT-Sparc.

	* lib/mtalpha.mk: Split preprocessor defines specific to MT-Alpha
	to their own Make variables.

	* lib/src/tlsmalloc/tls_arch_mtsparc.h: New.
	* lib/src/tlsmalloc/Makefile.am: List the new file.

	* lib/mtsparc.mk: New. Use the common definitions from
	`mtalpha.mk'.

	* lib/Makefile.am: Use it.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make the exclusive malloc wrappers compatible with MT-Sparc.

	* lib/include/svp/mtmalloc.h: Also recognize `__mtsparc__'.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Avoid using the call gate to delegate exclusive calls to dlmalloc.

	* lib/include/svp/mtmalloc.h: Use plain exclusive creates to
	wrapper functions.

	* lib/src/malloc_excl.c: Implement the wrappers.

	* lib/mtalpha.mk: List and compile them.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make the standard C headers more compatible with MT-Sparc.

	* lib/mtalpha-sim/include/limits.h,
	* lib/mtalpha-sim/include/stddef.h,
	* lib/mtalpha-sim/include/stdint.h: Also recognize `__mtsparc__'.

	* lib/mtalpha-sim/include/sys/types.h: Define `ssize_t' always.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Disable the 64-bit legacy SL divide routines on 32-bit MT-Sparc.

	* lib/src/div.c: Do it.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Reduce the heap size for MT-Sparc to fit the address space.

	* lib/src/heap.c: Use 4MB pages and 40MB heap on MT-Sparc.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the legacy SL text output interface.

	* lib/include/svp/io.h,
	* lib/src/io.c: Use `long' as the wide type for integer
	output. This allows the code to be used with the 32-bit MT-Sparc.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor MT-Sparc code generation fixups.

	* tools/lib/slc/mt/common/regmagic.py: Remove a spurious debugging
	print.

	* tools/lib/slc/mt/mtsparc/gencreate.py (Create_2_MTSCreate):
	Properly handle `forcesuspend'.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Generate run scripts for both the FPGA and MGSim targets.

	* tools/lib/Makefile.am: Generate `r-mtsparc-sim.sh' and `r-mtsparc-fpga.sh'.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Preliminary support for bootstrapping MT-Sparc programs.

	* tools/lib/mtsparc-fpga/slrt.s,
	* tools/lib/mtsparc-fpga/callgate.s: New.

	* tools/lib/mtsparc-sim: Link to...
	* tools/lib/mtsparc-fpga: ...here.

	* tools/lib/mtsparc.mk: Assemble them. Also create library
	variants for the `mtsn' targets.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Preliminary support for soft floats on MT-Sparc.

	* tools/bin/cce.in: Define `__slc_soft_float__' when compiling for
	MT-Sparc.

	* tools/include/svp/mgsim.h: Use it to define `mgsim_outfloat'.

	* tools/lib/t-spr/include/sl_support.h: Alias
	`sl_(sh|gl)f(parm|arg)' to the matching non-f variant.

2011-03-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance the MT-Sparc assembly fixups.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py: Properly handle both
	FP/SP and RA when replacing save/restore. Insert "nop" before
	"end" after a delay slot.

2011-03-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Optimize save/restore for MT-Sparc.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py (creplrestore,
	creplsave): Use `st' and `ld' if only one register per pair needs
	to be saved/restored.

2011-03-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initial support for save/restore for MT-Sparc.

	* tools/lib/slc/mt/common/asmproc/regmagic.py: New method
	`legacy_to_canon' to retrieve the canonicalized register names
	corresponding to special roles in a plain C function body.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py: Rename
	`killsaverestore' to `killrestore'. New function `replsave' since
	`save' may perform a useful adjustment on the stack pointer. New
	function `protectallcallregs' to prime the callee-save registers
	in case a call exists.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py (cmarkused, creplsave,
	creplrestore): Expand save/restore in plain C functions by
	explicit save/restore instruction sequences.

2011-03-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix in MT register magic.

	* tools/lib/slc/mt/common/asmproc/regmagic.py (get_vregs_for_legacy,
	get_legacy): Treat `fp' as an integer register, not float.

2011-03-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fixes.

	* tools/lib/slc/visitors.py (PrintVisitor.visit_create): Spell
	`detach' not `release'.

	* tools/lib/slc/mt/common/asmproc/fixup.py: Import `sys'.

2011-03-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support both MGSim and FPGA back-ends for MT-Sparc.

	* tools/bin/cce.in: New target machine `mtsparc-sim' and aliases
	`mtsn_*'.

	* tools/lib/slc/mt/mtsparc/gencreate.py: New class attribute
	`newisa' to use the ISA from MGSim. Modify the visitor to support
	both ISAs.

	* tools/lib/slc/front/chains.py: Recognize the new chains, using
	appropriate variants of Create_2_MTSCreate.


2011-03-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initialize the MT-Sparc assembly optimization stage.

	* tools/lib/slc/mt/mtsparc/asmproc/opt.py (filter): Use the common
	enhance code.

2011-03-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Factor some assembly optimization code.

	* tools/lib/slc/mt/mtalpha/asmproc/opt.py (filter): Moave the
	common code to...
	* tools/lib/slc/mt/common/asmproc/enhance.py: ...here.

	* tools/lib/Makefile.am: List the new file.

2011-03-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Factor option handling for MT assembly fixups.

	* tools/lib/slc/mt/mtalpha/asmproc/opt.py (filter),
	* tools/lib/slc/mt/common/asmproc/fixup.py: Factor option handling
	into...

	* tools/lib/slc/mt/common/asmproc/stageopts.py: ...here.

	* tools/lib/Makefile.am: List the new file.

2011-03-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix the register canonicalization code.

	* tools/lib/slc/mt/common/regmagic.py (RegMagic.makelegcanonrepl):
	Use `f' in target register name for FP registers.

2011-01-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the MT-Sparc fixup code.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py: Implement more.
	* tools/lib/slc/mt/mtsparc/regdefs.py: Also define aliases for
	`ra' and `callreg'.

2011-01-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Factor common assembly fixup code (mt.base, mt.opt).

	* tools/lib/slc/mt/mtalpha/asmproc/opt.py (findlabels,
	killunusedlabels): Extract label detection and removal to...
	* tools/lib/slc/mt/common/asmproc/labels.py: ...here.

	* tools/lib/slc/mt/mtalpha/asmproc/base.py (markused): Move
	register use detection to...
	* tools/lib/slc/mt/common/asmproc/markused.py: ...here.

	* tools/lib/slc/mt/mtalpha/asmproc/base.py (makespecialtransform,
	compress): Move register window compression to...
	* tools/lib/slc/mt/common/asmproc/compress.py: ...here.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new
	files.

2011-01-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Attempt to fix the visibility of functions in objects (MT-Alpha).

	* tools/lib/slc/mt/mtalpha/asmproc/base.py (xjoin2): Do not emit
	`.globl' if it was not there in the first place.

2011-01-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor optimization in `spr'.

	* tools/lib/slc/mt/mtalpha/asmproc/base.py (xsplit): Precompute
	the label names.

2011-01-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement register renaming for MT-Sparc.

	* tools/lib/slc/mt/mtalpha/asmproc/base.py: Move the common
	definition of `renameregs', `crenameregs' and `regextract' to...

	* tools/lib/slc/mt/common/asmproc/renameregs.py,
	* tools/lib/slc/mt/common/asmproc/regextract.py: ...here.

	* tools/lib/slc/mt/mtalpha/asmproc/base.py,
	* tools/lib/slc/mt/mtsparc/asmproc/base.py: Use them.

	* tools/lib/slc/mt/mtsparc/regdefs.py,
	* tools/lib/slc/mt/mtalpha/regdefs.py (mt_local_offset): New
	attribute to indicate where the MT locals start wrt the
	architectural register window.

	* tools/lib/slc/mt/common/regmagic.py (makerepl, makecrepl): Use
	it.

	* tools/lib/slc/mt/common/asmproc/canon.py: New pass to transform
	regiser aliases to canonical form.

	* tools/lib/slc/mt/common/regmagic.py (makelegre,
	makelegcanonrepl): Support it.

	* tools/lib/slc/mt/mtsparc/regdefs.py (legacy_regs, legacy_fregs):
	Also recognize `o6' and `i6' as aliases. Define aliases for float
	regs (although they are not used).
	* tools/lib/slc/mt/mtalpha/regdefs.py: Populate `legacy_regs' with
	all the 'rN' forms.

	* tools/lib/slc/mt/mtalpha/asmproc/common.py,
	* tools/lib/slc/mt/mtalpha/asmproc/base.py,
	* tools/lib/slc/mt/mtsparc/asmproc/common.py,
	* tools/lib/slc/mt/mtsparc/asmproc/base.py: Use it.

	* tools/lib/slc/mt/common/regmagic.py (makelegre,
	makelegcanonrepl): Support it.

	* tools/lib/slc/mt/mtsparc/asmproc/common.py: New passes `phyregs'
	and `cphyregs' to translate canonical register names to
	architectural register names.
	* tools/lib/slc/mt/mtsparc/amsproc/base.py: Use them.

	* tools/lib/slc/mt/mtsparc/amsproc/base.py (zerog0): New pass to
	rename `$l31'/`$31' to `g0'. Use it.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new
	files.

2011-01-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	New register use convention for MT-Sparc.

	* tools/lib/slc/mt/mtsparc/regdefs.py (RegDefs): New local window
	layout, to ensure the 'i' locals are next to each other aligned on
	even-numbered physical reg slots.

2011-01-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the fixup code for MT-Sparc assembly.

	* tools/lib/slc/mt/mtsparc/asmproc/base.py (grouper): New function
	grouper code, similar to the code for MT-Alpha.

	* tools/lib/slc/mt/common/asmproc/input.py (lexer): Ignore lines
	containing `#APP' and `#NO_APP', since the fixup input must
	already be preprocessed.

2011-01-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Factor common assembly fixup code (mt.base).

	* tools/lib/slc/mt/mtalpha/asmproc/base.py (filter): Move common
	code to...
	* tools/lib/slc/mt/common/asmproc/fixup.py: ... here.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new file.

2011-01-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix breakage in register magic.

	* tools/lib/slc/mt/mtsparc/regdefs.py,
	* tools/lib/slc/mt/mtalpha/regdefs.py:
	Also keep the numerical register names in the mapping.

	* tools/lib/slc/mt/common/regmagic.py (RegMagic.alias_to_vname):
	Properly use the RegDefs object.

2011-01-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Factor common assembly fixup code (mt.common).

	* tools/lib/slc/mt/common/asmproc/__init__.py: New.

	* tools/lib/slc/mt/mtalpha/asmproc/common.py: Extract shared
	implementation to...
	* tools/lib/slc/mt/common/asmproc/input.py,
	* tools/lib/slc/mt/common/asmproc/output.py,
	* tools/lib/slc/mt/common/asmproc/filter.py: ... here.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new
	files.

2011-01-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix code generation for MT-Alpha.

	* tools/lib/slc/mt/mtalpha/gentfun.py: Properly include
	`common.gentfun'.

2011-01-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Restore support for `mta_on'.

	* tools/bin/spp: Allow the `compile', `filter' and `filter2'
	functions for the `sppalpha' module.

2011-01-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make MT `split' for dual compilation work across targets.

	* tools/lib/slc/lower/split.py: Make the architecture name a
	parameter in the oracle. Make the oracle a mandatory constructor
	parameter for the splitters.

	* tools/lib/slc/front/chains.py: Provide separate oracles for the
	`mta' and `mts' targets.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initial support for `create' for MT-Sparc.

	* tools/lib/slc/mt/mtsparc/gencreate.py: Do it.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the MT calling convention computation.

	* tools/lib/slc/mt/common/regmagic.py (mapcall): Preserve the slot
	layout in the return object.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adjust the MT-Sparc local register window.

	* tools/lib/slc/mt/mtsparc/regdefs.py: Change the locals so that
	`l0' is a usable register (i.e. start assigning with `g1'). Push
	`sp' and `g0' at the end of the local window.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support non-numeric register naming in `spr'.

	* tools/lib/slc/mt/mtalpha/regdefs.py,
	* tools/lib/slc/mt/mtalpha/regdefs.py: New attribute
	`canon_is_numeric'.

	* tools/lib/slc/mt/common/regmagic.py: New method `makecanon' to
	find the canonical legacy register name by numeric offset.
	* tools/lib/slc/mt/common/regmagic.py (get_legacy,
	vreg_to_legacy): Use it.

	* tools/lib/slc/mt/common/regmagic.py (get_vregs_for_legacy):
	Always indirect through legacy_*regs[] to ensure non-numeric
	legacy names are recognized.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor code cleanup.

	* tools/lib/slc/mt/mtalpha/asmproc/base.py (crenameregs):
	Whitespace.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Reduce whitespace in the C output from `spr'.

	* tools/lib/slc/visitors.py: Do not emit newlines in `flatten'
	when no location is specified.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix packaging.

	* lib/src/mtalpha.mk (CLEANFILE): avoid listing all `libm'
	objects, because some are precious.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support architecture-specific assembly comment syntax.

	* tools/lib/slc/mt/mtalpha/regdefs.py,
	* tools/lib/slc/mt/mtsparc/regdefs.py: New attribute `comprefix'.

	* tools/lib/slc/mt/common/regmagic.py: Cache it.

	* tools/lib/slc/mt/common/gentfun.py: Use it.

2010-12-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for fixed-register C variable declarations in `spr'.

	* tools/lib/slc/ast.py (CVarDecl): New attribute `reg', maybe
	None.

	* tools/lib/slc/visitors.py (PrintVisitor.visit_cvardecl): Print
	it.
	* tools/lib/slc/lower/lowcvars.py (ReduceCVars.visit_cvardecl):
	Lower it.


2010-12-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix factoring of register magic in `spr'.

	* tools/lib/slc/mt/common/regmagic.py: Use a variable register
	prefix instead of `$'.

	* tools/lib/slc/mt/mtalpha/regdefs.py,
	* tools/lib/slc/mt/mtsparc/regdefs.py: Define the prefix.

	* tools/lib/slc/mt/mtsparc/regdefs.py: Define float register
	counts, in order to allow initialization of the call mapping
	engine (even if float params are not supported).

2010-12-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support visitor inheritance with `spr'.

	* tools/lib/slc/visitors.py (Dispatcher.dispatch): Use `getattr'
	to look up methods in parent classes too.

2010-12-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Factor common thread function code generation.

	* tools/lib/slc/mt/mtalpha/visitors.py: Extract common TFun
	visitor to...
	* tools/lib/slc/mt/common/gentfun.py: ...here.

	* tools/lib/slc/mt/mtalpha/gentfun.py,
	* tools/lib/slc/mt/mtsparc/gentfun.py: Use it.

	* tools/lib/slc/mt/mtsparc/visitors.py,
	* tools/lib/slc/mt/mtalpha/visitors.py: Rename to...
	* tools/lib/slc/mt/mtsparc/gencreate.py,
	* tools/lib/slc/mt/mtalpha/gencreate.py: ... here.

	* tools/lib/slc/front/chains.py: Update import paths.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new
	files.

2010-12-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initial support for MT-Sparc in `spr'.

	* tools/lib/slc/mt/mtsparc/__init__.py,
	* tools/lib/slc/mt/mtsparc/asmproc/__init__.py: New.

	* tools/lib/slc/mt/mtalpha/compile.py: Copy to...
	* tools/lib/slc/mt/mtsparc/compile.py: ...here.

	* tools/lib/slc/mt/mtsparc/regdefs.py: Define initial register
	mappings: use SPARC's "locals" for Microthreaded thread
	parameters. Preserve semantics for all other registers.

	* tools/lib/slc/mt/mtsparc/visitors.py,
	* tools/lib/slc/mt/mtsparc/asmproc/base.py,
	* tools/lib/slc/mt/mtsparc/asmproc/opt.py: New (placeholders for
	now).

	* tools/lib/slc/front/chains.py: New chains `mts' and `mts+seq'.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new
	files.

2010-12-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make `spp' sensitive to the target architecture.

	* tools/lib/t-sppalpha/slimpl.m4,
	* tools/bin/cce.in: Provide the architecture tag to `spp'.

	* tools/bin/spp: Select implementation based on architecture name.


2010-12-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Split MT-Alpha code into common and architecture-specific sources.

	* tools/lib/slc/mt/__init__.py: New.

	* tools/lib/slc/mtalpha/__init__.py,
	* tools/lib/slc/mtalpha/regmagic.py,
	* tools/lib/slc/mtalpha/compile.py,
	* tools/lib/slc/mtalpha/visitors.py,
	* tools/lib/slc/mtalpha/asmproc/__init__.py,
	* tools/lib/slc/mtalpha/asmproc/base.py,
	* tools/lib/slc/mtalpha/asmproc/common.py,
	* tools/lib/slc/mtalpha/asmproc/opt.py: Rename to...

	* tools/lib/slc/mt/mtalpha/__init__.py,
	* tools/lib/slc/mt/mtalpha/regmagic.py,
	* tools/lib/slc/mt/mtalpha/compile.py,
	* tools/lib/slc/mt/mtalpha/visitors.py,
	* tools/lib/slc/mt/mtalpha/asmproc/__init__.py,
	* tools/lib/slc/mt/mtalpha/asmproc/base.py,
	* tools/lib/slc/mt/mtalpha/asmproc/common.py,
	* tools/lib/slc/mt/mtalpha/asmproc/opt.py: ... here.

	* tools/lib/slc/front/chains.py,
	* tools/lib/slc/mt/mtalpha/asmproc/base.py,
	* tools/lib/slc/mt/mtalpha/asmproc/common.py,
	* tools/lib/slc/mt/mtalpha/asmproc/opt.py: Adjust import paths
	accordingly.

	* tools/lib/slc/mt/common/__init__.py: New.

	* tools/lib/slc/mt/mtalpha/regmagic.py: Split into...
	* tools/lib/slc/mt/common/regmagic.py: ... this, and ...
	* tools/lib/slc/mt/mtalpha/regdefs.py: ... this.

	* tools/lib/slc/mt/mtalpha/compile.py: Extra common code to...
	* tools/lib/slc/mt/common/compile.py: ... this.

	* tools/lib/Makefile.am (nobase_python_PYTHON): Update accordingly.

2010-12-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix to build rules.

	* tools/lib/mtalpha.mk: Rename `SLC_CMD' to `SLC_MTA_N'.
	* tools/lib/mtsparc.mk: Rename `SLC_CMD' to `SLC_MTS_N'.

2010-12-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix detection of `mts' in `cce'.

	* tools/bin/cce.in: Match `mts_hybrid'.

2010-12-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initial support for SPARC targets.

	* tools/bin/cce.in: Recognize `mts' targets.

	* tools/lib/mtsparc.mk,
	* tools/lib/r-mtsparc-fpga.sh.in: New.

	* tools/lib/Makefile.am: Stop generating `r-mtsparc-sim.sh' as
	this is an unsupported target anyway. Generate `r-mtsparc-fpga.sh' instead.

	* build-aux/slctests.mk,
	* build-aux/sl.mk: Also build for `mts'.

2011-03-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor tree cleanup.

	* m4/m4.m4: Rename to...
	* build-aux/m4.m4: ...here.

	* Makefile.am: Simplify accordingly.

2011-03-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Allow `bool' with `slr' variables.

	* tools/lib/arggen.c: Include `stdbool.h'.

2011-03-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug with performance counters sampling.

	* lib/include/svp/perf.h (__inline_mtperf_sample): Do not read too
	many counters.

2011-03-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix visibility of inline functions.

	* tools/include/svp/compiler.h (alwaysinline): Use `static'.

2011-03-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* tools/lib/Makefile.am: ensure that the installed symbolic links
	are erased before they are created to avoid errors during
	re-installation.

2011-03-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Clean up more headers.

	* lib/mtalpha-sim/include/stdarg.h: Test for GNU C properly. Also
	support CoSy varargs.

	* lib/mtalpha-sim/include/stdio.h: Check printf-like formats only
	with GNU C. Only define `v' variants (using `va_list') if
	`stdarg.h' defines `__va_list_available'.

	* lib/mtalpha-sim/include/stdlib.h: Do not use `extern'. Move
	`excl_' variants of malloc calls to...

	* lib/include/svp/mtmalloc.h: ... here.

	* lib/Makefile.am: List the new file.

	* lib/src/tlsmalloc/tls_arch_mtalpha.h,
	* lib/src/mtinit.c,
	* lib/src/malloc_wrappers.c: Use the new file.

	* lib/src/tlsmalloc/tls_arch_mtalpha.h: Use inline functions instead
	of macros where relevant.

	* lib/src/tlsmalloc/tlsmalloc.c (get_new_superblock): Properly
	type the argument to `MAP_STORAGE'.

	* lib/mtalpha-sim/include/time.h: Test for GNU C properly.
	* lib/src/time.c: Include `time.h' to get a proper declaration of
	`clock_t' since `perf.h' does not include `time.h' any more.

	* tools/include/svp/compiler.h: Test for GNU C properly.

	* tools/include/svp/fibre.h: Conditionalize the definition of
	inlinable primitives.

	* lib/src/_hdtoa.c: Include `stdint.h', since it is not indirectly
	included any more.

2011-03-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement counter sampling as C functions.

	* lib/include/svp/perf.h: Also declare C function prototypes for
	sampling primitives alongsde the inlinable macros.

	* lib/src/perf_wrappers.c: Implement them.
	* lib/src/perf.c: Move existing wrappers to...
	* lib/src/perf_wrappers.c: ...here.

	* lib/seqc.mk,
	* lib/mtalpha.mk,
	* lib/ptl.mk: Compile them.

	* lib/Makefile.am: Distribute them.

2011-03-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement Microgrid output primitives as C functions.

	* tools/include/svp/mgsim.h: Also declare C function prototypes
	for MG output primitives alongside the inlinable macros.

	* tools/lib/mgsim.c: Implement them.

	* tools/lib/mtalpha.mk: Compile them.

	* tools/lib/Makefile.am: Distribute them.

2011-03-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement Fibre input primitives as C functions.

	* tools/include/svp/fibre.h: Also declare C function prototypes
	for Fibre input primitives alongside the inlinable macros.

	* tools/lib/fibre.c: Implement them.

	* tools/lib/seqc.mk,
	* tools/lib/ptl.mk,
	* tools/lib/mtalpha.mk: Compile them.

	* tools/lib/Makefile.am: Distribute them.

2011-03-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Simplify the interface with MGSim.

	The Microgrid simulator was recently modified to provide a single
	binary for both COMA memory simulations. This drops the need for
	separate support for `simx-alpha'.

	* build-aux/mgsim.m4: Do not detect the separate executable.
	* build-aux/slctests.m4: Do not require the separate executable
	for ENABLE_CHECK_COMA_ZL.

	* tools/lib/Makefile.am: Do not substitute the separate program.

	* tools/lib/r-mt-sim.sh.in: Simplify.

	* tools/lib/mt-profiles/lzcoma128_1chan,
	* tools/lib/mt-profiles/lzcoma128_2chan,
	* tools/lib/mt-profiles/lzcoma256_1chan,
	* tools/lib/mt-profiles/lzcoma256_4chan,
	* tools/lib/mt-profiles/ml-npcrypt-p1,
	* tools/lib/mt-profiles/ml-npcrypt-p2,
	* tools/lib/mt-profiles/ml-npcrypt-p4,
	* tools/lib/mt-profiles/ml-npcrypt-p8,
	* tools/lib/mt-profiles/mlcoma256_1chan,
	* tools/lib/mt-profiles/mlcoma256_4chan,
	* tools/lib/mt-profiles/rbm1,
	* tools/lib/mt-profiles/rbm128,
	* tools/lib/mt-profiles/rbm16,
	* tools/lib/mt-profiles/rbm256: Update accordingly.

2011-03-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor enhancement to `slr'.

	With `slr -p' a script `run.sh' is generated to capture the
	command line. This script is extended so that extra arguments can
	be passed to `run.sh' to be appended on the command line. To be
	used e.g. with `run.sh -i' to trigger interactive mode with MGSim.

	* tools/lib/r-host.sh.in,
	* tools/lib/r-mt-sim.sh: Append the command-line arguments given
	to `run.sh' to the command.

2011-03-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enable the `show-vars' target at the top-level dir.

	* Makefile.am: Do it.

2011-02-23  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix packaging.

	* lib/src/mtalpha.mk (CLEANFILE): avoid listing all `libm'
	objects, because some are precious.

2011-02-23  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix to build rules.

	* tools/lib/mtalpha.mk: Rename `SLC_CMD' to `SLC_MTA_N'.

2011-02-23  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Remove warnings in headers.

	Do not warn about incomplete implementations any more. This was
	requested by caj@herts.

	* tools/include/svp/delegate.h,
	* lib/mtalpha-sim/include/stdio.h,
	* lib/mtalpha-sim/include/stdlib.h,
	* lib/mtalpha-sim/include/string.h,
	* lib/mtalpha-sim/include/strings.h,
	* lib/mtalpha-sim/include/time.h: Remove `#warning'.

2011-02-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix deadlock bug on MT-Alpha.

	* tools/lib/mtalpha-sim/callgate.s (__sl_callgate): Also
	initialize $1 (RV) to avoid deadlock on return from void
	functions (e.g. C's `free').

2011-02-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Ensure that `sl_proccall' always runs locally with `spr'.

	This introduces a new create attribute `sl__forceseq' which always
	select the `seq' variant for creation. This only works for the spr
	target in split mode, ie mt+hybrid -- not mt+naked nor other
	targets. Requested by CAJ for testing the FFT.

	* tools/lib/t-spr/slimpl.m4,
	* tools/lib/slc/lower/split.py: Recognize the new attribute.

	* tools/include/slc.m4,
	* tools/lib/t-spr/include/sl_support.h: Make `sl_proccall' use it.

	Ensure that `sl_proccall' always runs in the local context.

2011-02-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	More debugging for DLMalloc.

	* lib/mtalpha.mk:
	(mta_malloc_debug.o): Enable footers.

	* lib/src/malloc.c: Implement custom error actions with messages.

2011-01-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Optimize `memcpy', `memmove' and `bcopy'.

	* lib/src/bcopy.c: Use `long' instead of `int' as the copy unit.

2011-01-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for C's standard time().

	* lib/include/svp/perf.h: New counter `MTPERF_UNIXTIME'.

	* lib/src/perf.c,
	* lib/src/time.c: Use it.

	* lib/mtalpha-sim/include/sys/types.h,
	* lib/mtalpha-sim/include/time.h: Declare C's time().

	* lib/mtalpha.mk (MTALIB_CSRC): List the new file.

2010-12-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor refactoring in `spr'.

	* tools/lib/slc/lower/seq.py,
	* tools/lib/slc/mtalpha/visitors.py: Do not define the constructor
	as this can be inherited.

2010-12-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor improvement in `spr'.

	* tools/lib/slc/visitors.py:
	(DefaultVisitor.visit_create, PrintVisitor.visit_create): Also
	visit the FID, if present.

2010-12-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* doc/NEWS.txt: Initialize for 3.3.x

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Release version 3.2.

	* build-aux/package_version: Update to 3.2.

	* doc/NEWS.txt: Document recent changes.

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the compilation of `break' for MT-Alpha.

	* tools/lib/slc/mtalpha/visitors.py (TFun_2_MTATFun.visit_break):
	Use `__builtin_unreachable()' as this is now supported by the
	back-end compiler.

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update bugreport address.

	* configure.ac: do it.

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* lib/mtalpha.mk (CLEANFILES): Also clean the target-neutral
	libraries.

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the documentation.

	* doc/HACKING.txt: Update to reflect the latest practices.

	* doc/README.txt,
	* doc/requirements.txt,
	* doc/sl_deps.graffle,
	* doc/sl_deps.png: Update to reflect the latest requirements.

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve documentation for `cce'.

	* tools/bin/cce.in: Document the environment variables.

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adjust usage of back-end tools.

	The custom GCC patch was recently integrated as a `mtalpha' target
	on a dedicated Microthreaded-enabled GCC tree. This drops the
	requirement for both the muTC core compiler and the
	`alpha-linux-gnu' binutils/GCC targets. Also the SPARC target is
	renamed to `mtsparc-linux-gnu'.

	* build-aux/mgbinutils.m4: Use the new SPARC target name.

	* build-aux/slc.m4: Detect `CC_MTALPHA' and `CC_MTSPARC' instead
	of `CC_ALPHA' and `CC_MTSPARC'. Use the new SPARC target name. Do
	not detect the muTC core compiler any more.

	* tools/bin/Makefile.am: Substitute only `CC_MTALPHA' and
	`CC_MTSPARC'.
	* tools/bin/cce.in: Use them.

	* build-aux/mggcc.m4: Remove.
	* build-aux/Makefile.am,
	* build-aux/sl-init-autoconf: Do not distribute or install
	mggcc.m4 any more.

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adjust MT-Alpha compilation scheme after back-end compiler update.

	* tools/lib/t-sppalpha/include/sl_support.h,
	* tools/lib/slc/mtalpha/visitors.py (TFun_2_MTATFun.visit_fundef):
	Force clobber input registers for global thread parameters,
	otherwise the code generator thinks they are uninitialized and
	removes the data dependency chain.

	* tools/lib/t-sppalpha/include/sl_support.h: Add an extra level of
	backslashes as the new CPP removes one level outside of macros.

2010-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adjust heap parameters after back-end compiler update.

	* lib/src/heap.c: Lower the page size, as the compiler is now
	complaining that the alignment is too large.

2010-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve reporting of the Microgrid configuration information.

	* lib/src/mtconf.c (parse_timings_v1): Remove information about
	memory bandwidth, as this was computed erroneously by the
	simulator.

	* lib/src/mtconf.c (parse_timings_v3): Add to support the new
	timings format, with proper memory bandwidth computation.

2010-11-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* tools/lib/Makefile.am (nobase_dist_pkgdata_DATA): Also
	distribute and install the new profiles.

2010-11-05  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update the Microgrid machine profiles.

	* tools/lib/mt-profiles/mlcoma128_2chan,
	* tools/lib/mt-profiles/mlcoma256_4chan: New profiles, made
	possible by recent support in MGSim for multiple root directories
	and DDR channels.

	* tools/lib/mt-profiles/mlcoma_default,
	* tools/lib/mt-profiles/lzcoma_default,
	* tools/lib/mt-profiles/coma128,
	* tools/lib/mt-profiles/default: Change defaults to use the
	2-channel configuration.

	* tools/lib/mt-profiles/mlcoma256_1chan,
	* tools/lib/mt-profiles/lzcoma256_1chan,
	* tools/lib/mt-profiles/lzcoma256_4chan: Also set `MemoryFreq'
	which is now a separate setting from `CoreFreq' and
	`DDRMemoryFreq'.

2010-10-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Simplify the benchmarking output.

	* lib/src/perf.c (mtperf_compute_extra): Avoid returning NaNs when
	the interval is empty.

2010-09-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update MG initialization code.

	* lib/src/mtconf.c (parsers): Add `parse_timings_v2'.

2010-09-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update MG initialization code.

	* lib/src/mtconf.c (parse_timings_v2): Recognize new timings
	configuration block.

2010-08-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in Microgrid initialization code.

	* lib/src/mtconf.c (sys_conf_init): Fix recognition of unknown
	configuration tags.

2010-08-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `break' support for target `mta_on', fake for `ptl'.

	* tools/lib/t-ptl/slimpl.m4: Fake availability of `break'
	(although it still hasn't the right semantics).

	* tools/lib/t-sppalpha/slimpl.m4 (sl_break),
	* tools/lib/t-sppalpha/include/sl_support.h (__sl_dobreak): Use
	the new `break' semantics.

2010-08-18  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add malloc debugging for the Microgrid.

	* lib/src/tlsmalloc/tlsmalloc.c,
	* lib/src/tlstack_malloc.c: Print information when `DEBUG_MGSIM'
	is defined.

	* lib/mtalpha.mk: New targets for debugging objects.

2010-08-18  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `slr' some more.

	* tools/lib/Makefile.am (nobase_dist_pkgdata_DATA): Also
	distribute/install the `simple' MT profile.

2010-08-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `slr'.

	* tools/lib/mt-profiles/simple: Reinstate as this is used by
	`slr'.

2010-08-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Change default MGSim profile.

	* tools/lib/mt-profiles/default: Use `coma128' as default profile.

2010-08-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Isolate checks for the ZL COMA memory simulation.

	* build-aux/slctests.m4,
	* build-aux/slctests.mk: Rename `--disable-check-coma' into
	`--disable-check-coma-zl'. Use it accordingly.

2010-08-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Cleanup MT simulator profiles.

	* tools/lib/mt-profiles/coma256,
	* tools/lib/mt-profiles/simple,
	* tools/lib/mt-profiles/rbm4: Remove unused profiles.

	* tools/lib/mt-profiles/rbm8: Replace by...
	* tools/lib/mt-profiles/rbm16: ...this.

	* tools/lib/mt-profiles/mlcoma128_1chan,
	* tools/lib/mt-profiles/lzcoma128_1chan: Use default DDR timings
	(suitable for DDR3-1600).

	* tools/lib/mt-profiles/mlcoma256_1chan,
	* tools/lib/mt-profiles/lzcoma256_1chan,
	* tools/lib/mt-profiles/lzcoma256_4chan: Use newer DDR3-2400
	timings.

	* tools/lib/mt-profiles/coma128: Use ML's COMA simulation.
	* tools/lib/mt-profiles/default: Use `coma128' as default profile.

	* tools/lib/Makefile.am: Update accordingly.

2010-08-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor MT-Alpha library fixes.

	* lib/src/tlstack_malloc.c (tls_malloc): Fix middle address
	computation for the last thread on the last core (tls_top = 0).

	* lib/mtalpha-sim/include/stdbool.h: Avoid defining bool/true/false
	if `__bool_true_false_are_defined' is defined.

2010-07-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix in `slr'.

	* tools/bin/slr.in: Do not set monitor variable pattern if `-Mv'
	is not specified.

2010-07-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for Microgrid monitoring in `slr'.

	* tools/bin/slr.in: Add support for options `-M', `-Md',
	`-Mo', `-Mr'.

2010-07-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor `slr' enhancement.

	* tools/lib/r-mt-sim.sh.in: Unset `SIMARGS' during the recursive
	run.

2010-07-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in MT-Alpha code generation.

	* tools/lib/slc/mtalpha/visitors.py (TFun_2_MTATFun.visit_setp)
	(TFun_2_MTATFun.visit_getp): Properly segregate accesses to int
	and float registers to protect from bug in GCC.

2010-07-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for `break' in MT-Alpha code generation.

	* tools/lib/slc/mtalpha/visitors.py (TFun_2_MTATFun.visit_break):
	Do not use `__builtin_unreachable' since we are not yet using GCC
	4.5.

2010-07-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor SEP initialization updates.

	* lib/src/mtsep.c: Notify progress for each core. Properly report
	the existence of the first place.

2010-07-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for new performance counters.

	* lib/include/svp/perf.h: New counter for exclusive allocate queue
	size.
	* lib/src/perf.c: Name the new counter. Also compute average.

2010-07-12  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Reinstate support for MT family IDs.

	* tools/lib/t-spr/slimpl.m4 (sl_create),
	* tools/lib/slc/ast.py (Create.__init__),
	* tools/lib/slc/input/parse.py (parse_create): Propagate the FID lvalue.

	* tools/lib/slc/lower/lowercreate.py
	(Create_2_LowCreate.visit_create): Define the FID temporary here
	and assign the FID lvalue in the body always.

	* tools/lib/slc/mtalpha/visitors.py
	(Create_2_MTACreate.visit_lowcreate): Use it.

2010-07-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	More resource deadlock prevention.

	* tools/include/svp/delegate.h: Make the default place identifier
	`soft' to prevent resource deadlocks.
	* tools/lib/slc/mtalpha/visitors.py
	(Create_2_MTACreate.visit_lowcreate): Force suspend bit when
	creating with no `seq' alternative.

2010-07-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for new performance counters.

	* lib/include/svp/perf.h: New counters for TT and FT occupancy.
	* lib/src/perf.h: Name the new counters. Also support computer
	columns.

2010-07-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in `spr'.

	* tools/lib/slc/lower/seq.py (TFun_2_CFun): Fix support for thread
	function pointer declarations.

2010-07-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance support for `_mutable' global thread parameters.

	* tools/lib/slc/lower/seq.py (TFun_2_CFun.visit_funparm): Do not
	declare `_mutable' parameters with the `register' qualifier, since
	they should have an address.

2010-07-05  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in `spr'.

	A large inefficiency would cause exponential space complexity
	during transformation in the depth of C scope nesting. This would
	cause exceedingly large compilation times and/or stack blowouts
	for large programs.

	* tools/lib/slc/visitors.py (ScopedVisitor): Remember the current
	stack of C scopes.

	* tools/lib/slc/lower/split.py (SplitCreates.visit_lowcreate):
	Also memoize the stack of current scopes, so that they are not
	duplicated when duplicating the `Create' objects.

2010-07-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Allow `return' to terminate the current thread.

	* tools/lib/t-sppalpha/slimpl.m4,
	* tools/lib/t-spr/slimpl.m4,
	* tools/lib/t-utc0/slimpl.m4 (sl_def, sl_enddef): Alias `return'
	to `sl_end_thread'. (Syntax sugar)

2010-07-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Allow the `utc0' target to run again.

	* tools/bin/spp (main): Allow module `utc0'.

2010-07-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in MT-Alpha code generation.

	When a program of the following form is compiled:

	{
	   foo();
	   p[...] = ...;
	}

	Then the instruction sequence becomes:

	   jsr
	   ldah $gp.... !gpdisp!... # gp reload 1st half
	   stq ...
	   ...
	   lda $gp, ... !gpdisp!... # gp reload 2nd half
	   ...
	   ret

	As an optimization, we remove all the load instructions that
	precede "ret" (end thread) because they are not necessary. However
	when doing so we may remove half of a GP reload. This makes the
	other half invalid (cannot be assembled on its own).

	This is fixed in this changeset by removing both halves of an
	unneeded GP reload.

	* tools/lib/slc/mtalpha/asmproc/base.py (munchret): Keep track of
	the deleted `lda' instructions that correspond to GP reloads.

	* tools/lib/slc/mtalpha/asmproc/base.py (killgpdisp): New. Remove
	the `ldah' instructions corresponding to killed GP reloads.

	* tools/lib/slc/mtalpha/asmproc/base.py (_filter_inner): Register
	the new phase.

2010-07-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance undocumented headers.

	* lib/include/undocumented.h: Emit warning on use (should not be
	used).
	* lib/include/sac_helpers.h: Use standard header names.

2010-07-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for `_mutable' parameter definitions.

	* tools/lib/t-spr/slimpl.m4,
	* tools/lib/t-sppalpha/slimpl.m4: Fix definitions of
	`sl_glparm_mutable' and `sl_glfparm_mutable'.

	* tools/lib/slc/input/parse.py (parse_argparm): Tolerate parameter
	types ending with `_parm'.

	* tools/lib/slc/mtalpha/visitors.py (TFun_2_MTATFun.visit_fundef):
	Fix typo `aname' -> `name'.

2010-06-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Optimize `slr' for the `ptl' target.

	Data layout for `ptl' and `seqc' are the same since they both use
	the host data layout. Acknowledge that and optimize the former by
	using the same `slr' tag as the latter.

	* tools/lib/host-host-ptl/slrt.c: Remove.
	* tools/lib/host-host-seqc/slrt.c: Copy to...
	* tools/lib/host-host-ptl/slrt.c: ...here.

2010-06-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance portability.

	* tools/lib/load.c: Do not try to use `argv' from the environment,
	since this is non-portable.

2010-06-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix packaging.

	* tools/lib/Makefile.am (pythondir, install-data-hook): Let the
	Python files be installed to the regular Python lib dir. Make a
	symbolic link in $pkglibdir instead of a copy.

2010-06-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Change installation directory for the Python library.

	* tools/lib/Makefile.am (pythondir): Force install Python files to
	$pkglibdir, so that the path to the Python library is not
	dependent on the Python version.

	* build-aux/slc.m4: Update settings for `$PYTHONPATH' accordingly.

2010-06-22  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the `ptl' back-end.

	* tools/lib/t-ptl/include/sl_support.h: Allow to change the
	TC-ptl that gets included when using a custom runtime.

2010-06-22  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix.

	* lib/src/tlstack_malloc.c: Fix typo in comment.

2010-06-22  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	More diversity with memory allocators.

	Requested by UH: it should be possible to disable the TLS-based
	heap allocator. Also, the stack-like TLS-based allocator should
	work side-by-side with the TLS-based heap allocator.

	* lib/src/tlstack_malloc.c: New. This implement stack-like
	allocation at the bottom of the TLS stack space.
	* lib/src/mtalpha.mk: Update accordingly.

	* lib/src/malloc_wrappers.c: New.
	* lib/src/mtalpha.mk: New target `libmalloc_notls.a' which can
	disable the TLS-based heap allocator when linked against a
	program. Place this target and `libm.a' in variant-independent
	directories.

	* tools/bin/cce.in: Use variant-independent directories in the
	library search path.

2010-06-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in MT-Alpha code generation.

	The thread index would not be set properly if the `sl_index'
	declaration was placed later than the start of the thread function
	body (e.g. after a function call). Reported by M. Hicks and
	M. Lankamp.

	* tools/lib/slc/mtalpha/visitors.py (TFun_2_MTATFun.visit_fundef),
	* tools/lib/t-sppalpha/include/sl_support.h (__sl_declindex):
	Force a dependency on the `asm' construct to avoid (erroneous)
	elision by the code generator.

2010-06-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Use exclusive create to allocate initial place.

	* lib/src/mtinit.c: Do it.

2010-06-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend language for exclusive creates.

	* tools/lib/t-spr/slimpl.m4: New attribute ``sl__exclusive``.

	* tools/lib/slc/lower/split.py (SplitCreates.visit_lowcreate):
	Avoid generating alternative when delegating exclusively.

	* tools/lib/slc/mtalpha/visitors.py
	(Create_2_MTACreate.visit_lowcreate): Do not warn when delegating
	exclusively and no alternative is available.

2010-06-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance the place allocator.

	* lib/include/svp/sep.h: Define new policies for exclusive places
	and sharing.

	* lib/src/mtsep.c: Support allocation of exclusive and shared
	places. Generate separate place identifiers for both. Properly
	indicate that the root place is shared.

2010-06-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Whitespace.

	* lib/src/mtsep.c: Re-indent.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* doc/NEWS.txt: Initialize for 3.1.x.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Release version 3.1.

	* build-aux/package_version: Update to 3.1.

	* doc/NEWS.txt: Document recent changes.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Packaging fixes.

	* lib/Makefile.am (nobase_dist_pkgdata_DATA): Remove duplicate.
	* lib/src/tlsmalloc/Makefile.am: List `tls_arch_pthreads.h' and
	`tlsconfig.h'.
	* tools/lib/Makefile.am (nobase_python_PYTHON): List `am'.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix library build.

	* lib/src/getenv.c,
	* lib/src/gdtoa/gdtoaimpl.h: Use `malloc' and `free' instead of
	`fast_malloc' and `fast_free'.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve the TLS memory allocator.

	* lib/src/tlsmalloc/tlsconfig.h,
	* lib/src/tlsmalloc/tlsmalloc.c: Optimize bin selection by using
	compiler built-in bit count operations.

	* lib/src/tlsmalloc/tlsmcheck.c: Update accordingly.

	* lib/src/tlsmalloc/tlsmalloc.c (free_superblock): Fix bug where
	too many superblocks would be released.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fixes to quiet compiler warnings.

	* lib/src/strncmp.c,
	* lib/src/vprintf.c: Use the standard C header names.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make the TLS memory allocator the default allocator on MT-Alpha.

	* lib/src/malloc_wrappers.c: Remove.

	* lib/mtalpha.mk: Do not build the dlmalloc wrappers any
	more. Compile `tlsmalloc' and rename the services to their
	standard C names.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance the TLS memory allocator.

	* lib/mtalpha-sim/include/stdlib.h: Rename the `fast_XXX' macros
	to `excl_dlXXX' to clarify their meaning.

	* lib/src/tlsmalloc/tls_arch_mtalpha.h: Use them. Also, use the
	new MGSim mmap/munmap interface to manage storage.

	* lib/src/tlsmalloc/tlsmalloc.c: Place the count of superblocks at
	the first word, since this has a special behavior on the Microgrid
	(permissions are not checked for the first word of TLS, so it can
	be read to 0 without error). Also, map and count the control block
	itself. Rename the `mallinfo' services to `stats', since
	`mallinfo' has special semantics not supported yet.

	* lib/src/tlsmalloc/tlsmalloc.h,
	* lib/src/tlsmalloc/tlsmalloc.c: Fix interface of `calloc'.

	* lib/src/tlsmalloc/tricks.h: Fix `forceinline'.

2010-06-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance the SL/MGSim interface.

	The Microgrid simulator was recently modified to allow programs to
	interact more with the simulation. With the increased functionality,
	some extra encapsulation in the library becomes needed.

	* tools/include/svp/mgsim.h: New. Encapsulates accesses to MGSim
	control functions.
	* tools/Makefile.am: List the new file.

	* tools/include/svp/abort.h,
	* tools/include/svp/testoutput.h,
	* lib/include/svp/gfx.h: Use it.

	* lib/src/exit.c: New.
	* lib/mtalpha.mk: List the new file.
	* lib/mtalpha-sim/include/stdlib.h: Declare `exit' and `_Exit'.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance TLS memory allocator.

	* lib/src/tlsmalloc/Makefile.am,
	* lib/src/tlsmalloc/tls_arch_mtalpha.h,
	* lib/src/tlsmalloc/tls_arch_pthread.h,
	* lib/src/tlsmalloc/tlsconfig.h,
	* lib/src/tlsmalloc/tlsmalloc.c,
	* lib/src/tlsmalloc/tlsmalloc.h,
	* lib/src/tlsmalloc/tlsmcheck.c: Improve.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initial implementation of TLS memory allocator.

	* lib/src/tlsmalloc/Makefile.am,
	* lib/src/tlsmalloc/tls_arch_mtalpha.h,
	* lib/src/tlsmalloc/tls_arch_pthread.h,
	* lib/src/tlsmalloc/tlsconfig.h,
	* lib/src/tlsmalloc/tlsmalloc.c,
	* lib/src/tlsmalloc/tlsmalloc.h,
	* lib/src/tlsmalloc/tlsmcheck.c,
	* lib/src/tlsmalloc/tricks.h: New.

	* lib/Makefile.am,
	* lib/mtalpha.mk: List the new files.

	* build-aux/ax_tls.m4: New.
	* configure.ac: Use it.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support use of standard C header names in SL code.

	* lib/include/bits/float.h,
	* lib/include/sys/ctypes.h,
	* lib/include/calloca.h,
	* lib/include/cassert.h,
	* lib/include/cctype.h,
	* lib/include/cerrno.h,
	* lib/include/cfloat.h,
	* lib/include/climits.h,
	* lib/include/cmalloc.h,
	* lib/include/cmath.h,
	* lib/include/cstdarg.h,
	* lib/include/cstdbool.h,
	* lib/include/cstddef.h,
	* lib/include/cstdint.h,
	* lib/include/cstdio.h,
	* lib/include/cstdlib.h,
	* lib/include/cstring.h,
	* lib/include/cstrings.h,
	* lib/include/ctime.h: Deprecate. Move MT-specific content to...

	* lib/mtalpha-sim/include/bits/float.h,
	* lib/mtalpha-sim/include/sys/types.h,
	* lib/mtalpha-sim/include/alloca.h,
	* lib/mtalpha-sim/include/assert.h,
	* lib/mtalpha-sim/include/errno.h,
	* lib/mtalpha-sim/include/float.h,
	* lib/mtalpha-sim/include/limits.h,
	* lib/mtalpha-sim/include/math.h,
	* lib/mtalpha-sim/include/stdarg.h,
	* lib/mtalpha-sim/include/stdbool.h,
	* lib/mtalpha-sim/include/stddef.h,
	* lib/mtalpha-sim/include/stdint.h,
	* lib/mtalpha-sim/include/stdio.h,
	* lib/mtalpha-sim/include/stdlib.h,
	* lib/mtalpha-sim/include/string.h,
	* lib/mtalpha-sim/include/strings.h,
	* lib/mtalpha-sim/include/sys/types.h,
	* lib/mtalpha-sim/include/time.h: ...here, and...
	* lib/include/svp/fast_malloc.h: ...here.

	* lib/Makefile.am,
	* lib/mtalpha.mk: Update file lists accordingly.

	* lib/src/malloc.c: Use the standard header names.
	* lib/src/mtalpha.mk: Relax defines for `malloc'.

	* lib/include/svp/argslot.h,
	* lib/include/svp/assert.h,
	* lib/include/svp/div.h,
	* lib/include/svp/gfx.h,
	* lib/include/svp/io.h,
	* lib/include/svp/iomacros.h,
	* lib/include/svp/perf.h,
	* lib/include/svp/sep.h,
	* tools/include/svp/fibre.h,
	* tools/include/svp/slr.h,
	* tools/lib/arggen.c,
	* lib/src/_hdtoa.c,
	* lib/src/abort.c,
	* lib/src/atoi.c,
	* lib/src/atol.c,
	* lib/src/atoll.c,
	* lib/src/bcopy.c,
	* lib/src/ctype.c,
	* lib/src/dtoa_simple.c,
	* lib/src/fprintf.c,
	* lib/src/gdtoa/g_ddfmt.c,
	* lib/src/gdtoa/gdtoa.h,
	* lib/src/gdtoa/gdtoaimp.h,
	* lib/src/gdtoa/hexnan.c,
	* lib/src/getenv.c,
	* lib/src/heap.c,
	* lib/src/io.c,
	* lib/src/malloc_wrappers.c,
	* lib/src/memset.c,
	* lib/src/missing_uclibc_math.c,
	* lib/src/mtconf.h,
	* lib/src/mtinit.c,
	* lib/src/mtsep.c,
	* lib/src/mtstdio.h,
	* lib/src/perf.c,
	* lib/src/printf-pos.c,
	* lib/src/printf.c,
	* lib/src/printfcommon.h,
	* lib/src/printflocal.h,
	* lib/src/snprintf.c,
	* lib/src/sprintf.c,
	* lib/src/stpcpy.c,
	* lib/src/stpncpy.c,
	* lib/src/strcat.c,
	* lib/src/strchr.c,
	* lib/src/strcpy.c,
	* lib/src/strdup.c,
	* lib/src/strerror.c,
	* lib/src/strlcat.c,
	* lib/src/strlcpy.c,
	* lib/src/strlen.c,
	* lib/src/strncat.c,
	* lib/src/strncpy.c,
	* lib/src/strnlen.c,
	* lib/src/strtol.c,
	* lib/src/strtoll.c,
	* lib/src/strtoul.c,
	* lib/src/strtoull.c,
	* lib/src/sys_errlist.c,
	* lib/src/vfprintf.c,
	* lib/src/vsnprintf.c: Use the standard header names.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `slr' for target `ptl'.

	* tools/lib/host-host-ptl/slrt.c: Fix typo in long `cce' tag.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance `ptl' target.

	* configure.ac: Disable `ptl' target if POSIX threads are not
	detected.

	* tools/bin/cce.in: Use `PTHREAD_CFLAGS' and `PTHREAD_LIBS' when
	compiling for target `ptl'. Define `_GLIBCXX_USE_C99_MATH' always
	for `ptl'.

	* tools/lib/ptl.mk (ptl_host_host_ptl_libslc_a_CXXFLAGS): Use
	`PTHREAD_CFLAGS.'

	* lib/ptl.mk (SLC_PTL): Use `AM_CXXFLAGS' too.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in build of `libslc' for `hrt' targets.

	* tools/lib/hrt.mk: Use `CFLAGS' instead of `CXXFLAGS'. Use `slc'
	to compile `tc.c' since it needs extra compiler flags known to
	`cce' only.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Configuration fix.

	* build-aux/slc.m4: Move tests for environment compatibility to...
	* configure.ac: ... here, because they are embedded in `cce' afterwards.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Remove `hrt' from default build.

	The set of conditions that allow to build the `hrt' runtime is not
	yet precisely known. Build is likely to fail on most systems.

	* configure.ac: Disable `hrt' by default.

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in `spr'.

	* tools/lib/slc/lower/lowercreate.py (AutoResolve): Insert
	missing semicolon in generated code.

2010-06-13  Raphael 'kena' Poss  <kena@coda.science.uva.nl>

	Fix bugs in `hrt' compilation.

	* tools/bin/cce.in: Use pthreads for `slc_aslink' when
	necessary. Fix initialization of `slc_debug_flags'.

	* tools/lib/hrt.mk: Use `$(SLC_HRT_N)'.

	* tools/lib/slc/am/visitors.py: Use 0 instead of `NULL'.

2010-06-13  Raphael 'kena' Poss  <kena@coda.science.uva.nl>

	Try to provide some FreeBSD compatibility for `hrt'.

	* tools/lib/host-host-hrt/tc.c (alloc_stack): Try to use
	`MAP_STACK' if `MAP_GROWSDOWN' is not defined (FreeBSD).

2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Merge the following changes.

	2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Bump required tool versions.

	* configure.ac: Require Autoconf 2.65 and Python 2.6.

	2010-06-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Better support for C99.

	* configure.ac: Require a C99 compiler.

	* tools/bin/cce.in: Do not add `-std=gnu99', since `configure' now
	does the right thing.

2010-06-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend build process for `hrt' targets.

	* build-aux/slc.m4: New conditional ENABLE_SLC_HRT.

	* build-aux/ax_pthread.m4: Import from the Autoconf archive.
	* configure.ac: Use it.

	* tools/bin/Makefile.am,
	* tools/bin/cce.in: Propagate compiler/flags for pthreads to use
	with `hrt' targets.

	* tools/lib/host-host-hrt/include/sl_hrt.h,
	* tools/lib/host-host-hrt/tc.c: New (placeholders).

	* tools/lib/host-host-hrt/slrt.c,
	* tools/lib/hrt.mk: New.

	* tools/lib/Makefile.am: Use `hrt.mk' too.

	* tools/lib/t-spr/include/sl_support.h: Include `sl_hrt.h' when
	appropriate.

	* tools/lib/slc/am/visitors.py: Remove `visit_programs', since the
	runtime header is now included automatically.

2010-06-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Merge contribution from Andrei Matei: new `hrt' back-end.

	* tools/lib/slc/am/__init__.py,
	* tools/lib/slc/am/visitors.py: New.

	* tools/lib/slc/front/chains.py: Define new chain `hrt'.

2010-06-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce new `hrt' targets.

	* tools/bin/cce.in: Recognize aliases `hrt', `hrt_n' and
	`hrt_s'. Update flags accordingly.

2010-06-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Remove obsolete files.

	* lib/host-host-ptl/include/svp_os.h,
	* lib/host-host-seqc/include/svp_os.h,
	* lib/mtalpha-sim/include/svp_asmdiv.h,
	* lib/mtalpha-sim/include/svp_os.h: Remove.

	* lib/seqc.mk,
	* lib/ptl.mk,
	* lib/mtalpha.mk: Update accordingly.

2010-06-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance `cce'.

	* tools/bin/cce.in: Propagate more information to programs: efine
	`__slc_dialect_XXX__', `__slc_variant_XXX__', `__slc_arch_XXX__'
	and `__slc_os_XXX__' according to parameters. Optimize more when compiling
	for host. Avoid linking in `libslc' if `-nostartfiles' is specified.

2010-06-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Appease compiler when using `spr'.

	* tools/lib/slc/lower/split.py (SplitCreates.visit_lowcreate):
	Ensure label for first alternative is always used.

	* tools/lib/slc/lower/lowercreate.py (AutoResolve): New visitor to
	ensure that the resolved label is always used.
	* tools/lib/slc/front/chains.py: Use it.

	* tools/lib/slc/lower/seq.py: Indicate that `__slI' is maybe unused.

	* tools/lib/slc/mtalpha/visitors.py: Ensure that the end label is
	always used.

	* tools/lib/slc/lower/split.py (SplitCreates): Simplify by reusing
	`ScopedVisitor'.

2010-06-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor MT-Alpha optimizations.

	* tools/bin/cce.in: Option `-mcpu' actually overrides `-mfix',
	etc. In order to use all ISA extensions, use `-mcpu=21264a'
	instead.

	* lib/include/cstrings.h: Declare `ffs'.
	* lib/src/ffs.c: New.
	* lib/mtalpha.mk: Tell `malloc' to use `ffs'. Compile `ffs.c'.

2010-06-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add missing module initializers in slc library.

	* tools/lib/slc/input/__init__.py,
	* tools/lib/slc/lower/__init__.py: New.

2010-06-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug with `slr -n'.

	* lib/src/mtinit.c: Dereference function pointer in SEP call. Turn
	`sys_set_main_pid' into a plain function.

2010-05-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* doc/NEWS.txt: Initialize for 3.x.

2010-05-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Release version 3.0.

	* build-aux/package-version: Update to 3.0.

	* doc/NEWS.txt: Document recent changes.

2010-05-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fixes.

	* tools/lib/mtalpha.mk,
	* tools/lib/ptl.mk,
	* tools/lib/seqc.mk: Use `-nostdlib' to appease `cce' while `slrt'
	is being built.

	* tools/lib/Makefile.am (nodist_nobase_python_PYTHON): Do not
	distribute `slc_config.py', since it must be regenerated for every
	installation.

2010-05-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fixes.

	* tools/lib/mtalpha.mk: Drop references to `libmain_seq.a' which
	does not exist any more.
	* tools/lib/ptl.mk: Also clean up `main.o'.

2010-05-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce new targets and variants.

	* tools/bin/cce.in: Introduce a "variant" part in the long alias.
	Drop support for 2-word aliases. Expand `seqc' to the new
	`spr'-based target, keep `seqc_o' as an alias to the old target.
	Introduce `mta', equivalent to `mtalpha'. Default `mta'/`mtalpha'
	to the `spr'-based target, keep `mta_on' (mta-old-naked) as an
	alias to the old target. New targets `mta_n' and `mta_s'
	(mta-naked, mta-seq). Assume separate library and slrt binaries
	for all targets.

	* tools/lib/mtalpha-sim/slrt.s,
	* tools/lib/host-host-seqc/slrt.c: Use the new aliases.

	* build-aux/sl.mk,
	* build-aux/slctests.mk: Build and test for the new targets.

	* tools/lib/seqc.mk,
	* tools/lib/ptl.mk,
	* tools/lib/mtalpha.mk: Build separate libraries for all targets.

	* tools/lib/empty.c: New (so that the linker does not complain
	that `libslc.a' is empty).

	* lib/gdtoa.mk: Separate list of buildable sources from other
	files.
	* lib/mtalpha.mk,
	* lib/ptl.mk,
	* lib/seqc.mk: Build separate libraries for all targets.

2010-05-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Use the new function pointer syntax for `sep.h'.

	* lib/include/svp/sep.h: Use the new syntax.

2010-05-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Portability workaround with old `ptl' semantics.

	* tools/lib/t-ptl/slimpl.m4: Ignore the 6th `create' field
	entirely when provided, since it may now contain attributes etc,
	which are not supported in this implementation. Drop support for
	an argument to `sl_break'.

2010-05-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Middle-end fixes in `spr'.

	* tools/lib/slc/lower/seq.py: Fix flattening of argument types for
	`create'.

	* tools/lib/slc/lower/split.py: Handle flattening of naked
	`create' constructs to a function named by identifier. Remove
	special behavior for `t_main', since it confuses things. Expose
	split descriptor as array[2] instead of pointer-to-descriptor.

2010-05-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor whitespace fixes.

	* tools/lib/slc/input/cm4.py: Tolerate more combinations of quotes
	and strings.

	* tools/lib/slc/input/parse.py: Strip all whitespace (also `\n')
	from identifiers before use.

2010-05-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement support for thread function pointers.

	* tools/lib/t-utc/slimpl.m4,
	* tools/lib/t-utc0/slimpl.m4,
	* tools/lib/t-ptl/slimpl.m4,
	* tools/lib/t-sppalpha/slimpl.m4,
	* tools/lib/t-seqc/slimpl.m4,
	* tools/lib/t-spr/slimpl.m4: New syntax `sl_decl_fptr' and
	`sl_typedef_fptr'.

	* tools/lib/slc/ast.py,
	* tools/lib/slc/input/parse.py,
	* tools/lib/slc/visitors.py,
	* tools/lib/slc/lower/split.py,
	* tools/lib/slc/lower/seq.py,
	* tools/lib/slc/mtalpha/visitors.py: Parse and convert function
	pointer declarations.

2010-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Also check `spr+seq-mtalpha-sim' in tests.

	* build-aux/slctests.mk (EXTRA_TEST_IMPL): Add the new target.

2010-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Sanitize handling of `main' and `t_main'.

	Until this point `main' was reserved and a SL program did not have
	access to argc/argv. This changeset resolves the issue and opens
	`main' for public use again.

	* tools/lib/host-host-seqc/load.c: Move to...

	* tools/lib/load.c: ...here. Get file names from environment
	variables, not `argv'. Define as initializer to the linker, to
	avoid requiring a custom `main'.

	* tools/lib/r-host.sh.in: Provide files in env var, instead of
	command line.

	* tools/lib/host-host-ptl/ptl_svp.cc: Initialize with global
	constructor/destructor, instead of init function.

	* tools/lib/mtalpha-sim/main.c,
	* tools/lib/host-host-seqc/lib_main.c,
	* tools/lib/host-host-seqc/main.c: Remove.

	* tools/lib/host-host-ptl/slrt.c,
	* tools/lib/host-host-seqc/slrt.c: Define `__main_place_id' here,
	and inline the code from `load.c'.

	* tools/lib/main.c: New default `main', simply creates `t_main'.

	* tools/lib/empty.c: New empty source to create empty libraries.

	* tools/lib/Makefile.am: List the new files.
	* tools/lib/mtalpha.mk,
	* tools/lib/ptl.mk,
	* tools/lib/seqc.mk: Remove references to deleted files. Also
	build `libslmain.a' containing the object for `main.c'.

	* tools/lib/mtalpha.mk: Build `libslmain_seq.a' for target
	`spr+seq-mtalpha-sim', needed since the calling convention for
	`t_main' is different.

	* tools/bin/slc.in,
	* tools/bin/cce.in: New flag `-nodefaultmain'. Add `-lslmain' to
	the linker unless `-nodefaultmain' is specified. Special case for
	`spr+seq-metalpha-sim'.

2010-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix handling of `sl_decl' with `spr'.

	* tools/lib/t-spr/slimpl.m4: Define `extras' for `sl_decl' too,
	since the parser expects it.

2010-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Expose blocking and non-blocking place ids in SEP interface.

	* lib/include/svp/sep.h: New attribute `soft_pid'.

	* lib/src/mtsep.c: Expose both `pid' and `soft_pid'.

2010-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Move place type and constants to library.

	* tools/lib/t-seqc/include/sl_support.h,
	* tools/lib/t-ptl/include/sl_support.h,
	* tools/lib/t-sppalpha/include/sl_support.h,
	* tools/lib/t-utc0/include/sl_support.h: Move declaration of
	`sl_place_t' and constants to...

	* tools/include/svp/delegate.h: ...here.
	* tools/Makefile.am: List the new file.
	* lib/include/svp/sep.h: Use it.

	* tools/lib/t-ptl/slimpl.m4,
	* tools/lib/t-sppalpha/slimpl.m4,
	* tools/lib/t-seqc/slimpl.m4: Do not use the constants, since they
	are not visible any more during translation.

	* tools/lib/host-host-ptl/include/ptl_svp.h: Force values in enum
	`ExitCode', so the constants become reliable.

2010-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve debugging with `slr'.

	* tools/bin/slr.in: Keep object files around when compiling
	`arggen.c' with `-gd' enabled, so that the debugger can find them.

2010-05-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Use the new framework for `-b seqc'.

	* tools/bin/cce.in: Expand `seqc' to
	`spr+seq-host-host-seqc'. Remove support for two-word aliases.

	* build-aux/slctests.mk: Do not test extra for
	`spr+seq-host-host-seqc', since this is now the default.

2010-05-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve MT-Alpha code gen.

	The previous fix to protect "end" after a branch is not needed any
	more as the underlying hardware now ignores the end if the branch
	is taken. However we need to protect it for branches that may
	return, since the return goes to the following instruction which
	then must end the hread.

	* tools/lib/slc/mtalpha/asmproc/opt.py (protectend): Avoid
	inserting `nop' between normal branch and `end', only bsr and
	equivalent.

2010-05-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix the math library.

	The math library needed to be recompiled; also the implementation
	of tgamma() was blatantly incorrect. It needs to compute the Gamma
	function, and was implemented as an alias to lgamma() instead.

	* lib/src/mtalpha/m/acosf.o,
	* lib/src/mtalpha/m/acoshf.o,
	* lib/src/mtalpha/m/asinf.o,
	* lib/src/mtalpha/m/asinhf.o,
	* lib/src/mtalpha/m/atan2f.o,
	* lib/src/mtalpha/m/atanf.o,
	* lib/src/mtalpha/m/atanhf.o,
	* lib/src/mtalpha/m/cabsf.o,
	* lib/src/mtalpha/m/carg.o,
	* lib/src/mtalpha/m/cargf.o,
	* lib/src/mtalpha/m/cbrtf.o,
	* lib/src/mtalpha/m/ceilf.o,
	* lib/src/mtalpha/m/copysignf.o,
	* lib/src/mtalpha/m/cosf.o,
	* lib/src/mtalpha/m/coshf.o,
	* lib/src/mtalpha/m/e_acos.o,
	* lib/src/mtalpha/m/e_acosh.o,
	* lib/src/mtalpha/m/e_asin.o,
	* lib/src/mtalpha/m/e_atan2.o,
	* lib/src/mtalpha/m/e_atanh.o,
	* lib/src/mtalpha/m/e_cosh.o,
	* lib/src/mtalpha/m/e_exp.o,
	* lib/src/mtalpha/m/e_fmod.o,
	* lib/src/mtalpha/m/e_gamma.o,
	* lib/src/mtalpha/m/e_gamma_r.o,
	* lib/src/mtalpha/m/e_hypot.o,
	* lib/src/mtalpha/m/e_j0.o,
	* lib/src/mtalpha/m/e_j1.o,
	* lib/src/mtalpha/m/e_jn.o,
	* lib/src/mtalpha/m/e_lgamma.o,
	* lib/src/mtalpha/m/e_lgamma_r.o,
	* lib/src/mtalpha/m/e_log.o,
	* lib/src/mtalpha/m/e_log10.o,
	* lib/src/mtalpha/m/e_log2.o,
	* lib/src/mtalpha/m/e_pow.o,
	* lib/src/mtalpha/m/e_rem_pio2.o,
	* lib/src/mtalpha/m/e_remainder.o,
	* lib/src/mtalpha/m/e_scalb.o,
	* lib/src/mtalpha/m/e_sinh.o,
	* lib/src/mtalpha/m/e_sqrt.o,
	* lib/src/mtalpha/m/erfcf.o,
	* lib/src/mtalpha/m/erff.o,
	* lib/src/mtalpha/m/exp2f.o,
	* lib/src/mtalpha/m/expf.o,
	* lib/src/mtalpha/m/expm1f.o,
	* lib/src/mtalpha/m/fabsf.o,
	* lib/src/mtalpha/m/fdimf.o,
	* lib/src/mtalpha/m/floorf.o,
	* lib/src/mtalpha/m/fmaf.o,
	* lib/src/mtalpha/m/fmaxf.o,
	* lib/src/mtalpha/m/fminf.o,
	* lib/src/mtalpha/m/fmodf.o,
	* lib/src/mtalpha/m/frexpf.o,
	* lib/src/mtalpha/m/hypotf.o,
	* lib/src/mtalpha/m/ilogbf.o,
	* lib/src/mtalpha/m/k_cos.o,
	* lib/src/mtalpha/m/k_rem_pio2.o,
	* lib/src/mtalpha/m/k_sin.o,
	* lib/src/mtalpha/m/k_standard.o,
	* lib/src/mtalpha/m/k_tan.o,
	* lib/src/mtalpha/m/ldexpf.o,
	* lib/src/mtalpha/m/lgammaf.o,
	* lib/src/mtalpha/m/llrintf.o,
	* lib/src/mtalpha/m/llroundf.o,
	* lib/src/mtalpha/m/log10f.o,
	* lib/src/mtalpha/m/log1pf.o,
	* lib/src/mtalpha/m/log2f.o,
	* lib/src/mtalpha/m/logbf.o,
	* lib/src/mtalpha/m/logf.o,
	* lib/src/mtalpha/m/lrintf.o,
	* lib/src/mtalpha/m/lroundf.o,
	* lib/src/mtalpha/m/modff.o,
	* lib/src/mtalpha/m/nan.o,
	* lib/src/mtalpha/m/nearbyintf.o,
	* lib/src/mtalpha/m/nextafterf.o,
	* lib/src/mtalpha/m/powf.o,
	* lib/src/mtalpha/m/remainderf.o,
	* lib/src/mtalpha/m/remquof.o,
	* lib/src/mtalpha/m/rintf.o,
	* lib/src/mtalpha/m/roundf.o,
	* lib/src/mtalpha/m/s_asinh.o,
	* lib/src/mtalpha/m/s_atan.o,
	* lib/src/mtalpha/m/s_cbrt.o,
	* lib/src/mtalpha/m/s_ceil.o,
	* lib/src/mtalpha/m/s_copysign.o,
	* lib/src/mtalpha/m/s_cos.o,
	* lib/src/mtalpha/m/s_erf.o,
	* lib/src/mtalpha/m/s_expm1.o,
	* lib/src/mtalpha/m/s_fabs.o,
	* lib/src/mtalpha/m/s_fdim.o,
	* lib/src/mtalpha/m/s_finite.o,
	* lib/src/mtalpha/m/s_finitef.o,
	* lib/src/mtalpha/m/s_floor.o,
	* lib/src/mtalpha/m/s_fma.o,
	* lib/src/mtalpha/m/s_fmax.o,
	* lib/src/mtalpha/m/s_fmin.o,
	* lib/src/mtalpha/m/s_fpclassify.o,
	* lib/src/mtalpha/m/s_fpclassifyf.o,
	* lib/src/mtalpha/m/s_frexp.o,
	* lib/src/mtalpha/m/s_ilogb.o,
	* lib/src/mtalpha/m/s_isinf.o,
	* lib/src/mtalpha/m/s_isinff.o,
	* lib/src/mtalpha/m/s_isnan.o,
	* lib/src/mtalpha/m/s_isnanf.o,
	* lib/src/mtalpha/m/s_ldexp.o,
	* lib/src/mtalpha/m/s_lib_version.o,
	* lib/src/mtalpha/m/s_llrint.o,
	* lib/src/mtalpha/m/s_llround.o,
	* lib/src/mtalpha/m/s_log1p.o,
	* lib/src/mtalpha/m/s_logb.o,
	* lib/src/mtalpha/m/s_lrint.o,
	* lib/src/mtalpha/m/s_lround.o,
	* lib/src/mtalpha/m/s_matherr.o,
	* lib/src/mtalpha/m/s_modf.o,
	* lib/src/mtalpha/m/s_nearbyint.o,
	* lib/src/mtalpha/m/s_nextafter.o,
	* lib/src/mtalpha/m/s_remquo.o,
	* lib/src/mtalpha/m/s_rint.o,
	* lib/src/mtalpha/m/s_round.o,
	* lib/src/mtalpha/m/s_scalbln.o,
	* lib/src/mtalpha/m/s_scalbn.o,
	* lib/src/mtalpha/m/s_signbit.o,
	* lib/src/mtalpha/m/s_signbitf.o,
	* lib/src/mtalpha/m/s_signgam.o,
	* lib/src/mtalpha/m/s_sin.o,
	* lib/src/mtalpha/m/s_tan.o,
	* lib/src/mtalpha/m/s_tanh.o,
	* lib/src/mtalpha/m/s_trunc.o,
	* lib/src/mtalpha/m/scalblnf.o,
	* lib/src/mtalpha/m/scalbnf.o,
	* lib/src/mtalpha/m/sinf.o,
	* lib/src/mtalpha/m/sinhf.o,
	* lib/src/mtalpha/m/sqrtf.o,
	* lib/src/mtalpha/m/tanf.o,
	* lib/src/mtalpha/m/tanhf.o,
	* lib/src/mtalpha/m/tgammaf.o,
	* lib/src/mtalpha/m/truncf.o,
	* lib/src/mtalpha/m/w_acos.o,
	* lib/src/mtalpha/m/w_acosh.o,
	* lib/src/mtalpha/m/w_asin.o,
	* lib/src/mtalpha/m/w_atan2.o,
	* lib/src/mtalpha/m/w_atanh.o,
	* lib/src/mtalpha/m/w_cabs.o,
	* lib/src/mtalpha/m/w_cosh.o,
	* lib/src/mtalpha/m/w_drem.o,
	* lib/src/mtalpha/m/w_exp.o,
	* lib/src/mtalpha/m/w_exp2.o,
	* lib/src/mtalpha/m/w_fmod.o,
	* lib/src/mtalpha/m/w_gamma.o,
	* lib/src/mtalpha/m/w_hypot.o,
	* lib/src/mtalpha/m/w_j0.o,
	* lib/src/mtalpha/m/w_j1.o,
	* lib/src/mtalpha/m/w_jn.o,
	* lib/src/mtalpha/m/w_lgamma.o,
	* lib/src/mtalpha/m/w_lgamma_r.o,
	* lib/src/mtalpha/m/w_log.o,
	* lib/src/mtalpha/m/w_log10.o,
	* lib/src/mtalpha/m/w_log2.o,
	* lib/src/mtalpha/m/w_pow.o,
	* lib/src/mtalpha/m/w_remainder.o,
	* lib/src/mtalpha/m/w_sinh.o,
	* lib/src/mtalpha/m/w_sqrt.o: Recompile.

	* lib/src/mtalpha/m/w_tgamma.o: Changed implementation, then
	recompile.

2010-05-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support more debugging options.

	* tools/lib/slc/front/dump.py (dump_gen): Allow to dump data
	defined by a generator.

	* tools/lib/slc/front/opts.py: Support parsing a provided list of
	arguments instead of the default sys.argv. Move M4-specific
	argument declaration (-P, -I) to...

	* tools/lib/slc/front/cm4.py: ...here.

	* tools/lib/slc/mtalpha/asmproc/base.py,
	* tools/lib/slc/mtalpha/asmproc/opt.py: Support dumping
	intermediate forms.

	* tools/bin/slc.in: Support and propagate `-fdump-asmopt-XXX' and
	`-fdump-fixup-XXX'.

2010-05-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fixes.

	* tools/lib/mtalpha.mk (nobase_dist_pkgdata_DATA): Distribute and
	install `t-spr'.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List `lex.py'.

2010-05-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* lib/src/printf-pos.c: Include <cstrings.h> for `bcopy'.

2010-05-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* tools/bin/Makefile.am (dist_bin_SCRIPTS): Also install `spr'.

2010-05-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug with MT-Alpha code generation.

	* tools/lib/slc/mtalpha/asmproc/opt.py: Also recognize `bsr' as a
	branch instruction. Ensure that "nop" is inserted between a branch
	and "end".

2010-05-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fixes.

	* tools/lib/Makefile.am (nobase_python_PYTHON): Fix typo in file
	list.

	* tools/bin/cm4.in,
	* tools/bin/slc.in: Update documentation (`-Wm4' replaced by `-X',
	`-Xm4').

2010-05-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adapt tools and library for the new calling convention.

	* tools/lib/mtalpha-sim/callgate.s,
	* tools/lib/mtalpha-sim/slrt.s: Use the new calling convention.

	* tools/lib/r-mt-sim.sh.in: Pass external data using the new
	argument registers.

2010-05-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement support for C function calls in caller thread context.

	* tools/lib/slc/mtalpha/compile.py: Re-enable call-save registers.

	* tools/lib/slc/mtalpha/asmproc/base.py (grouper): Also group
	plain C functions. Also recognize non-global (e.g. C's static)
	functions.

	* tools/lib/slc/mtalpha/asmproc/common.py (cfunfilter, flattener),
	* tools/lib/slc/mtalpha/asmproc/base.py (_cfilter_inner, filter):
	Allow to define processing of plain C functions.

	* tools/lib/slc/mtalpha/asmproc/base.py (stripmask, filter):
	Define a stage to remove the `.mask' directive, rendered
	ineffective by the new calling convention. Us eit.

	* tools/lib/slc/mtalpha/regmagic.py (makecrepl),
	* tools/lib/slc/mtalpha/asmproc/base.py (crenameregs,
	_cfilter_inner): Rename registers in plain C functions to use the
	new calling convention.

	* tools/lib/slc/mtalpha/asmproc/base.py (initspecial,
	makespecialtransform, compress, protectallcallregs,
	protectcallsave): Adapt initialisations in prologue in presence of
	C function calls.

	* tools/lib/slc/mtalpha/asmproc/base.py (_filter_inner):
	Re-organize processing stages.

	* tools/lib/slc/mtalpha/visitors.py,
	* tools/lib/t-sppalpha/include/sl_support.h: Force all function
	calls to return to the parent thread function (prevent tail calls)
	so that the "end" marker is always reached.

2010-05-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Reduce dependency on hand-coded assembly.

	* lib/src/bzero.c,
	* lib/src/bcopy.c,
	* lib/src/memcpy.c,
	* lib/src/memmove.c,
	* lib/src/memset.c: Import from FreeBSD.

	* lib/src/mtalpha/memcpy.s,
	* lib/src/mtalpha/memmove.S,
	* lib/src/mtalpha/memset.S: Remove.

	* lib/include/cstring.h: Move declaration of `bcopy' to...
	* lib/include/cstrings.h: ...here. Declare `bzero'.

	* lib/Makefile.am,
	* lib/mtalpha.mk: Update accordingly.


2010-05-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve support for `slc -P'.

	* tools/bin/slc.in: Propagate `-P' where needed.

	* tools/lib/slc/visitors.py (flatten): Omit linemarkers if `-P' is
	specified.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `sl_proccall' for `spr'.

	* tools/lib/t-spr/include/sl_support: Implement `sl_proccall'
	here, since it needs to be expanded before CM4 runs and replaces
	braces by sl_lbr/sl_rbr.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor cleanups.

	* tools/bin/slt.in: Also replace `+' by `_' when generating test
	output directory names.

	* tools/include/slc.m4: Remove support for `sl_begin_header' and
	`sl_end_header', which are now long obsolete.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Integrate `spr' and `slc' some more.

	* tools/bin/cce.in: Remove `utc' and `utc0' from the
	documentation, since they are not really usable. Add support for
	`spr' targets.

	* tools/bin/slc.in: Remove `-fwesley', obsolete since the `ppp'
	target disappeared. New `-fdump-spr-XXX' argument. Remove references
	to `-fcm4' in the documentation, since they are not really usable and
	will disappear soon.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Integrate all `spr' processes into a unique front-end.

	* tools/lib/slc/front/__init__.py,
	* tools/lib/slc/front/dump.py,
	* tools/lib/slc/front/opts.py: New.

	* tools/bin/spr: Move `Dispatcher' to...
	* tools/lib/slc/visitors.py: ...here.

	* tools/bin/spr: Move visitor chain definition to...
	* tools/lib/slc/front/chains.py: ...here. Define multiple chains.

	* tools/bin/spr: Move front-end main body to...
	* tools/lib/slc/front/main.py: ...here. Move the initial evaluation to...
	* tools/lib/slc/input/parse.py: ...here.

	* tools/lib/slc/input/cm4.py: Define configuration arguments and
	main process.
	* tools/lib/slc/front/main.py: Use it.

	* tools/lib/slc/front/main.py: Move the test for check errors to...
	* tools/lib/slc/input/check.py (CheckVisitor.visit_program): ...here.

	* tools/lib/slc/lower/flavorseta.py: New visitor `LinkSetA' to link
	`SetA' instances to the corresponding `LowCreate'. This is needed when
	`split' is not used.
	* tools/lib/slc/front/chains.py: Use `LinkSetA' where appropriate.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new files.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fixes.

	* tools/lib/slc/lower/lowercreate.py: Fix typo (cr/lc).

	* tools/lib/slc/mtalpha/visitors.py: Place extra spaces at start
	of flattening.

	* tools/lib/t-spr/slimpl.m4: Remove unneeded whitespace.

	* tools/lib/slc/input/parse.py: Check for empty blocks also
	*after* parsing the contents.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for function/create attributes.

	* tools/lib/t-spr/slimpl.m4: New syntax for attributes, new
	attributes `sl__static' and `sl__naked'.

	* tools/lib/slc/ast.py: New nodes `Attr' and `Extras' to carry
	attributes. Change `FunDecl' and `Create' accordingly.

	* tools/lib/slc/input/parse.py: Load the extra attributes from the
	input.

	* tools/lib/slc/visitors.py: Print the extras if present.

	* tools/lib/slc/lower/split.py,
	* tools/lib/slc/lower/seq.py: Use the extra attributes `static' and
	`naked' where appropriate. In particular, force `t_main' to be naked.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor front-end fix.

	* tools/lib/t-spr/slimpl.m4: Protect against whitespaces and newlines
	in names.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce test targets for the new framework.

	* build-aux/slctests.m4,
	* build-aux/slctests.mk: New flag `--enable-check-spr' and corresponding
	test targets.

2010-05-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Sanitize UI of `cm4'.

	* tools/bin/cm4.in: Replace parameter syntax `-Wm4,XXX' by `-X
	XXX'. Support redirecting to the output specified with `-o'.

	* tools/bin/cce.in,
	* tools/bin/slc.in: Use `-X' and `-o'.

2010-05-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Start integrating `spr' with `slc'.

	* tools/bin/cm4.in: Recognize `-I'.

	* tools/bin/slc.in: Move cm4-specific stuff to...
	* tools/bin/cce.in: ...here. Generalize translation stage via
	new variable `$slc_translator'. Allow `spr' to replace `cm4'.
	* tools/bin/slc.in: Simplify accordingly.

	* tools/bin/slc.in: Propagate `-P' to underlying tools instead of
	translating. Move setting of `-E' to...
	* tools/lib/slc/input/cm4.py: ...here.

	* tools/bin/Makefile.am,
	* build-aux/slc.m4,
	* build-aux/slcvars.mk: Make the tools aware of the location of
	`spr'.

2010-05-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fixes.

	* tools/bin/spp: Disable the warning for now, it is too
	annoying.

	* tools/lib/slc/mtalpha/regmagic.py (mapcall): Fix typo
	(`glfarg').

2010-05-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Packaging fixes.

	* tools/lib/Makefile.am,
	* tools/lib/mtalpha.mk: Adjust file paths after recent changes.

	* build-aux/slc.m4,
	* build-aux/slcvars.mk: Make the tools aware of the new Python
	library via `PYTHONPATH'.

2010-05-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Remove targets `ppp' and `ppp2'. Keep `spp' as transition target.

	* tools/lib/t-ppp2alpha/slimpl.m4,
	* tools/lib/t-ppp2alpha/include/sl_support.h: Rename to...

	* tools/lib/t-sppalpha/slimpl.m4,
	* tools/lib/t-sppalpha/include/sl_support.h: ... here.

	* tools/bin/cce.in: Remove references to `ppp' and
	`ppp2'. Introduce `spp' instead.

	* tools/bin/spp: Update accordingly.

	* tools/lib/mtalpha-sim/slrt.s: Use the short alias `mtalpha' for the
	slr data tag, to allow future adaptation.

2010-05-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Migrate `spp' to the new framework.

	* tools/bin/spp: Use the new framework.
	* tools/lib/slc/mtalpha/spp.py: Remove, obsoleted by `spp'.

	* tools/lib/t-ppp2alpha/slimpl.m4: Adjust parameter declarations
	for the new syntax required by `spp'.

2010-05-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor API improvement.

	* tools/lib/slc/msg.py: Allow to use `warn' and `log' without context.

2010-05-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Merge CM4 into new framework.

	* tools/bin/cm4.in: Copy functionality to...
	* tools/lib/slc/input/cm4.py: ... here.

	* tools/bin/cm4.in: Handle parameters `-P' and `-fcm4-trace'.
	* tools/bin/slc.in: Use the new parameters.

2010-05-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Move forward with the new code transformation framework.

	* tools/lib/slc/ast.py: Introduce nodes for C types, typedefs and
	typedef uses.

	* tools/lib/slc/visitors.py: Introduce default visits for the new
	nodes.

	* tools/lib/slc/lower/lowccast.py,
	* tools/lib/slc/lower/lowcvars.py,
	* tools/lib/slc/lower/rename.py: Adapt to use the new type nodes.

	* tools/lib/slc/lower/seq.py,
	* tools/lib/slc/mtalpha/visitors.py: Use the new type nodes for
	the function pointers and memargs structure. Adapt function
	parameter declarations.

	* tools/lib/slc/lower/lowercreate.py: Emit line number before
	assignment of exit code.

2010-05-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Move forward with the new code transformation framework.

	Framework usability improvements:

	* tools/lib/slc/ast.py (Item): Implement `+' for items to simplify
	block composition.

	* tools/lib/slc/ast.py (Block): Allow to instanciate with only one
	item. Convert plain strings to opaques.

	* tools/bin/spr: Move specification of stages to a data
	structure. Output intermediate results to files.

	New features:

	* tools/lib/slc/ast.py: Introduce nodes for C variable
	declarations and uses; C labels and gotos; cast expressions, and
	subscript operations.

	* tools/lib/slc/visitors.py: Introduce default visits for the new
	nodes. New `ScopedVisitor'.

	* tools/bin/spr (Dispatcher),
	* tools/lib/slc/visitors.py (BaseVisitor): Merge state of split
	visitors (alias `__dict__' between dispatcher and alternates).

	* tools/lib/lower/rename.py,
	* tools/lib/lower/lowccast.py,
	* tools/lib/lower/lowclabels.py,
	* tools/lib/lower/lowcvars.py,
	* tools/lib/lower/remflavors.py: New stages.

	Changes:

	* tools/bin/spr: Use the new stages.

	* tools/lib/input/check.py: Ensure `break' and `end_thread' do not
	appear within create/sync. Keep track of relation between `create'
	and scopes.

	* tools/lib/slc/ast.py: Simplify `LowCreate'. Remove
	`LowCreateArg'. Move `funtype' to `Create'.

	* tools/lib/slc/visitors.py,
	* tools/lib/slc/lower/split.py,
	* tools/lib/slc/lower/seq.py,
	* tools/lib/slc/mtalpha/visitors.py: Update accordingly. Improve
	algorithms. Fix false duplication of C variable declarations in
	split.

	* tools/lib/lower/flavorseta.py: New. Annotate `SetA' with the
	relevant references to `LowCreate'.

	* tools/lib/lower/seq.py,
	* tools/lib/mtalpha/visitors.py: Use the annotations in
	`visit_seta'.

	* tools/lib/lower/lowgeta.py: Use the new syntax for lowering.

	Minor code cleanups:

	* tools/lib/slc/ast.py (Item): Remove `Item.clone' (never used).
	* tools/lib/slc/ast.py (Block): Remove `indexname' (now unused).
	* tools/lib/slc/ast.py: Remove `FunDeclPtr' (not yet used).

	* tools/lib/slc/lower/seq.py,
	* tools/lib/slc/mtalpha/visitors.py: Remove `visit_geta' (now
	handled by ReduceGetA).

2010-05-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor whitespace handling improvements.

	* tools/lib/slc/input/parse.py (parse_block): Ignore chunks of C text
	with only horizontal whitespace.

	* tools/lib/t-spr/slimpl.m4: Force `#line' at the start of a C block.

2010-05-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement tree checking.

	* tools/lib/slc/ast.py,
	* tools/lib/slc/visitors.py: Introduce a `decl' part in scopes.

	* tools/lib/slc/input/check.py: New.

	* tools/bin/spr: Use the tree checker.

	* tools/lib/Makefile.am: List the new file.

2010-05-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce support for scopes, free index declarations.

	* tools/bin/cm4.in: Escape `{' and `}' to `sl_lbr' and `sl_rbr'.

	* tools/lib/t-spr/slimpl.m4,
	* tools/lib/slc/ast.py,
	* tools/lib/slc/input/parse.py: Introduce scopes and parse them.

	* tools/lib/visitors.py: Handle scopes.

	* tools/lib/slc/ast.py: Introduce node for index declarations.

	* tools/lib/slc/visitors.py,
	* tools/lib/slc/input/parse.py,
	* tools/lib/slc/lower/seq.py,
	* tools/lib/slc/mtalpha/visitors.py: Handle individual index
	declaration nodes. Simplify block handling accordingly.

	* tools/bin/spr: Move final lowering of `sl_geta' to...
	* tools/lib/slc/lower/lowgeta.py: ...here.

	* tools/lib/Makefile.am: List the new file.

2010-05-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Reach prototype of the deadlock avoidance scheme.

	* tools/bin/spr: Move file reading and parsing to...

	* tools/lib/input/read.py,
	* tools/lib/input/parse.py: ...here.

	* tools/bin/spr: Move MT-Alpha visitors to...

	* tools/lib/mtalpha/visitors.py: ...here.

	* tools/lib/ast.py: Introduce flavors. Move dispatch mechanisms
	to...
	* tools/lib/visitors.py: ...here.

	* tools/lib/lower/split.py: Implement code duplication using
	flavors.

	* tools/lib/lower/seq.py: Update accordingly.

	* tools/lib/Makefile.am: List the new files.

	* tools/lib/lower/lowercreates.py: Fix typo (missing closing paren).

	* tools/bin/spr: Use the new mechanisms.

2010-05-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Refactor `spr' and introduce intermediate create lowering.

	* tools/bin/spr,
	* tools/lib/slc/ast.py: Kill definitions and uses of the
	`fid_lvalue'.

	* tools/lib/slc_config.py.in,
	* tools/lib/slc/lower/__init__.py,
	* tools/lib/slc/input/__init__.py: New.

	* tools/bin/spr: Extract visitor definitions to...
	* tools/lib/slc/visitors.py,
	* tools/lib/slc/lower/seq.py: ... here.

	* tools/lib/slc/ast.py: New `LowCreate' and `LowCreateArg' nodes.
	* tools/lib/slc/lower/lowercreate.py: New.

	* tools/lib/slc/lower/seq.py: Simplify by using the result of
	create lowering.

	* tools/lib/Makefile.am: List the new files.

	* tools/bin/spr: Test the new lowering.

2010-05-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Refactor `spp' and `spr'.

	Since some features from `spp' and `spr' are shared, and `spr' is
	deemed to grow larger, split them as an installable Python library
	tree.

	* tools/bin/spr: Extract location definitions and AST nodes to...
	* tools/lib/slc/loc.py: ... here,
	* tools/lib/slc/lex.py: ... here, and ...
	* tools/lib/slc/ast.py: ... here. Refactor as needed.

	* tools/bin/spr: Extract register magic to...
	* tools/lib/slc/mtalpha/regmagic.py: ... here.

	* tools/lib/slc/__init__.py,
	* tools/lib/slc/mtalpha/__init__.py,
	* tools/lib/slc/mtalpha/asmproc/__init__.py: New.

	* tools/bin/spp: Split into...

	* tools/lib/slc/msg.py,
	* tools/lib/slc/mtalpha/spp.py,
	* tools/lib/slc/mtalpha/compile.py,
	* tools/lib/slc/mtalpha/asmproc/base.py,
	* tools/lib/slc/mtalpha/asmproc/common.py,
	* tools/lib/slc/mtalpha/asmproc/opt.py: ... this. Refactor as needed.

	* tools/lib/Makefile.am (nobase_python_PYTHON): List the new
	files.

2010-05-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Move forward with the new code transformation framework.

	* tools/bin/spr: Implement the transform of creates to MT-Alpha.

2010-04-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Move forward with the new code transformation framework.

	* tools/bin/spr: Implement the transform of thread function
	definitions to MT-Alpha thread functions (not creates). Introduce
	indirection through dispatcher in visitor for future
	alternate dispatch.

2010-04-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Move forward with the new code transformation framework.

	* tools/lib/t-spr/slimpl.m4: Define `sl_break'.

	* tools/bin/spr: Modify visitor framework to allow stages to
	replace the node they are visiting with something else. Implement
	the transforms to sequential execution.

2010-04-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce `spr'.

	* tools/bin/spr: New.

	* tools/lib/t-spr/slimpl.m4: Preserve backslashes in C text.

2010-04-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Prepare for new code splitting tool `spr'.

	* tools/lib/t-spr/slimpl.m4: Implement macros that split the code.
	* tools/lib/t-spr/include/sl_support.h: Placeholder to please `slc'.

	* tools/bin/cce.in: Make `t-spr' usable for tests.

2010-04-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* doc/NEWS.txt: Initialize for 2.4.x.

2010-04-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Release version 2.4.

	* build-aux/package-version: Update to 2.4.

	* doc/NEWS.txt: Document recent changes.

2010-04-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update copyright notice of files changed in 2010.

	* build-aux/sl.mk,
	* build-aux/slctests.mk,
	* lib/Makefile.am,
	* lib/include/cmalloc.h,
	* lib/include/cstdio.h,
	* lib/include/ctime.h,
	* lib/include/svp/assert.h,
	* lib/include/svp/callgate.h,
	* lib/include/svp/io.h,
	* lib/include/svp/iomacros.h,
	* lib/include/svp/sep.h,
	* lib/mtalpha-sim/include/svp_asmdiv.h,
	* lib/src/abort.c,
	* lib/src/heap.c,
	* lib/src/malloc_wrappers.c,
	* lib/src/mtsep.c,
	* lib/src/perf.c,
	* tools/bin/Makefile.am,
	* tools/bin/cce.in,
	* tools/bin/slc.in,
	* tools/bin/spp,
	* tools/include/m4sugar_foreach.m4,
	* tools/include/m4sugar_version.m4,
	* tools/include/svp/testoutput.h,
	* tools/lib/Makefile.am,
	* tools/lib/host-host-ptl/include/ptl_config.h,
	* tools/lib/host-host-ptl/include/ptl_debug.h,
	* tools/lib/host-host-ptl/include/ptl_deps.h,
	* tools/lib/host-host-ptl/include/ptl_vars.h,
	* tools/lib/host-host-ptl/ptl_debug.cc,
	* tools/lib/host-host-ptl/ptl_vars.cc,
	* tools/lib/mtalpha-sim/callgate.s,
	* tools/lib/t-ppp2alpha/include/sl_support.h,
	* tools/lib/t-pppalpha/include/sl_support.h: Add 2010 to copyright notice.

2010-04-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Remove support for `sl_funcall'.

	The construct `sl_funcall' was obsolete for a while already.

	* tools/lib/t-utc/slimpl.m4,
	* tools/lib/t-utc0/slimpl.m4,
	* tools/lib/t-ptl/slimpl.m4,
	* tools/lib/t-pppalpha/slimpl.m4,
	* tools/lib/t-ppp2alpha/slimpl.m4: Remove `sl_funcall' and `sl_farg'.

2010-04-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support `sl_create' inside plain C functions.

	The MT-Alpha target now support the construct; this changeset
	extends the functionality to the sequential C target.

	* tools/lib/t-seqc/slimpl.m4: Deprecate `sl_kill'. Implement new
	`sl_break' semantics (not yet official). This removes the need for
	a linked list of family contexts, so a new child can appear
	disconnected. This allows `sl_create' to appear inside plain C
	functions.

	* tools/lib/t-seqc/include/sl_support.h: Remove the obsolete field.

2010-04-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adjust place usage in current MT-alpha delegations.

	A new feature was added to the hardware to select the behavior of
	`allocate' using a bit in the place identifier. When the bit is
	*not* set, upon failure allocate returns FID 0. This will be used
	later during automatic deadlock prevention. However, since the
	current code assumes allocate always returns a valid FID, the bit
	needs to be set everywhere for now.

	* lib/include/cstdlib.h,
	* lib/mtalpha-sim/include/svp_asmdiv.h,
	* lib/src/mtalpha/mtdiv.s,
	* lib/src/mtsep.c,
	* tools/bin/spp,
	* tools/lib/t-ppp2alpha/include/sl_support.h: Set bit 3 of place identifiers.

2010-04-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in MT-alpha code generation.

	* tools/lib/t-ppp2alpha/include/sl_support.h: Ensure that the read
	to a shared after sync completes in all cases. This is needed in case
	the `gets' instruction is followed by `ldq' with the same register
	as target ("cannot write to waiting register").

2010-04-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix handling of `slr' argument.

	The `slr' utility needs to recompile code using the same back-end
	as the executed program. This is recognized by a text tag.

	* tools/lib/mtalpha-sim/slrt.s (slr_datatag): Upgrade data tag
	to new back-end name.

2010-04-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in MT-alpha code generation.

	* tools/bin/spp,
	* tools/lib/t-ppp2alpha/include/sl_support.h: Cast global or
	shared argument to desired type before passing to `asm' statement,
	so that constant `0' can be passed as a floating point.

2010-04-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase use of `-b mtalpha'.

	* build-aux/slctests.mk,
	* build-aux/sl.mk (SLC_BEFORE): Use `-b mtalpha' instead of `-b
	ppp' to build programs.

2010-04-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Optimize the MT-alpha calling convention.

	The calling convention was expecting PV to be present in some
	global thread parameter in order to place `ldgp' (or `ldah,lda
	!gpdisp') immediately at the start of the thread code. This
	required to pass PV in a global thread argument even if it was
	potentially not used in the target created family.

	This is now optimized by computing PV in the threads that need it,
	through the Alpha `br' instruction (`br $pv, 0' loads the PV of
	the next instruction into $pv), now aliased to `ldpc' in the
	assembler.

	* tools/bin/spp (ppp2alpha): Handle the new calling convention.

	* tools/lib/t-ppp2alpha/include/sl_support.h,
	* tools/include/svp/gomt.h: Avoid passing PV, since it is no
	longer needed.

2010-04-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Adapt library for new code generation.

	* tools/bin/cce.in: Obsolete the short aliases `ppp' and `ppp2'.

	* tools/include/svp/gomt.h,
	* lib/include/svp/callgate.h,
	* lib/src/mtalpha/mtdiv.s,
	* lib/mtalpha-sim/include/svp_asmdiv.h: Use the new allocate/create
	mechanism.

	* tools/bin/spp,
	* tools/lib/t-ppp2alpha/include/sl_support.h: Use `wmb', not `wb'.

	* tools/lib/t-ppp2alpha/include/sl_support.h: `allocate' has side
	effects, so make it `volatile'.

	* lib/mtalpha.mk,
	* tools/lib/mtalpha.mk: List the new files. Use `mtalpha' instead
	of `ppp' as target.

2010-04-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement code generation for new back-end `ppp2'.

	* tools/bin/cce.in: Enable `-fwesley' by default for target
	`ppp2'.

	* tools/lib/t-ppp2alpha/slimpl.m4,
	* tools/lib/t-ppp2alpha/include/sl_support.h,
	* tools/bin/spp: Implement.

2010-03-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Initialize new MT-alpha back-end `ppp2'.

	* tools/bin/cce.in: Recognize `ppp2'.

	* tools/bin/spp (ppp2alpha): Initialize new target class.

	* tools/lib/t-pppalpha/slimpl.m4,
	* tools/lib/t-pppalpha/include/sl_support.h: Copy to...

	* tools/lib/t-ppp2alpha/slimpl.m4,
	* tools/lib/t-ppp2alpha/include/sl_support.h: ... here.

2010-03-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the MT-alpha back-end.

	* tools/lib/t-pppalpha/include/sl_support.h: Implement a new
	"write-to-shared" macro that forces the value to be present
	in a temporary before it is written to the shared register.

	* tools/bin/slc.in: New option `-fwesley' that enables the new
	handling of shared parameters.

	* tools/bin/spp: New filter that ensures that `mov' instructions
	operating on floating point registers are renamed to fmov.

2010-03-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update documentation.

	* doc/HACKING.txt: Reflect latest ChangeLog practices.

2010-02-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* tools/lib/Makefile.am (nobase_dist_pkgdata_DATA): List the new
	profiles.

2010-02-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Remove support for `slr -C', now replaced by `slr -m'.

	"Forcing COMA" makes no sense when there are multiple
	COMA implementations available. Let profiles select.

	* tools/bin/slr.in,
	* tools/lib/r-mt-sim.sh.in: Drop support for `-C', `-Cc' and
	`-Cd'.

	* tools/lib/mt-profiles/lzcoma_default,
	* tools/lib/mt-profiles/mlcoma_default: New.

	* build-aux/slctests.mk: Use the new COMA profiles for testing.

2010-02-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Cosmetic fix to `slr'.

	* tools/lib/r-mt-sim.sh.in: Silence program initialization for
	recursive calls.

2010-02-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend simulator profiles.

	* tools/lib/mt-profiles/coma128: Symlink to...
	* tools/lib/mt-profiles/lzcoma128_2chan: ...here. Fix sizes and timings.

	* tools/lib/mt-profiles/coma256: Symlink to...
	* tools/lib/mt-profiles/lzcoma256_2chan: ...here. Fix sizes and timings.

	* tools/lib/mt-profiles/zlcoma128_1chan,
	* tools/lib/mt-profiles/zlcoma256_1chan,
	* tools/lib/mt-profiles/mlcoma128_1chan,
	* tools/lib/mt-profiles/mlcoma256_1chan: New.

	* tools/lib/mt-profiles/ml-npcrypt-p1,
	* tools/lib/mt-profiles/ml-npcrypt-p2,
	* tools/lib/mt-profiles/ml-npcrypt-p4,
	* tools/lib/mt-profiles/ml-npcrypt-p8: Update descriptions.

	* tools/lib/mt-profiles/rmb1,
	* tools/lib/mt-profiles/rmb4,
	* tools/lib/mt-profiles/rmb8,
	* tools/lib/mt-profiles/rmb128,
	* tools/lib/mt-profiles/rmb256: Rename to...
	* tools/lib/mt-profiles/rbm1,
	* tools/lib/mt-profiles/rbm4,
	* tools/lib/mt-profiles/rbm8,
	* tools/lib/mt-profiles/rbm128,
	* tools/lib/mt-profiles/rbm256: ...here. Fix timings.

	* tools/lib/mt-profiles/simple,
	* tools/lib/mt-profiles/default: Update symlink after renaming.

	* tools/lib/Makefile.am: Update accordingly.

2010-02-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the system initialization code.

	* lib/src/mtconf.h,
	* lib/src/mtconf.c: New. This reads extra configuration data from
	the simulator, when present.

	* lib/src/mtinit.c: Also call `sys_conf_init()'. Make
	initialization verbose, unless disabled by environment
	variable. Rename init routines with `sys_' prefix.

	* tools/lib/mtalpha-sim/slrt.s: Use the new name `sys_init'.

	* lib/src/mtsep.c,
	* lib/src/heap.c: Make this verbose too.

	* lib/src/heap.h: New.

	* lib/include/svp/sep.h: Expose the number of family table entries
	and thread entries in `struct placeinfo'.
	* lib/src/mtsep.c: Initialize the extra fields.

	* lib/mtalpha.mk: List the new files.

2010-02-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	This fixes the following issue: if `configure' was run after a
	first build and picks up new locations for tools (simulator,
	compilers, etc), the SL scripts `cce', `slr' etc would not be
	regenerated to reflect the new locations. (Thanks to A. Matei)

	* tools/lib/Makefile.am,
	* tools/bin/Makefile.am: Re-generate scripts when `Makefile'
	changes, not only `Makefile.am'.

2010-02-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor cosmetic fix in `slr'.

	* tools/bin/slr.in: Enhance output of `-m list'.

2010-02-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* doc/NEWS.txt: Initialize for 2.3.x.

2010-02-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Release version 2.3.

	* build-aux/package-version: Update to 2.3.

	* doc/NEWS.txt: Document recent changes.

2010-02-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* lib/src/gdtoa/README: New. (was listed but not imported)

2010-02-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* build-aux/Makefile.am: Ensure that the script `version-gen'
	becomes executable upon installation.

2010-02-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add option `--disable-check-coma' for other packages.

	Since the COMA simulation may need to be avoided even if
	available, provide a flag to disable it explicitly.

	* build-aux/slctests.m4: Support new flag.

2010-02-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Small optimization in run-time library.

	* tools/include/svp/testoutput.h: Output using `unsigned
	char'. (saves one instruction on Alpha)

2010-02-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend and improve the SL standard library.

	* lib/include/cassert.h,
	* lib/include/cstdio.h,
	* lib/include/sys/ctypes.h: New.
	* lib/Makefile.am: Update accordingly.

	* lib/include/svp/assert.h,
	* lib/include/svp/io.h,
	* lib/include/svp/iomacros.h: Deprecate.

	* lib/src/mtsep.c: Use the new API.

	* lib/include/cerrno.h,
	* lib/include/cstdlib.h,
	* lib/include/cstring.h: Extend.

	* lib/include/ctime.h: Find `clock_t' in <sys/ctypes.h>.

	* lib/src/malloc_intrinsics.h: Remove.
	* lib/src/malloc_intrinsics.c: Remove. Contents in...
	* lib/src/heap.c: ...here, and...
	* lib/src/abort.c: ...here.
	# lib/src/malloc.c: Update accordingly.

	* lib/src/gdtoa/arith-mtalpha.h,
	* lib/src/gdtoa/arith.h,
	* lib/src/gdtoa/arithchk.c,
	* lib/src/gdtoa/dmisc.c,
	* lib/src/gdtoa/dtoa.c,
	* lib/src/gdtoa/g_Qfmt.c,
	* lib/src/gdtoa/g__fmt.c,
	* lib/src/gdtoa/g_ddfmt.c,
	* lib/src/gdtoa/g_dfmt.c,
	* lib/src/gdtoa/g_ffmt.c,
	* lib/src/gdtoa/g_xLfmt.c,
	* lib/src/gdtoa/g_xfmt.c,
	* lib/src/gdtoa/gd_qnan-mtalpha.h,
	* lib/src/gdtoa/gd_qnan.h,
	* lib/src/gdtoa/gdtoa.c,
	* lib/src/gdtoa/gdtoa.h,
	* lib/src/gdtoa/gdtoa_fltrnds.h,
	* lib/src/gdtoa/gdtoaimp.h,
	* lib/src/gdtoa/gethex.c,
	* lib/src/gdtoa/gmisc.c,
	* lib/src/gdtoa/hd_init.c,
	* lib/src/gdtoa/hexnan.c,
	* lib/src/gdtoa/makefile,
	* lib/src/gdtoa/misc.c,
	* lib/src/gdtoa/qnan.c,
	* lib/src/gdtoa/smisc.c,
	* lib/src/gdtoa/strtoIQ.c,
	* lib/src/gdtoa/strtoId.c,
	* lib/src/gdtoa/strtoIdd.c,
	* lib/src/gdtoa/strtoIf.c,
	* lib/src/gdtoa/strtoIg.c,
	* lib/src/gdtoa/strtoIx.c,
	* lib/src/gdtoa/strtoIxL.c,
	* lib/src/gdtoa/strtod.c,
	* lib/src/gdtoa/strtodI.c,
	* lib/src/gdtoa/strtodg.c,
	* lib/src/gdtoa/strtodnrp.c,
	* lib/src/gdtoa/strtof.c,
	* lib/src/gdtoa/strtopQ.c,
	* lib/src/gdtoa/strtopd.c,
	* lib/src/gdtoa/strtopdd.c,
	* lib/src/gdtoa/strtopf.c,
	* lib/src/gdtoa/strtopx.c,
	* lib/src/gdtoa/strtopxL.c,
	* lib/src/gdtoa/strtorQ.c,
	* lib/src/gdtoa/strtord.c,
	* lib/src/gdtoa/strtordd.c,
	* lib/src/gdtoa/strtorf.c,
	* lib/src/gdtoa/strtorx.c,
	* lib/src/gdtoa/strtorxL.c,
	* lib/src/gdtoa/sum.c,
	* lib/src/gdtoa/ulp.c: Import from FreeBSD. This provides
	`dtoa'/`strtod', etc.
	* lib/gdtoa.mk: New.

	* lib/src/dtoa_simple.c: Provide alternative `dtoa' since the
	gdtoa code seems to have FP issues on the MG simulator at this
	point.

	* lib/src/floatio.h,
	* lib/src/fpmath.h,
	* lib/src/_hdtoa.c,
	* lib/src/fprintf.c,
	* lib/src/perror.c,
	* lib/src/printf-pos.c,
	* lib/src/printf.c,
	* lib/src/printfcommon.h,
	* lib/src/printflocal.h,
	* lib/src/sprintf.c,
	* lib/src/strcat.c,
	* lib/src/strerror.c,
	* lib/src/strlcat.c,
	* lib/src/strlcpy.c,
	* lib/src/strncat.c,
	* lib/src/strnlen.c,
	* lib/src/vfprintf.c: Import from FreeBSD. Use `dtoa_simple' in
	printf's `%f', etc. for now.

	* lib/src/mtstdio.h,
	* lib/src/mtstdio.c: Provide barebones stdio FILEs.

	* lib/src/fputc.c,
	* lib/src/fputs.c,
	* lib/src/putc.c,
	* lib/src/putchar.c,
	* lib/src/puts.c,
	* lib/src/fwrite.c,
	* lib/src/snprintf.c,
	* lib/src/vsnprintf.c,
	* lib/src/vprintf.c: Provide more I/O primitives from the basic
	FreeBSD implementations.

	* lib/src/sys_errlist.c,
	* lib/src/bcopy.c: New. (dependencies to printf/perror)

	* lib/mtalpha.mk: List the new files.

2010-02-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve `slr'.

	* tools/bin/slr.in: Fix support for '][' in Fibre input.

	* tools/lib/r-mt-sim.sh.in: Avoid the symbol table generation and
	do not set COMA when running recursively (i.e. when dumping input
	data).

2010-02-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for program symbol tables in MGSim.

	* build-aux/mgbinutils.m4: Also detect the `nm' utility.
	* tools/lib/Makefile.am: Propagate `nm' to `r-mt-sim.sh.in'.
	* tools/lib/r-mt-sim.sh.in: Generate and pass program symbol table
	to simulator.

2010-02-05  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Expose initial place to programs.

	* lib/src/mtsep.c (sep_init): Initialize `__main_place_id' and
	`__main_placeinfo'.

2010-01-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in `slr -m'.

	* tools/lib/r-mt-sim.sh.in: Fix handling of custom profiles in
	`~/.mt-profiles'.

2010-01-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Upgrade the mutc-ptl back-end.

	* tools/lib/host-host-ptl/include/create.tpl,
	* tools/lib/host-host-ptl/include/ptl_svp.h,
	* tools/lib/host-host-ptl/include/template.pl,
	* tools/lib/host-host-ptl/ptl_svp.cc: Update to latest utc-ptl
	code.

	* tools/lib/host-host-ptl/include/ptl_config.h,
	* tools/lib/host-host-ptl/include/ptl_debug.h,
	* tools/lib/host-host-ptl/include/ptl_deps.h,
	* tools/lib/host-host-ptl/include/ptl_svp.h,
	* tools/lib/host-host-ptl/include/ptl_vars.h,
	* tools/lib/host-host-ptl/include/template.pl,
	* tools/lib/host-host-ptl/ptl_debug.cc,
	* tools/lib/host-host-ptl/ptl_svp.cc,
	* tools/lib/host-host-ptl/ptl_vars.cc: Strip license text as it
	has not been decided yet.

2010-01-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix the MT profiles.

	* tools/lib/mt-profiles/coma128,
	* tools/lib/mt-profiles/coma256,
	* tools/lib/mt-profiles/ml-npcrypt-p1,
	* tools/lib/mt-profiles/ml-npcrypt-p2,
	* tools/lib/mt-profiles/ml-npcrypt-p4,
	* tools/lib/mt-profiles/ml-npcrypt-p8,
	* tools/lib/mt-profiles/rmb1,
	* tools/lib/mt-profiles/rmb128,
	* tools/lib/mt-profiles/rmb256,
	* tools/lib/mt-profiles/rmb4,
	* tools/lib/mt-profiles/rmb8: Use $simargs_base to define the
	number of cores since NCORES is not used any more.

2010-01-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix call gate to C functions.

	* tools/lib/mtalpha-sim/callgate.s: Use $15 (FP) to carry over the
	pointer to the memory location for return values, instead of $14
	which may be overwritten by the callee

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update documentation.

	* doc/NEWS.txt: Update changes since 2.2.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* lib/Makefile.am: List `cerrno.h' and `undocumented.h'.

	* lib/mtalpha.mk: Clean up more objects..

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Repurpose option -n of `slr'.

	* tools/bin/slr.in,
	* tools/lib/r-mt-sim.sh.in: Change handling of option `-n' to set
	environment variable `SLR_NCORES' instead of overriding the place
	configuration.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	New feature: automatic delegation of `t_main'.

	If the environment variable `SLR_NCORES' is set and non-zero, a
	place of that number of cores is allocated upon program start-up
	and used to delegate creation the program's top-level thread
	`t_main'. This achieves transparent reconfiguration of the number
	of cores a program is being run on without explicit use of the SEP
	in the program.

	* tools/include/svp/gomt.h: Capture the construct that allows to
	create a family of one thread from plain C mode in a macro
	`INVOKE_MT'.
	* tools/Makefile.am: List the new file.

	* lib/src/mtinit.c: Move definition of `environ' to ...
	* tools/lib/mtalpha-sim/slrt.s: ...here.

	* tools/lib/mtalpha-sim/slrt.s: New global objects
	`__main_place_id' and `__main_placeinfo'.

	* lib/src/mtinit.c: Use `SLR_NCORES' (if set) to initialize
	`__main_place_id' and `__main_placeinfo' using the SEP.

	* tools/lib/mtalpha-sim/main.c: Use `__main_place_id' to delegate
	creation of `t_main'.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the SL standard library.

	* lib/include/cstdarg.h: New.
	* lib/Makefile.am: Update accordingly.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	More C99 compatibility.

	* lib/include/undocumented.h,
	* lib/include/cmalloc.h: Move declarations into...

	* lib/include/cstring.h,
	* lib/include/cstdlib.h: ...here.

	* lib/include/sac_helpers.h: Update accordingly.
	* lib/Makefile.am: List the new headers.

	* lib/include/cmalloc.h: Deprecate.

	* lib/src/atoi.c,
	* lib/src/atol.c,
	* lib/src/atoll.c,
	* lib/src/getenv.c,
	* lib/src/malloc_wrappers.c,
	* lib/src/mtinit.c,
	* lib/src/perf.c,
	* lib/src/stpcpy.c,
	* lib/src/stpncpy.c,
	* lib/src/strchr.c,
	* lib/src/strcpy.c,
	* lib/src/strdup.c,
	* lib/src/strlen.c,
	* lib/src/strncmp.c,
	* lib/src/strncpy.c,
	* lib/src/strtol.c,
	* lib/src/strtoll.c,
	* lib/src/strtoull.c: Use the new header names.

	* lib/mtalpha.mk: Silence (known) warnings.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the SL standard library.

	* lib/include/undocumented.h: Add more C99 declarations.

	* lib/src/atoi.c,
	* lib/src/atol.c,
	* lib/src/atoll.c,
	* lib/src/strtol.c,
	* lib/src/strtoll.c,
	* lib/src/strtoul.c,
	* lib/src/strtoull.c: New.

	* lib/mtalpha.mk: Update accordingly.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Misc fixes to MT-Alpha code generation.

	A number of quirks were discovereed when manually inspecting
	assembly source. While these may not be functional bugs they
	caused potentially inefficient code to be generated.

	* tools/bin/spp (pppalpha.rmswchbegin): Also disallow `swch'
	directly after a label.

	* tools/bin/spp (prunenopend): flush swch/nop/fnop sequences also
	when encountering a directive, instead of skipping until the next
	instruction. This prevents patterns like "br; swch; .align" from
	being transformed into "br; .align; swch".

	* tools/bin/spp (pppalpha.addswchll): shorten comments.

	* tools/bin/spp (pppalpha.printer): use less whitespace.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in support for the `fast_' allocation routines.

	The call gate to C code used by the `fast_' macros in `cmalloc.h'
	had become invalid at some point when support for varargs and
	transparent function calls was implemented. A new call gate was
	required.

	* tools/lib/mtalpha-sim/callgate.s: New gate
	__sl_callgate_owntls. This is required for the manual call gate
	implemented in the library, since CALL_WITH_INFO cannot guarantee
	that the argument data in memory is at the tip of the stack.

	Also, document the gates.

	* lib/include/svp/callgate.h: Use the new gate.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for environment variables inside emulation.

	* tools/bin/slr.in,
	* tools/lib/r-mt-sim.sh.in: Propagate the host environment
	variables to the simulated environment. Environment data is loaded
	into simulator memory, initial address in $l18.

	* tools/lib/Makefile.am: Tell scripts where to find Python, as
	this is now used to build the environment data.

	* tools/lib/mtalpha-sim/slrt.s: Propagate environment data to
	`_lib_init_routine'.

	* lib/src/mtinit.s (_lib_init_routine): Initialize `environ' array
	for use by `getenv.c'.

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor bug fix.

	* tools/bin/slr.in,
	* tools/lib/r-mt-sim.sh.in: Care about potentially unset
	variables (VERBOSE, DESCRIPTION).

2010-01-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the SL standard library.

	* lib/include/sac_helpers.h: Move definitions into...
	* lib/include/undocumented.h: ... here. Add more C99 declarations.

	* lib/src/errno.c,
	* lib/include/cerrno.h: New.

	* lib/src/getenv.c,
	* lib/src/stpcpy.c,
	* lib/src/stpncpy.c,
	* lib/src/strchr.c,
	* lib/src/strcpy.c,
	* lib/src/strdup.c,
	* lib/src/strlen.c,
	* lib/src/strncmp.c,
	* lib/src/strncpy.c: Import from FreeBSD.

	* lib/src/mtalpha/memmove.S: Import from Linux.

	* lib/mtalpha.mk: Update accordingly.

2010-01-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix profiles `coma128' and `coma256'.

	* tools/lib/mt-profiles/coma128,
	* tools/lib/mt-profiles/coma256: Cores at 1.5GHz, not 1GHz.

2010-01-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Upgrade COMA support to latest simulator changes (+ bug fixes).

	* tools/lib/mt-profiles/coma128,
	* tools/lib/mt-profiles/coma256,
	* tools/lib/mt-profiles/ml-npcrypt-p1,
	* tools/lib/mt-profiles/ml-npcrypt-p2,
	* tools/lib/mt-profiles/ml-npcrypt-p4,
	* tools/lib/mt-profiles/ml-npcrypt-p8: Use new COMA configuration
	options.

	* tools/lib/mt-profiles/coma128,
	* tools/lib/mt-profiles/coma256: Use DDR3-2400 configuration
	instead of DDR3-1600, as decided in Apple-CORE.

	* tools/bin/slr.in: Fix handling of option -C. Repurpose -Cc and
	-Cd to "cores per cache" and "caches per directory", respectively.

	* tools/lib/r-mt-sim.sh.in: Update accordingly.

2010-01-12  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add missing whitespace in `mtperf_report_intervals'.

	* lib/src/perf.c (mtperf_report_intervals): Print newlines around
	the outer Fibre array boundaries.

2010-01-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix some whitespace handling with `sl_set' / `sl_get'.

	* tools/lib/t-pppalpha/slimpl.m4,
	* tools/lib/t-ptl/slimpl.m4,
	* tools/lib/t-seqc/slimpl.m4,
	* tools/lib/t-utc/slimpl.m4,
	* tools/lib/t-utc0/slimpl.m4: Use `m4_normalize' and `m4_ifblank'
	where appropriate.


2010-01-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Upgrade to latest version of M4Sugar.

	* tools/include/m4sugar.m4,
	* tools/include/m4sugar_foreach.m4,
	* tools/include/m4sugar_version.m4: Import from Autoconf 2.64.

	* tools/include/m4sugar_regexp.patch: More regex quoting fixes.

2010-01-11  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve documentation.

	* tools/bin/slr.in (Examples): Explain how to use `valgrind' and
	`time'.

2009-12-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix line numbering during `slc -EE' and later stages.

	A long standing bug would cause the compiler sync lines to become
	offset by 1 during the M4 processing. This would cause subsequent
	compiler / assembler error messages to designate wrong line
	numbers, and to produce invalid debugging information. This has
	been fixed.

	* tools/bin/cm4.in (wrepl): Shift line number by 1 before output.

	* doc/NEWS.txt: Announce the fix.

2009-12-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* configure.ac: use `$PWD' instead of `slc/' as name for the
	source tree when invoking `version-gen'.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Allow reusing the automated version numbering by other trees.

	* Makefile.am: Move Automake rules to manage `.version' to...
	* build-aux/version.mk: ...here.

	* build-aux/Makefile.am: Install `version-gen' and `version.mk' so
	they can be picked up by `sl-init-autoconf'.

	* build-aux/sl-init-autoconf: Copy `version-gen' and `version.mk'
	where appropriate

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* doc/NEWS.txt: Initialize for 2.2.x.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Release version 2.2.

	* build-aux/package_version: Update to 2.2.

	* doc/NOTES.txt: Document recent changes. Split change
	documentation for 2.1.0a from 2.2. Cleanup text and fix typos.

	* doc/HACKING.txt: Fix typos. Require Autoconf 2.61, not 2.63.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Merge the following changes.

	2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Drop remaining `slh' files from library.

	* tools/include/fibre.slh,
	* tools/include/slr.slh,
	* tools/include/svp/lib.slh: Remove.

	* tools/Makefile.am (nobase_dist_pkgdata_DATA): Update
	accordingly.

	2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Cleanup sources.

	* tools/bin/cce.in,
	* tools/bin/sag,
	* tools/bin/scu,
	* tools/bin/slr.in,
	* tools/bin/slt-many.in,
	* tools/bin/slt.in,
	* tools/bin/spp,
	* tools/bin/timeout.in,
	* tools/include/m4sugar_transform.sed,
	* tools/include/slc.m4,
	* tools/lib/host-host-ptl/include/template.pl,
	* tools/lib/r-mt-sim.sh.in,
	* tools/lib/t-pppalpha/slimpl.m4,
	* tools/lib/t-ptl/slimpl.m4,
	* tools/lib/t-seqc/slimpl.m4,
	* tools/lib/t-utc/slimpl.m4,
	* tools/lib/t-utc0/slimpl.m4: Remove references to `$Id$'.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for `slc -g3'.

	* tools/bin/slc.in: Do not use debug flags during initial
	preprocessing. Warn when `-g3' is specified.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Timestamp and version output of scripts.

	* tools/bin/slc.in: Do not inform about `slrev' since it does not
	exist any more.

	* tools/bin/slr.in,
	* tools/bin/slt.in: Produce timestamp and script version number in
	output log.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Packaging fix.

	* Makefile.am (VERSION_GEN): Check for `.git' in parent directory,
	as done by `configure.ac'.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* tools/lib/Makefile.am: Depend on `Makefile.am' not `Makefile'.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Use the new version numbering mechanism for scripts.

	* tools/bin/cce.in,
	* tools/bin/slc.in,
	* tools/bin/slr.in,
	* tools/bin/slt-many.in,
	* tools/bin/slt.in: Use `$slc_version' only, remove references to
	`$slrev' and `$rev' since this is now embedded in `$slc_version'.

	* tools/bin/Makefile.am: Make scripts and man pages depend on
	`$(top_srcdir)/.version' so they are regenerated on version bumps.

2009-12-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce automatic version numbering.

	* build-aux/version-gen: New. Inspired from `git-version-gen', but
	privileging SVN revision numbers over git commit hashes.

	* build-aux/package-version: Set to 2.1.

	* configure.ac,
	* Makefile.am: Update to use `build-aux/version-gen'.

2009-12-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fixes (allow `make distcheck').

	* lib/mtalpha.mk (CLEANFILES): Clean all built objects.

	* tools/lib/Makefile.am (CLEANFILES): Clean generated scripts.

2009-12-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fixes to quiet compiler warnings.

	* tools/lib/t-pppalpha/include/sl_support.h: Avoid multi-line
	`//'-style comments. (reported by C. Joslin)

	* lib/include/cstddef.h: Do not define `NULL' if it is already
	defined (requested by C. Joslin).

	* lib/src/gfx.c: Use proper `printf' format modifiers.

	* lib/src/mtclock.c: Define `shutup_ctime_h' to avoid warnings in
	`ctime.h'.

2009-12-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	New default MT profile that provides multiple places.

	This is required by `make check' in the `programs' package since
	the `mandel' benchmark requires at least two 1-core places.

	* tools/lib/mt-profiles/rmb8: New.
	* tools/lib/mt-profiles/default: Alias `rmb8'.

	* tools/lib/Makefile.am: Update accordingly.

2009-12-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase portability of the run script in execution packages.

	* tools/lib/r-mt-sim.sh.in: The script `run.sh' requires Bash, so
	mention that explicitely so that the script can be copied to a
	different system where `/bin/sh' is not bash. Also allow to
	override the MT simulator with an environment variable during
	re-play.

2009-12-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* build-aux/slc.m4: Also set `TMO' to the location of the
	`timeout' script.

2009-12-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance `slr' and `cce' for more flexibility.

	* tools/bin/slr.in: New parameter `-b' to specify the `cce' tag to
	use when compiling input data. Re-order stages to allow compiling
	Fibre data without a valid program executable when `-b' is
	specified.

	* tools/bin/cce.in: Recognize `mtalpha' and `mtsparc' as
	single-word aliases.

2009-12-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Also use the new `slr -p' feature with `slt'.

	* tools/bin/slt.in: Invoke `slr' with `-p'.

2009-12-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fixes in scripts.

	* tools/bin/timeout.in,
	* tools/bin/slr.in: Re-organize documentation.

	* tools/bin/slt.in: Use quotes properly.

2009-12-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Support packaging the execution process for later re-play.

	A new parameter `-p' is added to `slr'. It causes all the files
	required to run a program, minus the SL tool chain, to be saved to
	a directory. A copy of this directory is then sufficient to
	"re-play" the execution even without access to the SL tool chain.

	* tools/bin/slr.in: Support new option `-p'. Use timestamped
	`package directory' for temporary files. Link data input files and
	program executable in the package directory. Also print the
	timestamp when `-t' is used.

	* tools/lib/r-host.sh: Rename to...
	* tools/lib/r-host.sh.in: ...here. Save the program command line
	to the package directory.

	* tools/lib/r-mt-sim.sh.in: Save the program command line to the
	package directory.

	* tools/lib/Makefile.am: Also generate `r-host.sh'.

2009-12-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make debugging output more informative.

	* tools/bin/slc.in,
	* tools/bin/slr.in,
	* tools/bin/slt.in,
	* tools/lib/r-mt-sim.sh.in: Use absolute pathnames when printing
	out program names.

2009-12-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug introduced with latest MT-Alpha optimization.

	When adding a `swch' before an potentially dependent instruction,
	the `swch' could become the very first non-directive in the
	assembly output. This is not valid, as it must always be preceded
	by an instruction. Hence, remove any `swch' not preceded by an
	instruction.

	* tools/bin/spp (pppalpha.filter2): New stage `rmswchbegin'.

2009-12-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	New MT-Alpha optimization.

	The following was observed during Apple-CORE benchmarking: in many
	"small" threads the operation that use the result of a memory load
	directly follow the load. They will arrive at the pipeline read
	stage without their dependency in most case, and then be
	rescheduled. This wastes one execution cycle per thread. It can be
	avoided in most cases by forcing a thread switch immediately
	before such instructions, so that other threads get a chance to
	execute and the dependency be satisfied by the time the
	instruction goes around the active thread queue.

	* tools/bin/spp (pppalpha.addswchll): Also add `swch' *before*
	operations that use the result of a long latency operation (not
	only after).

2009-12-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for more performance metrics from simulator.

	* lib/include/svp/perf.h,
	* lib/src/perf.c: Add support for memory counters.

2009-12-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* doc/NEWS.txt: Update list of recent changes.

2009-12-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor `slr' improvements.

	* tools/lib/r-mt-sim.sh.in: Pass -d to simulator when `slr -t' is
	used. Move profile listing code to ...

	* tools/bin/slr.in: ... here. Also output command line with -t. Do
	not require a valid program with -m list.

2009-12-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* tools/lib/Makefile.am: Update profile list.

2009-12-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	More MT profiles.

	* tools/lib/mt-profiles/coma128,
	* tools/lib/mt-profiles/coma256,
	* tools/lib/mt-profiles/default,
	* tools/lib/mt-profiles/simple,
	* tools/lib/mt-profiles/rmb128,
	* tools/lib/mt-profiles/rmb256,
	* tools/lib/mt-profiles/rmb4,
	* tools/lib/mt-profiles/rmb1: Use simple names always. Cleanup
	descriptions.

	* tools/lib/mt-profiles/ml-npcrypt-p1,
	* tools/lib/mt-profiles/ml-npcrypt-p2,
	* tools/lib/mt-profiles/ml-npcrypt-p4,
	* tools/lib/mt-profiles/ml-npcrypt-p8: New.

2009-12-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce the concept of "simulator profiles" in `slr'.

	A new option `slr -m' is added to specify a simulator profile for
	execution. A profile captures in a simple name all the
	architectural settings of a microgrid: nr of cores, memory
	configuration, etc.

	Profiles are searched first in `~/.mt-profiles', then in the
	`mt-profile' directory of the build or installation tree.

	* tools/bin/slr.in,
	* tools/lib/r-mt-sim.sh.in: Allow use of simulator profiles.

	* tools/lib/mt-profiles/sifir,
	* tools/lib/mt-profiles/bir,
	* tools/lib/mt-profiles/uc,
	* tools/lib/mt-profiles/dort,
	* tools/lib/mt-profiles/bes,
	* tools/lib/mt-profiles/alti,
	* tools/lib/mt-profiles/default,
	* tools/lib/mt-profiles/simple,
	* tools/lib/mt-profiles/rmb128,
	* tools/lib/mt-profiles/rmb256,
	* tools/lib/mt-profiles/coma128,
	* tools/lib/mt-profiles/coma256: Provide some reference profiles.

	* tools/lib/Makefile.am: Update accordingly.

2009-12-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for large thread indices in target `seqc'.

	* tools/lib/t-seqc/include/sl_support.h: Use type `long' for index
	values.

2009-12-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix output primitives to support merging stderr and stdout.

	* tools/include/svp/testoutput.h: Flush output streams after
	output operations. This allows for proper interleaving when stream
	1 and 2 alias each other.

2009-12-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix in SL macro expansion.

	* tools/include/slc.m4: Strip whitespace to determine the break
	type.

2009-12-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the SL library with C's character type predicates.

	* lib/include/cctype.h,
	* lib/src/ctype.c: New.

	* lib/Makefile.am,
	* lib/mtalpha.mk: Update accordingly.

2009-12-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor optimization.

	* lib/src/io.c: Expose staticness of `digits' to the compiler.

2009-12-02  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor portability fix.

	* tools/bin/cce.in: Place `-lslc' last on the command line to cope
	with single-pass linkers.

2009-11-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor `slr' fix.

	* tools/bin/slr.in,
	* tools/lib/r-mt-sim.sh.in: Talk about "graphic update delay"
	instead of "rate", to reflect the features available in the MG
	simulator.

2009-11-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend Fibre syntax recognized by `slr'.

	* tools/bin/sag: New syntax `vc(N)' for Fibre which expands to an
	array of complex numbers. (Used by FFT)

2009-11-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Tweak simulation architecture defaults.

	* tools/lib/r-mt-sim.sh.in: Change default place layout to better
	spread cores across memory rings when using COMA.

2009-11-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix in the reporting of performance counters.

	* lib/src/perf.c (mtperf_report_intervals): Place interval labels
	at the end of each row when printing CSV with headers, so that
	parsing with simpler tools need not understand double quotes and
	spaces inside strings.

2009-11-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix in the reporting of performance counters.

	* lib/src/perf.c: Do not pad the Fibre array if the pad flag is
	set to 0.

2009-11-19  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in `slr'.

	* tools/lib/r-mt-sim.sh.in: Restore proper default setting of the
	number of cores when not specified on the command line.

2009-11-18  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Tweak the output format of the reporting of performance counters.

	* lib/include/svp/perf.h,
	* lib/src/perf.c: Change output format as per discussions with
	Dan. Example are given in note [sl8].

2009-11-18  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the performance counters API in the library.

	* lib/include/svp/perf.h,
	* lib/src/perf.c: Add the features described in note [sl8].

2009-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Implement a non-documented SL extension for the SAC compiler.

	* tools/lib/t-seqc/slimpl.m4,
	* tools/lib/t-pppalpha/slimpl.m4,
	* tools/lib/t-pppalpha/include/sl_support.h,
	* tools/bin/spp: Implement a new macro `sl_glparm_mutable' which
	aliases the global thread parameter with a local (writable) thread
	function variable.

	* tools/lib/t-utc/slimpl.m4,
	* tools/lib/t-utc0/slimpl.m4,
	* tools/lib/t-ptl/slimpl.m4: Implement stubs that generate an error.

2009-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Expose the `ar' and `ranlib' utilities.

	Two scripts are introduced: `slar' and `slranlib'. These take the
	SL implementation as first parameter, and then run the
	corresponding `ar' or `ranlib' utility with the remainder of the
	argument list.

	* tools/bin/cce.in: Generate definitions for `slc_ar' and
	`slc_ranlib'.

	* tools/bin/slar.in,
	* tools/bin/slranlib.in: New.

	* tools/bin/Makefile.am: Generate the new scripts `slar' and
	`slranlib'.

2009-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Allow to configure #caches and #directories with COMA.

	* tools/lib/r-mt-sim.sh.in: Set configuration when flags are
	specified.

2009-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Also test using COMA during `make check'.

	* build-aux/slctests.m4: New AM conditional `ENABLE_CHECK_COMA'.

	* build-aux/slctests.mk: Use it.

2009-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for COMA in `slr'.

	* build-aux/mgsim.m4: Search for `simx-alpha'.

	* tools/bin/slr.in: Add flags for COMA memory configuration. Move
	simulator-specific tests to...

	* tools/bin/r-mt-sim.sh.in: ...here. Select simulator executable
	depending on memory configuration.

2009-11-17  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Share runner script code between MT-Alpha/MT-Sparc.

	* tools/lib/r-mtsparc-sim.sh.in: Remove.
	* tools/lib/r-mtalpha-sim.sh.in: Rename to...
	* tools/lib/r-mt-sim.sh.in: ...here. Change references to `alpha'
	to references to `@arch@'.

	* tools/lib/Makefile.am: Generate `r-mtalpha-sim.sh' and
	`r-mtsparc-sim.h' from `r-mt-sim.sh.in'.

	* configure.ac: Remove them from AC_CONFIG_FILES since they are
	now explicitly generated by the Makefile.

2009-11-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update `utc0' code generation.

	* tools/lib/t-utc0/slimpl.m4: Expand to `sync()' instead of
	`__builtin_ut_sync()' (requested by S. Polstra).

2009-11-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix minor portability issue.

	* tools/lib/arggen.c: Only use threads when running MT.

2009-11-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix minor bug in `slc'.

	When running with `slc -g -g' the underlying compiler would be
	confused. (reported by A. Matei)

	* tools/bin/cce.in: Properly split `slc_debug_flags' into an
	array.

2009-11-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve `slr' to allow more debugging.

	* tools/bin/slr.in: New option `-gd' to debug data generation.

2009-11-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor improvements to data input via `slr' and `sag'.

	* tools/lib/arggen.c: Optimize by using a parallel loop (suggested
	by M. Lankamp)

	* tools/bin/sag: Define functions `v', `vu' and `vl' for uses in
	Fibre data files.

2009-11-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Simplify handling of C99's `restrict'.

	* tools/include/slc.m4: Move definition of `restrict' to...
	* tools/lib/t-ptl/include/sl_support.h: ...here.

2009-11-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Eliminate some warnings in library code.

	* lib/src/io.c: Use the primitives from `cmath.h' to test for
	infinity.

	* lib/src/mtsep.c: Cast 0 properly to make a pointer.

2009-11-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Do not warn about `ctime.h' when including `svp/perf.h'.

	* lib/include/ctime.h: Subject warning to conditional.
	* lib/include/svp/perf.h: Set conditional accordingly.

2009-11-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix code generation for `-b utcx -EE'.

	* tools/bin/cce.in: Provide compiler for `-b utcx', so that `slc
	-EE' can pass preprocessing.

	* tools/lib/t-utc/include/sl_support.h: Provide (empty) since it
	is required by `-EE'.

	* tools/lib/t-utc/slimpl.m4: Add more whitespace to make output
	more palatable.

2009-11-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Optimize the `seqc' target.

	* tools/lib/t-seqc/slimpl.m4: Use `long' for index values.

2009-11-04  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Optimize the `ptl' target.

	* tools/lib/host-host-ptl/include/create.tpl,
	* tools/lib/host-host-ptl/include/ptl_svp.h,
	* tools/lib/host-host-ptl/ptl_svp.cc,
	* tools/lib/t-ptl/simpl.m4: Get rid of references to
	`squeeze'. Use `long' for index values.

2009-11-03  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix minor portability issue.

	* tools/include/svp/compiler.h: Rewrite definition of `use()' to
	make it portable.

2009-10-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Cosmetic fixes for `slt'.

	* tools/bin/slt.in: Improve readability of test log.

2009-10-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Cosmetic fixes for `slr'.

	* tools/bin/slr.in: Do not complain about `-n' being used if it
	specifies multiple places. (requested by M. Hicks)

	* tools/lib/r-mtsparc-sim.sh.in,
	* tools/lib/r-mtsparc-sim.sh.in: Allow `SIMARGS' to override
	`-n'. (requested by M. Hicks)

2009-10-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in shared handling in `ppp' target.

	The latest changesets allowed the `fibonacci' demo program to fail
	by letting an alias to the incoming dependent leak to the outgoing
	write, causing no dependent read to actually occur in the location
	defined by the source program. Synchronization was thus not
	achieved properly.

	* tools/lib/t-pppalpha/include/sl_support.h: Clobber the dependent
	in `sl_setp', albeit at a different place than initially.

2009-10-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Slight optimization MT-Alpha code generation.

	* tools/bin/spp (pppalpha): Allow `end' immediately after a branch.

2009-10-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Re-optimize accesses to shareds in `ppp' target.

	The previous changeset was required to prevent incorrect code, but
	would also require a temporary register in all cases, including
	the simple `sl_setp(x, sl_getp(x) + 1)' which should instead be
	optimized to a single instruction. This changeset reintroduces
	this optimization opportunity.

	* tools/lib/t-pppalpha/include/sl_support.h: Remove superfluous
	clobber of the incoming shared just before a write to the
	outgoing. (but still clobber it afterwards)

2009-10-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for shareds in `ppp' target.

	Constructs of the form `sl_setp(x, (foo == 0) ? bar : 0)' would
	cause code generation to write to a shared register twice, which
	is incorrect. (reported by M. Lankamp)

	* tools/lib/t-pppalpha/include/sl_support.h: Use a temporary in
	the expansion of `sl_setp' and `sl_seta' to prevent computations
	and control flow between the "guard" asm statemetns.

2009-10-20  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* lib/seqc.mk (CLEANFILES),
	* lib/ptl.mk (CLEANFILES): Mention `perf.o'.

2009-10-16  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `slr' breakage.

	* tools/bin/sag: Fix order in which `slr' variables from program
	are considered.

2009-10-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `slr -g' with simulator.

	* tools/lib/r-mtalpha-sim.sh.in (DEBUGGER),
	* tools/lib/r-mtsparc-sim.sh.in (DEBUGGER): Fix typo (do not use
	`.gfx' by default when debugging).

2009-10-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Reflect latest binutils changes. (cont.)

	* tools/lib/mtalpha-sim/slrt.s (_start),
	* tools/lib/mtalpha-sim/callgate.s (__sl_callgate): Move
	`.registers' to before the label.

2009-10-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Reflect latest binutils changes.

	* tools/bin/spp (pppalpha.xjoin2): Emit the `.registers' directive
	before the function label. This is required because the register
	word should happen before the first instruction in the output and
	assembler does not reorder them anymore.

2009-10-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase portability of the `seqc' and `ptl' targets.

	On some systems, it is needed to link with `-lm' to get access to
	math functions.

	* build-aux/slc.m4: Check whether `-lm' is needed to use math on
	the host C/C++.

	* build-aux/sl.mk: Use $(LIBS) for the host system.

2009-10-14  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Allow multiple uses of `slr_decl' in the same translation unit.

	* tools/include/svp/slr.h: Support multiple uses of `slr_decl'.

	* tools/bin/sag: Sort variables according to the order specified
	in the source.

2009-10-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	ABI change: special memory now at the start of the address space.

	* lib/include/svp/perf.h: Counters now start at address +4 from
	the start of the address space, instead of -256 from the end.

	* tools/lib/t-utc0/slimpl.m4: The `setempty' instruction now
	expands to a load from address +4 from the start of the address
	space, instead of a load from the end of the address
	space. Transform the flush of a shared accordingly.

2009-10-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Prepare for ABI change.

	* tools/bin/cce.in: Change the base offset for MT linking to 16Mb,
	to allow for some reserved memory with special behavior before.

2009-10-13  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Ease post-processing of the output of `slr'.

	* tools/bin/sag (SlrVarGenerator.dogen): Prefix `#' to warning
	messages so they can be treated as comments in text-processing
	tools.

2009-10-12  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in MT-alpha code generation.

	When the legacy RA register is used as a temporary, a special
	"complete memory load" register access is emitted before the point
	a thread terminates, to ensure pending memory loads are flushed
	before the thread resources are used. This is a "required
	optimization" (to avoid pipeline stalls in the next thread that
	reuses the register). Unfortunately it is possible that the
	control flow reaches that point without using the RA register (it
	could be used only in some branches in the function body). The
	solution implemented is to conservatively initialize RA always
	when it may be used as a temporary.

	* tools/bin/spp (pppalpha.makeprotectspecial): New transform.
	(pppalpha.filter): Use it.

2009-10-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Provide support for anonymous thread arguments/parameters.

	* tools/include/slc.m4: Define new macro `sl_anonymous'.

	* tools/lib/t-ptl/slimpl.m4,
	* tools/lib/t-seqc/slimpl.m4,
	* tools/lib/t-utc0/slimpl.m4
	* tools/lib/t-pppalpha/slimpl.m4: Use `sl_anonymous' when no
	thread parameter/argument name is provided.

2009-10-10  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix some issues with whitespace handling.

	* tools/include/m4sugar_regexp.patch: New.

	* tools/Makefile.am: Patch regexps after translating the quotes in
	m4sugar, since some regexps can contain valid single pairs of [
	and ].

	* tools/lib/t-seqc/slimpl.m4: Do not initialize thread arguments
	when the initializer is whitespace.

	* tools/bin/spp: Strip whitespace from initializer before testing
	for emptyness.

2009-10-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make testsuite more resilient to long tests.

	* tools/bin/timeout.in: Increase the default timeout to 60
	seconds.

2009-10-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase support for C99.

	* tools/bin/cce.in: Use `-std=gnu99' when compiling for MT.

2009-10-09  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor fix.

	* build-aux/sl.mk (.c.x): Fix typo in variable expansion.

2009-10-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance the build framework.

	* build-aux/sl.mk: Allow Makefiles to add flags to the `slc'
	command lines.

2009-10-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance the performance counters library.

	* lib/include/svp/perf.h: Introduce new macro `REPORT_STREAM'.

	* lib/src/perf.c: Use the specified stream for output.

2009-10-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug with special characters in string constants.

	* tools/bin/cm4.in: Insert string delimiters after inserted hex
	escapes, to prevent adjacent digits from taking part in the
	character code.

2009-10-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance `slr'.

	* tools/bin/slr.in: Also use `SLR_RECURSIVE' when processing the
	Fibre input.

2009-10-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Allow to use thread function pointers with muTC-ptl.

	* tools/lib/t-ptl/simpl.m4: Do not take the address of the thread
	function when invoking uTC::create.

2009-10-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* tools/include/svp/compiler.h (alwaysinline): Fix typo.

2009-10-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the library.

	* tools/include/svp/compiler.h: Introduce new macro
	`use'. (req. by M. Lankamp)

2009-10-07  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Optimize the root SEP allocator.

	* lib/src/mtsep.c: Bucket places by power of 2 sizes; remove
	allocated places from their allocation pools during `alloc' and
	put them back during `free'.

2009-10-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Increase C99 compatibility.

	* tools/bin/cce.in: Append `-std=gnu99' when compiling C
	natively. (reported by A. Matei)

2009-10-06  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Enhance `slr', most notably to set up gfx output.

	The following options are introduced: `-X' enable graphics, `-Xr'
	set refresh rate, `-Xs' set scaling factors, `-Xd' set output
	dimensions.

	* tools/bin/slr.in: Add support for the new options. Document
	them.

	* tools/lib/r-mtalpha-sim.sh.in,
	* tools/lib/r-mtsparc-sim.sh.in: Use the `gfx' version of the
	simulator where needed. Also enhance to use the `dbg' version when
	-g is given to `slr'.

2009-10-01  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce performance counters and C99's clock().

	* lib/include/ctime.h,
	* lib/src/mtclock.c: New.

	* lib/include/svp/perf.h: Deprecate `get_cycles()' in favor of
	`clock()'.

	* lib/include/svp/perf.h,
	* lib/src/perf.c: Implement the API described in note [sl8].

	* lib/Makefile.am,
	* lib/seqc.mk,
	* lib/ptl.mk,
	* lib/mtalpha.mk: List the new files.

2009-09-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Introduce a default architecture configuration with many places.

	* tools/bin/slr.in: Change documentation for `-n'. Force default
	to many places of varying sizes.

	* tools/bin/slt.in: Update documentation to remove uses of `-n'.

	* build-aux/slctests.mk: Do not use `-n' any more. Programs can
	request multiple tests via SLT_RUN in the source code.

2009-09-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for C99's float.h.

	* lib/include/bits/float.h: New.
	* lib/Makefile.am: Update accordingly.

2009-09-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix build of demos that require the math library.

	* build-aux/sl.mk: Compile to MT alpha with `-lm' always, so that
	demo code does not need to sort out when it is needed and not.

2009-09-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* doc/NEWS.txt: Document latest big changes.

2009-09-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve command-line argument handling in `slc'.

	The script supports `-ftrace-m4' but documents `-fm4-trace'. Also
	the underlying M4 implementation has changed the parameter for the
	output file from `-o' to `--debugfile'.

	* tools/bin/slc.in: Align documentation with
	implementation. Update to new M4 interface.

2009-09-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Align API for place allocation with documentation.

	Note [sl7] was authored to document the API and introduces the
	concept of SEP. Ensure this concept exists in the implementation
	as well. Also, place sharing does not exist yet.

	* lib/include/svp/sep.h,
	* lib/src/mtsep.c: Introduce the SEP. Remove support for place
	sharing.

2009-09-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in SL macro expansion.

	* tools/lib/t-pppalpha/slimpl.m4: Shell-quote the thread function
	name when calling Python, so as to avoid strangeness with names of
	the form "foo->bar" etc.

2009-09-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Extend the graphics output library.

	* lib/include/svp/gfx.h: Add support for pixel output at offset
	from start of framebuffer.

2009-09-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Small optimization in MT-alpha code generation.

	* tools/bin/spp (pppalpha.addswchll): Properly recognize `sqrt' as
	a long-latency operation.

2009-09-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* lib/Makefile.am: Install math headers.

	* lib/mtalpha.mk: Distribute math modules.

2009-09-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve support for C99 math.

	* lib/include/cmath.h: Properly define `float_t' and
	`double_t'. Set `math_errhandling' to 0 since there is actually no
	handling implemented.

2009-09-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* tools/bin/slt.in: Compile tests with `-lm'.

2009-09-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for C99 math on MT-alpha.

	* lib/include/cfloat.h,
	* lib/include/cmath.h: Declare C99 math.

	* lib/src/missing_uclibc_math.c: New.

	* lib/src/mtalpha/m/acosf.o,
	* lib/src/mtalpha/m/acoshf.o,
	* lib/src/mtalpha/m/asinf.o,
	* lib/src/mtalpha/m/asinhf.o,
	* lib/src/mtalpha/m/atan2f.o,
	* lib/src/mtalpha/m/atanf.o,
	* lib/src/mtalpha/m/atanhf.o,
	* lib/src/mtalpha/m/cabsf.o,
	* lib/src/mtalpha/m/carg.o,
	* lib/src/mtalpha/m/cargf.o,
	* lib/src/mtalpha/m/cbrtf.o,
	* lib/src/mtalpha/m/ceilf.o,
	* lib/src/mtalpha/m/copysignf.o,
	* lib/src/mtalpha/m/cosf.o,
	* lib/src/mtalpha/m/coshf.o,
	* lib/src/mtalpha/m/e_acos.o,
	* lib/src/mtalpha/m/e_acosh.o,
	* lib/src/mtalpha/m/e_asin.o,
	* lib/src/mtalpha/m/e_atan2.o,
	* lib/src/mtalpha/m/e_atanh.o,
	* lib/src/mtalpha/m/e_cosh.o,
	* lib/src/mtalpha/m/e_exp.o,
	* lib/src/mtalpha/m/e_fmod.o,
	* lib/src/mtalpha/m/e_gamma.o,
	* lib/src/mtalpha/m/e_gamma_r.o,
	* lib/src/mtalpha/m/e_hypot.o,
	* lib/src/mtalpha/m/e_j0.o,
	* lib/src/mtalpha/m/e_j1.o,
	* lib/src/mtalpha/m/e_jn.o,
	* lib/src/mtalpha/m/e_lgamma.o,
	* lib/src/mtalpha/m/e_lgamma_r.o,
	* lib/src/mtalpha/m/e_log.o,
	* lib/src/mtalpha/m/e_log10.o,
	* lib/src/mtalpha/m/e_log2.o,
	* lib/src/mtalpha/m/e_pow.o,
	* lib/src/mtalpha/m/e_rem_pio2.o,
	* lib/src/mtalpha/m/e_remainder.o,
	* lib/src/mtalpha/m/e_scalb.o,
	* lib/src/mtalpha/m/e_sinh.o,
	* lib/src/mtalpha/m/e_sqrt.o,
	* lib/src/mtalpha/m/erfcf.o,
	* lib/src/mtalpha/m/erff.o,
	* lib/src/mtalpha/m/exp2f.o,
	* lib/src/mtalpha/m/expf.o,
	* lib/src/mtalpha/m/expm1f.o,
	* lib/src/mtalpha/m/fabsf.o,
	* lib/src/mtalpha/m/fdimf.o,
	* lib/src/mtalpha/m/floorf.o,
	* lib/src/mtalpha/m/fmaf.o,
	* lib/src/mtalpha/m/fmaxf.o,
	* lib/src/mtalpha/m/fminf.o,
	* lib/src/mtalpha/m/fmodf.o,
	* lib/src/mtalpha/m/frexpf.o,
	* lib/src/mtalpha/m/hypotf.o,
	* lib/src/mtalpha/m/ilogbf.o,
	* lib/src/mtalpha/m/k_cos.o,
	* lib/src/mtalpha/m/k_rem_pio2.o,
	* lib/src/mtalpha/m/k_sin.o,
	* lib/src/mtalpha/m/k_standard.o,
	* lib/src/mtalpha/m/k_tan.o,
	* lib/src/mtalpha/m/ldexpf.o,
	* lib/src/mtalpha/m/lgammaf.o,
	* lib/src/mtalpha/m/llrintf.o,
	* lib/src/mtalpha/m/llroundf.o,
	* lib/src/mtalpha/m/log10f.o,
	* lib/src/mtalpha/m/log1pf.o,
	* lib/src/mtalpha/m/log2f.o,
	* lib/src/mtalpha/m/logbf.o,
	* lib/src/mtalpha/m/logf.o,
	* lib/src/mtalpha/m/lrintf.o,
	* lib/src/mtalpha/m/lroundf.o,
	* lib/src/mtalpha/m/modff.o,
	* lib/src/mtalpha/m/nan.o,
	* lib/src/mtalpha/m/nearbyintf.o,
	* lib/src/mtalpha/m/nextafterf.o,
	* lib/src/mtalpha/m/powf.o,
	* lib/src/mtalpha/m/remainderf.o,
	* lib/src/mtalpha/m/remquof.o,
	* lib/src/mtalpha/m/rintf.o,
	* lib/src/mtalpha/m/roundf.o,
	* lib/src/mtalpha/m/s_asinh.o,
	* lib/src/mtalpha/m/s_atan.o,
	* lib/src/mtalpha/m/s_cbrt.o,
	* lib/src/mtalpha/m/s_ceil.o,
	* lib/src/mtalpha/m/s_copysign.o,
	* lib/src/mtalpha/m/s_cos.o,
	* lib/src/mtalpha/m/s_erf.o,
	* lib/src/mtalpha/m/s_expm1.o,
	* lib/src/mtalpha/m/s_fabs.o,
	* lib/src/mtalpha/m/s_fdim.o,
	* lib/src/mtalpha/m/s_finite.o,
	* lib/src/mtalpha/m/s_finitef.o,
	* lib/src/mtalpha/m/s_floor.o,
	* lib/src/mtalpha/m/s_fma.o,
	* lib/src/mtalpha/m/s_fmax.o,
	* lib/src/mtalpha/m/s_fmin.o,
	* lib/src/mtalpha/m/s_fpclassify.o,
	* lib/src/mtalpha/m/s_fpclassifyf.o,
	* lib/src/mtalpha/m/s_frexp.o,
	* lib/src/mtalpha/m/s_ilogb.o,
	* lib/src/mtalpha/m/s_isinf.o,
	* lib/src/mtalpha/m/s_isinff.o,
	* lib/src/mtalpha/m/s_isnan.o,
	* lib/src/mtalpha/m/s_isnanf.o,
	* lib/src/mtalpha/m/s_ldexp.o,
	* lib/src/mtalpha/m/s_lib_version.o,
	* lib/src/mtalpha/m/s_llrint.o,
	* lib/src/mtalpha/m/s_llround.o,
	* lib/src/mtalpha/m/s_log1p.o,
	* lib/src/mtalpha/m/s_logb.o,
	* lib/src/mtalpha/m/s_lrint.o,
	* lib/src/mtalpha/m/s_lround.o,
	* lib/src/mtalpha/m/s_matherr.o,
	* lib/src/mtalpha/m/s_modf.o,
	* lib/src/mtalpha/m/s_nearbyint.o,
	* lib/src/mtalpha/m/s_nextafter.o,
	* lib/src/mtalpha/m/s_remquo.o,
	* lib/src/mtalpha/m/s_rint.o,
	* lib/src/mtalpha/m/s_round.o,
	* lib/src/mtalpha/m/s_scalbln.o,
	* lib/src/mtalpha/m/s_scalbn.o,
	* lib/src/mtalpha/m/s_signbit.o,
	* lib/src/mtalpha/m/s_signbitf.o,
	* lib/src/mtalpha/m/s_signgam.o,
	* lib/src/mtalpha/m/s_significand.o,
	* lib/src/mtalpha/m/s_sin.o,
	* lib/src/mtalpha/m/s_tan.o,
	* lib/src/mtalpha/m/s_tanh.o,
	* lib/src/mtalpha/m/s_trunc.o,
	* lib/src/mtalpha/m/scalblnf.o,
	* lib/src/mtalpha/m/scalbnf.o,
	* lib/src/mtalpha/m/sinf.o,
	* lib/src/mtalpha/m/sinhf.o,
	* lib/src/mtalpha/m/sqrtf.o,
	* lib/src/mtalpha/m/tanf.o,
	* lib/src/mtalpha/m/tanhf.o,
	* lib/src/mtalpha/m/tgammaf.o,
	* lib/src/mtalpha/m/truncf.o,
	* lib/src/mtalpha/m/w_acos.o,
	* lib/src/mtalpha/m/w_acosh.o,
	* lib/src/mtalpha/m/w_asin.o,
	* lib/src/mtalpha/m/w_atan2.o,
	* lib/src/mtalpha/m/w_atanh.o,
	* lib/src/mtalpha/m/w_cabs.o,
	* lib/src/mtalpha/m/w_cosh.o,
	* lib/src/mtalpha/m/w_drem.o,
	* lib/src/mtalpha/m/w_exp.o,
	* lib/src/mtalpha/m/w_exp2.o,
	* lib/src/mtalpha/m/w_fmod.o,
	* lib/src/mtalpha/m/w_gamma.o,
	* lib/src/mtalpha/m/w_hypot.o,
	* lib/src/mtalpha/m/w_j0.o,
	* lib/src/mtalpha/m/w_j1.o,
	* lib/src/mtalpha/m/w_jn.o,
	* lib/src/mtalpha/m/w_lgamma.o,
	* lib/src/mtalpha/m/w_lgamma_r.o,
	* lib/src/mtalpha/m/w_log.o,
	* lib/src/mtalpha/m/w_log10.o,
	* lib/src/mtalpha/m/w_log2.o,
	* lib/src/mtalpha/m/w_pow.o,
	* lib/src/mtalpha/m/w_remainder.o,
	* lib/src/mtalpha/m/w_sinh.o,
	* lib/src/mtalpha/m/w_sqrt.o,
	* lib/src/mtalpha/m/w_tgamma.o: Import from uClibc 0.9.30.1.

	* lib/src/mtamathobjs.mk: List the precompiled objects.

	* lib/mtalpha.mk: New target `mtalpha-sim/libm.a'.

2009-09-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for reusing `slr' parameters in `slt'.

	A previous patch introduced a new environment variable
	EXTRA_RUN_ARGS. This approach is too intrusive as it can leak
	across test cases in a shell environment.

	* tools/bin/slt.in: Remove support for EXTRA_RUN_ARGS. Introduce a
	new option `-a' with the same effect.

2009-09-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for multiple source files per unit test.

	* tools/bin/slt.in: Recognize `--' as separator between test
	sources and the implementation list. For backward compatibility,
	if the separator is not present, only one source file is
	allowed. Handle multiple sources per test. (Requested by
	M. Lankamp)

2009-09-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix support for `slc -combine'.

	When using `-combine=P', multiple inclusions of `sl_support.h'
	would occur and cause multiple definitions to happen later during
	compilation.

	* tools/lib/t-utc0/include/sl_support.h,
	* tools/lib/t-seqc/include/sl_support.h,
	* tools/lib/t-ptl/include/sl_support.h,
	* tools/lib/t-pppalpha/include/sl_support.h: Protect definitions
	with conditional.

2009-09-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for reusing `slr' parameters.

	* tools/bin/slt.in: Use the variable `EXTRA_RUN_ARGS' on each run
	of `slr'. (Requested by M. Lankamp)

2009-09-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Expose the availability of place management to programs.

	* lib/include/svp/sep.h: Introduce the macro `SVP_HAS_SEP' is
	introduced which signals to program the availability of place
	management.

2009-09-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Integrate the place allocator in the library.

	* tools/lib/mtalpha-sim/slrt.s: Move the definition of the
	pointers to fibre and variable data, as well as their
	initializations, to C code in...

	* slc/lib/src/mtinit.c: here. Call the place allocator
	initialization as part of the library initialization.

	* slc/lib/Makefile.am: Mention the new files.

	* slc/lib/mtalpha.mk: Compile them into the library.

2009-09-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Import Joe's work on place allocation.

	An initial version of a SVP place allocator was developed by Joe
	Master using a first-fit algorithm; this was extended to provide
	multiple allocation policies.

	* lib/include/svp/sep.h,
	* lib/src/mtsep.c: New.

2009-09-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix symbolic place names in `seqc'.

	The `seqc' implementation was out-of-sync with the others in not
	defining `PLACE_LOCAL' and `PLACE_DEFAULT'.

	* tools/lib/t-seqc/include/sl_support.h: Rename `SVP_LOCAL' to
	`PLACE_LOCAL' and define `PLACE_DEFAULT'.

2009-09-24  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Small optimization in MT-alpha code generation.

	* tools/bin/spp (pppalpha.makerepl): Prepend the dollar signs
	early.

2009-09-23  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bugs in MT-alpha code generation.

	* tools/lib/t-pppalpha/include/sl_support.h: Fix `sl_setp' for
	floating-point shared parameters.

	* tools/bin/spp (pppalpha.findusedcallregs, pppalpha.rewritejsr):
	Be (more) careful about function calls where both int and fp
	registers are used for function calls.

	* tools/bin/spp (pppalpha.fixemptyf, pppalpha.filter2): Add new
	pass to rename `setempty' to `setemptyf' is the argument is a
	floating-point register. Use it.

	* tools/lib/t-utc0/slimpl.m4: Attempt to implement empty shared
	thread arguments by emitting an explicit load from the top of the
	address space.

2009-09-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Simplify build.

	* lib/ptl.mk,
	* lib/seqc.mk: Simplify by providing a generic rule %.c -> %.o.

2009-09-21  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add support for a graphical framebuffer.

	This changeset adds support for the graphics output in the MG
	simulator introduced in r2814-r2817, and simulates a framebuffer
	using memory but no graphics when using the other SVP
	implementations.

	* lib/include/svp/gfx.h,
	* lib/src/gfx.c: New.

	* lib/Makefile.am: Update accordingly.

	* lib/seqc.mk,
	* lib/ptl.mk: Include `gfx.c' in the library.

2009-09-08  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* tools/bin/Makefile.am: Make script generation dependent on the
	`Makefile' itself, since they need to be re-made when tools are
	reconfigured.

2009-09-15  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix bug in `slr'.

	The `raw:' input scheme would attempt to load twice too many bytes
	from the file, due to an invalid loop increment.

	* tools/bin/sag: Fix bug.

2009-08-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fix.

	* tools/bin/Makefile.am: Use unique temporary directory to build
	the scripts. This allows proper behavior when building the man
	pages in concurrent `make' invocations.

2009-08-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve autonomy of other packages using SLC.

	* build-aux/slc.m4: Also try find `slc' in PATH if not specified
	with `--with-slc' or SLC_BASE. Reject double slashes in SLC_BASE
	as this is known to cause issues with M4.

2009-08-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix `slr' bug.

	Under some circumstances `slr' would not be able to find which
	runner to use with an executable after it was compiled. This
	changeset addresses this issue. (reported by M. Lankamp)

	* tools/lib/host-host-seqc/slrt.c,
	* tools/lib/host-host-ptl/slrt.c: Ensure that the magic strings
	are prefixed by a NUL byte so that the `strings' command can find
	them.

2009-08-31  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix packaging.

	* lib/Makefile.am: Distribute and install `svp/callgate.h'.

2009-08-30  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Update documentation.

	* doc/HACKING.txt,
	* doc/NEWS.txt,
	* doc/README.txt,
	* doc/acronyms.txt,
	* doc/requirements.txt: Update to latest software changes.

2009-08-29  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix typo in `sac_helpers.h'.

	* lib/include/sac_helpers.h (fast_safe_free): Delegate to
	`fast_free', not `safe_free'.

2009-08-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Add more SAC to muTC helpers.

	* lib/include/sac_helpers.h: Also provide `fast_safe_free'.

2009-08-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Packaging fix.

	* lib/Makefile.am: Distribute and install `calloca.h'.

2009-08-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Improve global memory allocation.

	This changeset introduces a set of `fast_' wrappers around memory
	allocation functions toavoid an intermediary function context to
	reach their respective algorithm. This was suggested by Chris
	Jesshope. Also increase the `malloc' pool by larger chunks, so
	that pool extension happens less often.

	* lib/src/callgate.h: Rename to...
	* lib/include/svp/callgate.h: ...here. Simplify.

	* lib/include/cmalloc.h: Provide wrappers.

	* lib/src/malloc_wrappers.c: Simplify by using the wrappers.

	* lib/mtalpha.mk,
	* lib/src/malloc_intrinsics.c: Make the page size bigger, so that
	`malloc' increases its pool by bigger chunks.

2009-08-28  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Complete support for C's (non-standard) `alloca'.

	Since `alloca' is merely play on the stack pointer and the frame
	pointer everything was in place except the declaration of the name
	`alloca' itself. This changeset provides a header for this
	purpose.

	* lib/include/calloca.h: New.

	* lib/include/sac_helpers.h: Add `safe_free()', which calls
	`free()' if and only if it detects its argument is not the result
	of `alloca'. This is non-portable (Microgrid only).

2009-08-27  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	MT-Alpha ISA change: `allocate' takes the place identifier as input.

	Creates using the default place must flush the register passed to
	`allocate'. `setplace' disappears.

	* tools/lib/t-pppalpha/include/sl_support.h,
	* tools/lib/mtalpha-sim/main.c,
	* lib/src/callgate.h,
	* lib/src/mtalpha/mtdiv.s,
	* tools/bin/spp (pppalpha.create, pppalpha.remdefaults,
	pppalpha.rewritejsr): Pass the place identifier as input to
	`allocate'. Do not use `setplace' any more.

	* tools/bin/spp (pppalpha.addswchll): Recognize that `allocate'
	reads its parameter. Also recognize that `clr' and `fclr' make the
	target register immediately available for reading.

2009-08-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Fix packaging. This allows `make distcheck' to succeed.

	* build-aux/Makefile.am: Distribute `sl-init-autoconf'.

	* tools/bin/Makefile.am: Fix manpage dependencies to please
	`distcleancheck'.

2009-08-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Minor packaging fixes.

	* build-aux/slc.m4: Fail if the SL tools cannot be found. Use
	`sl-core' instead of `slc' to fetch installed files from.

2009-08-26  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Make package more reusable for other trees.

	There are two ways the parts of the source tree can be used:
	either together as sub-trees of the "base" package, or
	independently of the base package after the `sl-core' package was
	installed somewhere on the system.

	In the former case the tools and makefile rules can be picked up
	relative to the directory where they are reused; in the latter
	case they must pick them up from some agreed-upon install
	location.

	The new `sl-init-autoconf' script implements this protocol by
	fetching the aclocal and Makefile rules (.mk) from the "nearest"
	location, either a source tree "nearby" (next to the
	`sl-init-autoconf' script itself) or from the install locations.

	* build-aux/sl-init-autoconf: New.

	* build-aux/Makefile.am: Install `sl-init-autoconf'. Also install
	the `.mk' files to some location where `sl-init-autoconf' can find
	them.

	* Makefile.am: Recurse into `build-aux'.

2009-08-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	Rename the package to `sl-core'.

	* configure.ac: Change package name.

2009-08-25  Raphael 'kena' Poss  <r.c.poss@uva.nl>

	* ChangeLog: initialize.

See `ChangeLog.1' for earlier changes.

	 LocalWords:  canonicalization
